<?xml version="1.0" encoding="UTF-8"?>
<!--
CAUTION: Do not modify this file unless you know what you are doing.
         Unexpected results may occur if the code is changed deliberately.
-->
<dbmodel pgmodeler-ver="0.8.0" last-position="0,51" last-zoom="0.3"
	 default-schema="public" default-owner="postgres">
<role name="geonatuser"
      inherit="true"
      login="true"
      encrypted="true"
      password="********">
</role>

<role name="geonatadmin"
      superuser="true"
      encrypted="true"
      password="********">
</role>

<role name="usershubadmin"
      superuser="true"
      encrypted="true"
      password="********">
</role>

<database name="geonaturedb" encoding="UTF8" lc-collate="fr_FR" lc-ctype="fr_FR">
	<role name="geonatuser"/>
	<tablespace name="pg_default"/>
</database>

<schema name="public" protected="true" rect-visible="true" fill-color="#e1e1e1" sql-disabled="true">
</schema>

<extension name="postgis" cur-version="2.1.4">
	<schema name="public"/>
	<comment><![CDATA[PostGIS geometry, geography, and raster spatial types and functions]]></comment>
</extension>

<schema name="contactfaune" rect-visible="true" fill-color="#f1bc34">
	<role name="geonatuser"/>
	<comment><![CDATA[schéma contenant les données et les bibliothèques du protocole contact faune]]></comment>
</schema>

<schema name="contactinv" rect-visible="true" fill-color="#e5e537">
	<role name="geonatuser"/>
	<comment><![CDATA[schéma contenant les données et les bibliothèques du protocole contact invertébrés sur le modèle de contactfaune]]></comment>
</schema>

<schema name="bryophytes" rect-visible="true" fill-color="#4d7952">
	<role name="geonatuser"/>
</schema>

<schema name="florepatri" rect-visible="true" fill-color="#6a8816">
	<role name="geonatuser"/>
</schema>

<schema name="florestation" rect-visible="true" fill-color="#124f24">
	<role name="geonatuser"/>
</schema>

<schema name="layers" rect-visible="true" fill-color="#942665">
	<role name="geonatuser"/>
	<comment><![CDATA[schéma contenant les couches SIG nécéssaires au fonctionnement de la base ou des applications qui s'y connectent. (exemple, communes, secteurs, zone à statut...)]]></comment>
</schema>

<schema name="meta" rect-visible="true" fill-color="#c3c3bb">
	<role name="geonatuser"/>
</schema>

<schema name="synchronomade" rect-visible="true" fill-color="#94e1e5">
	<role name="geonatuser"/>
</schema>

<schema name="synthese" rect-visible="true" fill-color="#a239f5">
	<role name="geonatuser"/>
</schema>

<schema name="taxonomie" rect-visible="true" fill-color="#4e132e">
	<role name="geonatuser"/>
</schema>

<schema name="utilisateurs" rect-visible="true" fill-color="#081cb1">
	<role name="geonatuser"/>
</schema>

<function name="geomfromtext"
		window-func="false"
		returns-setof="false"
		behavior-type="STRICT"
		function-type="IMMUTABLE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="public"/>
	<role name="geonatuser"/>
	<language name="sql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="geometry"/>
	</return-type>
	<parameter name="_param1">
		<type name="text"/>
	</parameter>
	<parameter name="_param2">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[SELECT st_geometryfromtext($1, $2)]]></definition>
</function>

<function name="periode"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="public"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="boolean"/>
	</return-type>
	<parameter name="dateobs">
		<type name="date"/>
	</parameter>
	<parameter name="datedebut">
		<type name="date"/>
	</parameter>
	<parameter name="datefin">
		<type name="date"/>
	</parameter>
	<definition><![CDATA[
declare
 
jo int; jd int; jf int; test int; 
 
 
BEGIN
jo = extract(doy FROM dateobs);--jour de la date passée
jd = extract(doy FROM datedebut);--jour début
jf = extract(doy FROM datefin); --jour fin
test = jf - jd; --test si la période est sur 2 année ou pas
 
--si on est sur 2 années
IF test < 0 then
	IF jo BETWEEN jd AND 366 OR jo BETWEEN 1 AND jf THEN RETURN true;
	END IF;
-- si on est dans la même année
else 
	IF jo BETWEEN jd AND jf THEN RETURN true;
	END IF;
END IF;
	RETURN false;	
END;
 
]]></definition>
</function>

<function name="application_aggregate_taxons_rang_sp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="public"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="text"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de regroupper dans un tableau tous les cd_nom d'une espèce et de ces sous espèces, variétés et convariétés à partir du cd_nom d'un taxon
--si le cd_nom passé est d'un rang différent de l'espèce (genre, famille... ou sous-espèce, variété...), la fonction renvoie simplement le cd_ref du cd_nom passé en entré
--
--Gil DELUERMOZ septembre 2011
  DECLARE
  rang character(4);
  rangsup character(4);
  ref integer;
  sup integer;
  cd integer;
  tab integer;
  r text; 
  BEGIN
	SELECT INTO rang id_rang FROM taxonomie.taxref WHERE cd_nom = id;
	IF(rang='ES') THEN
		cd = taxonomie.find_cdref(id);
		--SELECT INTO tab cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = taxonomie.find_cdref(id);
		SELECT INTO r array_agg(a.cd_nom) FROM (
		SELECT cd_nom FROM taxonomie.taxref WHERE cd_ref = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'VAR' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'CVAR' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'VAR' AND cd_taxsup IN (SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd)
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'CVAR' AND cd_taxsup IN (SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd)
		) a;   
	ELSE
	   SELECT INTO r array_agg(cd_ref) FROM taxonomie.taxref WHERE cd_nom = id;
	END IF;
	return r;
  END;
]]></definition>
</function>

<function name="application_aggregate_taxons_all_rang_sp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="public"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="text"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de regroupper dans un tableau au rang espèce tous les cd_nom d'une espèce et de ces sous espèces, variétés et convariétés à partir du cd_nom d'un taxon
--si le cd_nom passé est d'un rang supérieur à l'espèce (genre, famille...), la fonction renvoie simplement le cd_ref du cd_nom passé en entré
--
--Gil DELUERMOZ septembre 2011
  DECLARE
  rang character(4);
  rangsup character(4);
  ref integer;
  sup integer;
  cd integer;
  tab integer;
  r text; 
  BEGIN
	SELECT INTO rang id_rang FROM taxonomie.taxref WHERE cd_nom = id;
	IF(rang='ES' OR rang='SSES' OR rang = 'VAR' OR rang = 'CVAR') THEN
	    IF(rang = 'ES') THEN
		cd = taxonomie.find_cdref(id);
	    END IF;
	    IF(rang = 'SSES') THEN
		SELECT INTO cd cd_taxsup FROM taxonomie.taxref WHERE cd_nom = taxonomie.find_cdref(id);
	    END IF;
	    IF(rang = 'VAR' OR rang = 'CVAR') THEN
		SELECT INTO sup cd_taxsup FROM taxonomie.taxref WHERE cd_nom = taxonomie.find_cdref(id);
		SELECT INTO rangsup id_rang FROM taxonomie.taxref WHERE cd_nom = taxonomie.find_cdref(sup);
		IF(rangsup = 'ES') THEN
			cd = sup;
		ELSE
			SELECT INTO cd cd_taxsup FROM taxonomie.taxref WHERE cd_nom = taxonomie.find_cdref(sup);
		END IF;
	    END IF;

		--SELECT INTO tab cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = taxonomie.find_cdref(id);
		SELECT INTO r array_agg(a.cd_nom) FROM (
		SELECT cd_nom FROM taxonomie.taxref WHERE cd_ref = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'VAR' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'CVAR' AND cd_taxsup = cd
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'VAR' AND cd_taxsup IN (SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd)
		UNION
		SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'CVAR' AND cd_taxsup IN (SELECT cd_nom FROM taxonomie.taxref WHERE id_rang = 'SSES' AND cd_taxsup = cd)
		) a;   
	ELSE
	   SELECT INTO r cd_ref FROM taxonomie.taxref WHERE cd_nom = id;
	END IF;
	return r;
  END;
]]></definition>
</function>

<function name="couleur_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="text"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<parameter name="maxdateobs">
		<type name="date"/>
	</parameter>
	<definition><![CDATA[
  DECLARE
  couleur text;
  patri boolean;
  BEGIN
    SELECT filtre2 INTO patri 
    FROM taxonomie.bib_taxons
    WHERE id_taxon = id;
	IF patri = 'oui' THEN
		IF date_part('year',maxdateobs)=date_part('year',now()) THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSIF patri = 'non' THEN
		IF date_part('year',maxdateobs)>=date_part('year',now())-3 THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSE
	return false;	
	END IF;
	return couleur;
  END;
]]></definition>
</function>

<function name="insert_fiche_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
------- si le pointage est deja dans la BDD alors le trigger retourne null (l'insertion de la ligne est annulée).
IF new.id_cf in (SELECT id_cf FROM contactfaune.t_fiches_cf) THEN	
	return null;
ELSE
	new.date_insert= 'now';
	new.date_update= 'now';
-------gestion des infos relatives a la numerisation (srid utilisé et support utilisé : nomade ou web ou autre)
	IF new.saisie_initiale = 'pda' OR new.saisie_initiale = 'nomade' THEN
		new.srid_dessin = 2154;
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
	ELSIF new.saisie_initiale = 'web' THEN
		new.srid_dessin = 3857;
		-- attention : pas de creation des geom 2154 car c'est fait par l'application web
	ELSIF new.saisie_initiale ISNULL THEN
		new.srid_dessin = 0;
		-- pas d'info sur le srid utilisé, cas des importations à gérer manuellement. Ne devrait pas exister.
	END IF;
-------gestion des divers control avec attributions des secteurs + communes : dans le cas d'un insert depuis le nomade uniquement via the_geom !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;
	RETURN NEW; 			
END IF;
END;
]]></definition>
</function>

<function name="insert_releve_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
cdnom integer;
re integer;
unite integer;
nbobs integer;
line record;
fiche record;
BEGIN
    --récup du cd_nom du taxon
	SELECT INTO cdnom cd_nom FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
    --récup du cd_ref du taxon pour le stocker en base au moment de l'enregistrement (= conseil inpn)
	SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
	new.cd_ref_origine = re;
    -- MAJ de la table cor_unite_taxon, on commence par récupérer l'unité à partir du pointage (table t_fiches_cf)
	SELECT INTO fiche * FROM contactfaune.t_fiches_cf WHERE id_cf = new.id_cf;
	SELECT INTO unite u.id_unite_geo FROM layers.l_unites_geo u WHERE ST_INTERSECTS(fiche.the_geom_2154,u.the_geom);
	--si on est dans une des unités on peut mettre à jour la table cor_unite_taxon, sinon on fait rien
	IF unite>0 THEN
		SELECT INTO line * FROM contactfaune.cor_unite_taxon WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		--si la ligne existe dans cor_unite_taxon on la supprime
		IF line IS NOT NULL THEN
			DELETE FROM contactfaune.cor_unite_taxon WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		END IF;
		--on compte le nombre d'enregistrement pour ce taxon dans l'unité
		SELECT INTO nbobs count(*) from synthese.syntheseff s
		JOIN layers.l_unites_geo u ON ST_Intersects(u.the_geom, s.the_geom_2154) AND u.id_unite_geo = unite
		WHERE s.cd_nom = cdnom;
		--on créé ou recréé la ligne
		INSERT INTO contactfaune.cor_unite_taxon VALUES(unite,new.id_taxon,fiche.dateobs,contactfaune.couleur_taxon(new.id_taxon,fiche.dateobs), nbobs+1);
	END IF;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_delete_releve_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    idsource integer;
BEGIN
    --SUPRESSION EN SYNTHESE
    
    SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' ;
    
	DELETE FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = old.id_releve_cf::text; 
    RETURN OLD; 
END;
]]></definition>
</function>

<function name="synthese_insert_releve_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	fiche RECORD;
	mesobservateurs character varying(255);
	criteresynthese integer;
	idsource integer;
	idsourcem integer;
	idsourcecf integer;
	unite integer;
BEGIN
	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsourcem id_source FROM synthese.bib_sources  WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' AND nom_source = 'Mortalité';
	SELECT INTO idsourcecf id_source FROM synthese.bib_sources  WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' AND nom_source = 'Contact faune';
	--Récupération des données dans la table t_fiches_cf et de la liste des observateurs
	SELECT INTO fiche * FROM contactfaune.t_fiches_cf WHERE id_cf = new.id_cf;
	SELECT INTO criteresynthese id_critere_synthese FROM contactfaune.bib_criteres_cf WHERE id_critere_cf = new.id_critere_cf;
	-- Récupération du id_source selon le critère d'observation, Si critère = 2 alors on est dans une source mortalité (=2) sinon cf (=1)
	IF criteresynthese = 2 THEN idsource = idsourcem;
	ELSE
	    idsource = idsourcecf;
	END IF;
	SELECT INTO mesobservateurs o.observateurs FROM contactfaune.t_releves_cf r
	JOIN contactfaune.t_fiches_cf f ON f.id_cf = r.id_cf
	LEFT JOIN (
                SELECT id_cf, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
                FROM contactfaune.cor_role_fiche_cf c
                JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
                GROUP BY id_cf
            ) o ON o.id_cf = f.id_cf
	WHERE r.id_releve_cf = new.id_releve_cf;
	
	INSERT INTO synthese.syntheseff (
		id_source,
		id_fiche_source,
		code_fiche_source,
		id_organisme,
		id_protocole,
		id_precision,
		cd_nom,
		insee,
		dateobs,
		observateurs,
		determinateur,
		altitude_retenue,
		remarques,
		derniere_action,
		supprime,
		the_geom_3857,
		the_geom_2154,
		the_geom_point,
		id_lot,
		id_critere_synthese,
		effectif_total
	)
	VALUES(
	idsource,
	new.id_releve_cf,
	'f'||new.id_cf||'-r'||new.id_releve_cf,
	fiche.id_organisme,
	fiche.id_protocole,
	1,
	new.cd_ref_origine,
	fiche.insee,
	fiche.dateobs,
	mesobservateurs,
    new.determinateur,
	fiche.altitude_retenue,
	new.commentaire,
	'c',
	false,
	fiche.the_geom_3857,
	fiche.the_geom_2154,
	fiche.the_geom_3857,
	fiche.id_lot,
	criteresynthese,
	new.am+new.af+new.ai+new.na+new.jeune+new.yearling+new.sai
	);
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_cor_role_fiche_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    releves RECORD;
    test integer;
    mesobservateurs character varying(255);
    sources RECORD;
    idsource integer;
    idsourcem integer;
    idsourcecf integer;
BEGIN
    --
    --CE TRIGGER NE DEVRAIT SERVIR QU'EN CAS DE MISE A JOUR MANUELLE SUR CETTE TABLE cor_role_fiche_cf
    --L'APPLI WEB ET LES TABLETTES NE FONT QUE DES INSERTS QUI SONT GERER PAR LE TRIGGER INSERT DE t_releves_cf
    --
        --on doit boucler pour récupérer le id_source car il y en a 2 possibles (cf et mortalité) pour le même schéma
    FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' LOOP
        IF sources.url = 'cf' THEN
            idsourcecf = sources.id_source;
        ELSIF sources.url = 'mortalite' THEN
            idsourcem = sources.id_source;
        END IF;
    END LOOP;
    
    --Récupération des enregistrements de la table t_releves_cf avec l'id_cf de la table cor_role_fiche_cf
    FOR releves IN SELECT * FROM contactfaune.t_releves_cf WHERE id_cf = new.id_cf LOOP
        --test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
        SELECT INTO test id_fiche_source FROM synthese.syntheseff 
        WHERE (id_source = idsourcem OR id_source = idsourcecf) AND id_fiche_source = releves.id_releve_cf::text;
        IF test ISNULL THEN
            RETURN null;
        ELSE
            SELECT INTO mesobservateurs o.observateurs FROM contactfaune.t_releves_cf r
            JOIN contactfaune.t_fiches_cf f ON f.id_cf = r.id_cf
            LEFT JOIN (
                SELECT id_cf, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
                FROM contactfaune.cor_role_fiche_cf c
                JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
                GROUP BY id_cf
            ) o ON o.id_cf = f.id_cf
            WHERE r.id_releve_cf = releves.id_releve_cf;
            --mise à jour de l'enregistrement correspondant dans syntheseff ; uniquement le champ observateurs ici
            UPDATE synthese.syntheseff SET
                observateurs = mesobservateurs
            WHERE (id_source = idsourcem OR id_source = idsourcecf) AND id_fiche_source = releves.id_releve_cf::text; 
        END IF;
    END LOOP;
    RETURN NEW; 
END;
]]></definition>
</function>

<function name="synthese_update_fiche_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    releves RECORD;
    test integer;
    mesobservateurs character varying(255);
    sources RECORD;
    idsourcem integer;
    idsourcecf integer;
BEGIN

    --on doit boucler pour récupérer le id_source car il y en a 2 possibles (cf et mortalité) pour le même schéma
    FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' LOOP
	IF sources.url = 'cf' THEN
	    idsourcecf = sources.id_source;
	ELSIF sources.url = 'mortalite' THEN
	    idsourcem = sources.id_source;
	END IF;
    END LOOP;
	--Récupération des données de la table t_releves_cf avec l'id_cf de la fiche modifié
	-- Ici on utilise le OLD id_cf pour être sur qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_fiches_cf
	--le trigger met à jour avec le NEW --> SET code_fiche_source =  ....
	FOR releves IN SELECT * FROM contactfaune.t_releves_cf WHERE id_cf = old.id_cf LOOP
		--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
		SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_fiche_source = releves.id_releve_cf::text AND (id_source = idsourcecf OR id_source = idsourcem);
		IF test IS NOT NULL THEN
			SELECT INTO mesobservateurs o.observateurs FROM contactfaune.t_releves_cf r
			JOIN contactfaune.t_fiches_cf f ON f.id_cf = r.id_cf
			LEFT JOIN (
				SELECT id_cf, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
				FROM contactfaune.cor_role_fiche_cf c
				JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
				GROUP BY id_cf
			) o ON o.id_cf = f.id_cf
			WHERE r.id_releve_cf = releves.id_releve_cf;
			IF NOT St_Equals(new.the_geom_3857,old.the_geom_3857) OR NOT St_Equals(new.the_geom_2154,old.the_geom_2154) THEN
				
				--mise à jour de l'enregistrement correspondant dans syntheseff
				UPDATE synthese.syntheseff SET
				code_fiche_source = 'f'||new.id_cf||'-r'||releves.id_releve_cf,
				id_organisme = new.id_organisme,
				id_protocole = new.id_protocole,
				insee = new.insee,
				dateobs = new.dateobs,
				observateurs = mesobservateurs,
				altitude_retenue = new.altitude_retenue,
				derniere_action = 'u',
				supprime = new.supprime,
				the_geom_3857 = new.the_geom_3857,
				the_geom_2154 = new.the_geom_2154,
				the_geom_point = new.the_geom_3857,
				id_lot = new.id_lot
				WHERE id_fiche_source = releves.id_releve_cf::text AND (id_source = idsourcecf OR id_source = idsourcem) ;
			ELSE
				--mise à jour de l'enregistrement correspondant dans syntheseff
				UPDATE synthese.syntheseff SET
				code_fiche_source = 'f'||new.id_cf||'-r'||releves.id_releve_cf,
				id_organisme = new.id_organisme,
				id_protocole = new.id_protocole,
				insee = new.insee,
				dateobs = new.dateobs,
				observateurs = mesobservateurs,
				altitude_retenue = new.altitude_retenue,
				derniere_action = 'u',
				supprime = new.supprime,
				the_geom_3857 = new.the_geom_3857,
				the_geom_2154 = new.the_geom_2154,
				the_geom_point = new.the_geom_3857,
				id_lot = new.id_lot
			    WHERE id_fiche_source = releves.id_releve_cf::text AND (id_source = idsourcecf OR id_source = idsourcem);
			END IF;
		END IF;
	END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_releve_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    test integer;
    criteresynthese integer;
    sources RECORD;
    idsourcem integer;
    idsourcecf integer;
BEGIN
    
	--on doit boucler pour récupérer le id_source car il y en a 2 possibles (cf et mortalité) pour le même schéma
        FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactfaune' AND db_field = 'id_releve_cf' LOOP
	    IF sources.url = 'cf' THEN
	        idsourcecf = sources.id_source;
	    ELSIF sources.url = 'mortalite' THEN
	        idsourcem = sources.id_source;
	    END IF;
        END LOOP;
	--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
	SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_fiche_source = old.id_releve_cf::text AND (id_source = idsourcecf OR id_source = idsourcem);
	IF test IS NOT NULL THEN
		SELECT INTO criteresynthese id_critere_synthese FROM contactfaune.bib_criteres_cf WHERE id_critere_cf = new.id_critere_cf;

		--mise à jour de l'enregistrement correspondant dans syntheseff
		UPDATE synthese.syntheseff SET
			id_fiche_source = new.id_releve_cf,
			code_fiche_source = 'f'||new.id_cf||'-r'||new.id_releve_cf,
			cd_nom = new.cd_ref_origine,
			remarques = new.commentaire,
			determinateur = new.determinateur,
			derniere_action = 'u',
			supprime = new.supprime,
			id_critere_synthese = criteresynthese,
			effectif_total = new.am+new.af+new.ai+new.na+new.jeune+new.yearling+new.sai
		WHERE id_fiche_source = old.id_releve_cf::text AND (id_source = idsourcecf OR id_source = idsourcem); -- Ici on utilise le OLD id_releve_cf pour être sur 
		--qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_releves_cf
		--le trigger met à jour avec le NEW --> SET id_fiche_source = new.id_releve_cf
	END IF;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_fiche_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
-------------------------- gestion des infos relatives a la numerisation (srid utilisé et support utilisé : pda ou web ou sig)
-------------------------- attention la saisie sur le web réalise un insert sur qq données mais the_geom_3857 est "faussement inséré" par un update !!!
IF (NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL))
  OR (NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL)) 
   THEN
	IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) THEN
		new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;
	ELSIF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) THEN
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
	END IF;
-------gestion des divers control avec attributions de la commune : dans le cas d'un insert depuis le nomade uniquement via the_geom_2154 !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune (celle qui contient le plus de zp en surface)...
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;				
END IF;
--- divers update
IF new.altitude_saisie <> old.altitude_saisie THEN
   new.altitude_retenue = new.altitude_saisie;
END IF;
new.date_update = 'now';
IF new.supprime <> old.supprime THEN	 
  IF new.supprime = 't' THEN
     update contactfaune.t_releves_cf set supprime = 't' WHERE id_cf = old.id_cf; 
  END IF;
  IF new.supprime = 'f' THEN
     update contactfaune.t_releves_cf set supprime = 'f' WHERE id_cf = old.id_cf; 
  END IF;
END IF;
RETURN NEW; 
END;
]]></definition>
</function>

<function name="update_releve_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	re integer;
BEGIN
   -- Si changement de taxon, 
	IF new.id_taxon<>old.id_taxon THEN
	   -- Correction du cd_ref_origine
		SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
		new.cd_ref_origine = re;
	END IF;
RETURN NEW;			
END;
]]></definition>
</function>

<function name="couleur_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="text"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<parameter name="maxdateobs">
		<type name="date"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de renvoyer la couleur d'un taxon à partir de la dernière date d'observation 
--
--Gil DELUERMOZ mars 2012

  DECLARE
  couleur text;
  patri character(3);
  BEGIN
    SELECT filtre2 INTO patri 
    FROM taxonomie.bib_taxons
    WHERE id_taxon = id;
	IF patri = 'oui' THEN
		IF date_part('year',maxdateobs)=date_part('year',now()) THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSIF patri = 'non' THEN
		IF date_part('year',maxdateobs)>=date_part('year',now())-3 THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSE
	return false;	
	END IF;
	return couleur;
  END;
]]></definition>
</function>

<function name="insert_fiche_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
------- si le pointage est deja dans la BDD alors le trigger retourne null (l'insertion de la ligne est annulée).
IF new.id_inv in (SELECT id_inv FROM contactinv.t_fiches_inv) THEN	
	return null;
ELSE
	new.date_insert= 'now';
	new.date_update= 'now';
-------gestion des infos relatives a la numerisation (srid utilisé et support utilisé : nomade ou web ou autre)
	IF new.saisie_initiale = 'pda' OR new.saisie_initiale = 'nomade' THEN
		new.srid_dessin = 2154;
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
	ELSIF new.saisie_initiale = 'web' THEN
		new.srid_dessin = 3857;
		-- attention : pas de creation du geom 2154 car c'est fait par l'application web
	ELSIF new.saisie_initiale ISNULL THEN
		new.srid_dessin = 0;
		-- pas d'info sur le srid utilisé, cas des importations à gérer manuellement. Ne devrait pas exister.
	END IF;
-------gestion des divers control avec attributions des secteurs + communes : dans le cas d'un insert depuis le nomade uniquement via the_geom !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune (celle qui contient le plus de zp en surface)...
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;
	RETURN NEW; 			
END IF;
END;
]]></definition>
</function>

<function name="insert_releve_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
cdnom integer;
re integer;
unite integer;
nbobs integer;
line record;
fiche record;
BEGIN
    --récup du cd_nom du taxon
	SELECT INTO cdnom cd_nom FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
    --récup du cd_ref du taxon pour le stocker en base au moment de l'enregistrement (= conseil inpn)
	SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
	new.cd_ref_origine = re;
    -- MAJ de la table cor_unite_taxon_inv, on commence par récupérer l'unité à partir du pointage (table t_fiches_inv)
	SELECT INTO fiche * FROM contactinv.t_fiches_inv WHERE id_inv = new.id_inv;
	SELECT INTO unite u.id_unite_geo FROM layers.l_unites_geo u WHERE ST_INTERSECTS(fiche.the_geom_2154,u.the_geom);
	--si on est dans une des unités on peut mettre à jour la table cor_unite_taxon_inv, sinon on fait rien
	IF unite>0 THEN
		SELECT INTO line * FROM contactinv.cor_unite_taxon_inv WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		--si la ligne existe dans cor_unite_taxon_inv on la supprime
		IF line IS NOT NULL THEN
			DELETE FROM contactinv.cor_unite_taxon_inv WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		END IF;
		--on compte le nombre d'enregistrement pour ce taxon dans l'unité
		SELECT INTO nbobs count(*) from synthese.syntheseff s
		JOIN layers.l_unites_geo u ON ST_Intersects(u.the_geom, s.the_geom_2154) AND u.id_unite_geo = unite
		WHERE s.cd_nom = cdnom;
		--on créé ou recréé la ligne
		INSERT INTO contactinv.cor_unite_taxon_inv VALUES(unite,new.id_taxon,fiche.dateobs,contactinv.couleur_taxon(new.id_taxon,fiche.dateobs), nbobs+1);
	END IF;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_delete_releve_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    idsource integer;
BEGIN
    
    SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactinv' AND db_field = 'id_releve_inv' ;
    
    --SUPRESSION EN SYNTHESE
	DELETE FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = old.id_releve_inv::text; 
    RETURN OLD; 
END;
]]></definition>
</function>

<function name="synthese_insert_releve_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	fiche RECORD;
	test integer;
	criteresynthese integer;
	mesobservateurs character varying(255);
	unite integer;
	idsource integer;
BEGIN

	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactinv' AND db_field = 'id_releve_inv';
	
	--Récupération des données dans la table t_fiches_inv et de la liste des observateurs
	SELECT INTO fiche * FROM contactinv.t_fiches_inv WHERE id_inv = new.id_inv;
	SELECT INTO criteresynthese id_critere_synthese FROM contactinv.bib_criteres_inv WHERE id_critere_inv = new.id_critere_inv;
	SELECT INTO mesobservateurs o.observateurs FROM contactinv.t_releves_inv r
	JOIN contactinv.t_fiches_inv f ON f.id_inv = r.id_inv
	LEFT JOIN (
                SELECT id_inv, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
                FROM contactinv.cor_role_fiche_inv c
                JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
                GROUP BY id_inv
            ) o ON o.id_inv = f.id_inv
	WHERE r.id_releve_inv = new.id_releve_inv;
    
	--On fait le INSERT dans syntheseff
	INSERT INTO synthese.syntheseff (
		id_source,
		id_fiche_source,
		code_fiche_source,
		id_organisme,
		id_protocole,
		id_precision,
		cd_nom,
		insee,
		dateobs,
		observateurs,
        determinateur,
		altitude_retenue,
		remarques,
		derniere_action,
		supprime,
		the_geom_3857,
		the_geom_2154,
		the_geom_point,
		id_lot,
		id_critere_synthese,
		effectif_total
	)
	VALUES(
	idsource,
	new.id_releve_inv,
	'f'||new.id_inv||'-r'||new.id_releve_inv,
	fiche.id_organisme,
	fiche.id_protocole,
	1,
	new.cd_ref_origine,
	fiche.insee,
	fiche.dateobs,
	mesobservateurs,
    new.determinateur,
	fiche.altitude_retenue,
	new.commentaire,
	'c',
	false,
	fiche.the_geom_3857,
	fiche.the_geom_2154,
	fiche.the_geom_3857,
	fiche.id_lot,
	criteresynthese,
	new.am+new.af+new.ai+new.na
	);
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_cor_role_fiche_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	releves RECORD;
	test integer;
	mesobservateurs character varying(255);
    idsource integer;
BEGIN
	--
	--CE TRIGGER NE DEVRAIT SERVIR QU'EN CAS DE MISE A JOUR MANUELLE SUR CETTE TABLE cor_role_fiche_inv
	--L'APPLI WEB ET LE PDA NE FONT QUE DES INSERTS QUI SONT GERER PAR LE TRIGGER INSERT DE t_releves_inv
	--
    
	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactinv' AND db_field = 'id_releve_inv';
    
	--Récupération des enregistrements de la table t_releves_inv avec l'id_inv de la table cor_role_fiche_inv
	FOR releves IN SELECT * FROM contactinv.t_releves_inv WHERE id_inv = new.id_inv LOOP
		--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
		SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = releves.id_releve_inv::text;
		IF test ISNULL THEN
		RETURN null;
		ELSE
			SELECT INTO mesobservateurs o.observateurs FROM contactinv.t_releves_inv r
			JOIN contactinv.t_fiches_inv f ON f.id_inv = r.id_inv
			LEFT JOIN (
				SELECT id_inv, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
				FROM contactinv.cor_role_fiche_inv c
				JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
				GROUP BY id_inv
			) o ON o.id_inv = f.id_inv
			WHERE r.id_releve_inv = releves.id_releve_inv;
			--mise à jour de l'enregistrement correspondant dans syntheseff ; uniquement le champ observateurs ici
			UPDATE synthese.syntheseff SET
				observateurs = mesobservateurs
			WHERE id_source = idsource AND id_fiche_source = releves.id_releve_inv::text; 
		END IF;
	END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_fiche_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	releves RECORD;
	test integer;
	mesobservateurs character varying(255);
    idsource integer;
BEGIN

    
	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactinv' AND db_field = 'id_releve_inv';
    
	--Récupération des données de la table t_releves_inv avec l'id_inv de la fiche modifié
	-- Ici on utilise le OLD id_inv pour être sur qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_fiches_inv
	--le trigger met à jour avec le NEW --> SET code_fiche_source =  ....
	FOR releves IN SELECT * FROM contactinv.t_releves_inv WHERE id_inv = old.id_inv LOOP
		--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
		SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = releves.id_releve_inv::text;
		IF test IS NOT NULL THEN
			SELECT INTO mesobservateurs o.observateurs FROM contactinv.t_releves_inv r
			JOIN contactinv.t_fiches_inv f ON f.id_inv = r.id_inv
			LEFT JOIN (
				SELECT id_inv, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
				FROM contactinv.cor_role_fiche_inv c
				JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
				GROUP BY id_inv
			) o ON o.id_inv = f.id_inv
			WHERE r.id_releve_inv = releves.id_releve_inv;
            
			IF NOT St_Equals(new.the_geom_3857,old.the_geom_3857) OR NOT St_Equals(new.the_geom_2154,old.the_geom_2154) THEN
			--mise à jour de l'enregistrement correspondant dans syntheseff
				UPDATE synthese.syntheseff SET
					code_fiche_source = 'f'||new.id_inv||'-r'||releves.id_releve_inv,
					id_organisme = new.id_organisme,
					id_protocole = new.id_protocole,
					insee = new.insee,
					dateobs = new.dateobs,
					observateurs = mesobservateurs,
					altitude_retenue = new.altitude_retenue,
					derniere_action = 'u',
					supprime = new.supprime,
					the_geom_3857 = new.the_geom_3857,
					the_geom_2154 = new.the_geom_2154,
					the_geom_point = new.the_geom_3857,
					id_lot = new.id_lot
				WHERE id_source = idsource AND id_fiche_source = releves.id_releve_inv::text;
			ELSE
				UPDATE synthese.syntheseff SET
					code_fiche_source = 'f'||new.id_inv||'-r'||releves.id_releve_inv,
					id_organisme = new.id_organisme,
					id_protocole = new.id_protocole,
					insee = new.insee,
					dateobs = new.dateobs,
					observateurs = mesobservateurs,
					altitude_retenue = new.altitude_retenue,
					derniere_action = 'u',
					supprime = new.supprime,
					the_geom_3857 = new.the_geom_3857,
					the_geom_2154 = new.the_geom_2154,
					the_geom_point = new.the_geom_3857,
					id_lot = new.id_lot
				WHERE id_source = idsource AND id_fiche_source = releves.id_releve_inv::text;
			END IF;
		END IF;
	END LOOP;
	RETURN NEW;
END;
]]></definition>
</function>

<function name="synthese_update_releve_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	test integer;
	criteresynthese integer;
	mesobservateurs character varying(255);
    idsource integer;
BEGIN

	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactinv' AND db_field = 'id_releve_inv';
    
	--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
	SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = old.id_releve_inv::text;
	IF test IS NOT NULL THEN
		--Récupération des données dans la table t_fiches_inv et de la liste des observateurs
		SELECT INTO criteresynthese id_critere_synthese FROM contactinv.bib_criteres_inv WHERE id_critere_inv = new.id_critere_inv;

		--mise à jour de l'enregistrement correspondant dans syntheseff
		UPDATE synthese.syntheseff SET
			id_fiche_source = new.id_releve_inv,
			code_fiche_source = 'f'||new.id_inv||'-r'||new.id_releve_inv,
			cd_nom = new.cd_ref_origine,
			remarques = new.commentaire,
            determinateur = new.determinateur,
			derniere_action = 'u',
			supprime = new.supprime,
			id_critere_synthese = criteresynthese,
			effectif_total = new.am+new.af+new.ai+new.na
		WHERE id_source = idsource AND id_fiche_source = old.id_releve_inv::text; -- Ici on utilise le OLD id_releve_inv pour être sur 
		--qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_releves_inv
		--le trigger met à jour avec le NEW --> SET id_fiche_source = new.id_releve_inv
	END IF;
	RETURN NEW;
END;
]]></definition>
</function>

<function name="update_fiche_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
-------------------------- gestion des infos relatives a la numerisation (srid utilisé et support utilisé : pda ou web ou sig)
-------------------------- attention la saisie sur le web réalise un insert sur qq données mais the_geom_3857 est "faussement inséré" par un update !!!
IF (NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL))
  OR (NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL)) 
   THEN
	IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) THEN
		new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;
	ELSIF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) THEN
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
	END IF;

-------gestion des divers control avec attributions de la commune : dans le cas d'un insert depuis le nomade uniquement via the_geom_2154 !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune (celle qui contient le plus de zp en surface)...
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;	
END IF;
-- divers update
IF new.altitude_saisie <> old.altitude_saisie THEN
   new.altitude_retenue = new.altitude_saisie;
END IF;
new.date_update = 'now';
IF new.supprime <> old.supprime THEN	 
  IF new.supprime = 't' THEN
     update contactinv.t_releves_inv set supprime = 't' WHERE id_inv = old.id_inv; 
  END IF;
  IF new.supprime = 'f' THEN
     update contactfaune.t_releves_inv set supprime = 'f' WHERE id_inv = old.id_inv; 
  END IF;
END IF;
RETURN NEW; 
END;
]]></definition>
</function>

<function name="update_releve_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	re integer;
BEGIN
   -- Si changement de taxon, 
	IF new.id_taxon<>old.id_taxon THEN
	   -- Correction du cd_ref_origine
		SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
		new.cd_ref_origine = re;
	END IF;
RETURN NEW;			
END;
]]></definition>
</function>

<function name="bryophytes_insert"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[

BEGIN

new.date_insert= 'now';	 -- mise a jour de date insert
new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
new.insee = layers.f_insee(new.the_geom_2154);-- mise a jour du code insee
new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig


IF new.altitude_saisie is null or new.altitude_saisie = 0 then -- mis à jour de l'altitude retenue
  new.altitude_retenue = new.altitude_sig;
ELSE
  new.altitude_retenue = new.altitude_saisie;
END IF;

RETURN new; -- return new procède à l'insertion de la donnée dans PG avec les nouvelles valeures.			

END;
]]></definition>
</function>

<function name="bryophytes_update"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
IF (NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL))
  OR (NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL)) 
   THEN

	IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) THEN
		new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;
	ELSIF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) THEN
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
	END IF;

        new.insee = layers.f_insee(new.the_geom_2154);-- mise à jour du code insee
        new.altitude_sig = layers.f_isolines20(new.the_geom_2154); --mise à jour de l'altitude_sig

END IF;

IF (new.altitude_saisie <> old.altitude_saisie OR old.altitude_saisie is null OR new.altitude_saisie is null OR old.altitude_saisie=0 OR new.altitude_saisie=0) then  -- mis à jour de l'altitude retenue
	BEGIN
		if new.altitude_saisie is null or new.altitude_saisie = 0 then
			new.altitude_retenue = layers.f_isolines20(new.the_geom_2154);
		else
			new.altitude_retenue = new.altitude_saisie;
		end if;
	END;	
END IF;

new.date_update= 'now';	 -- mise a jour de date insert

RETURN new; -- return new procède à l'insertion de la donnée dans PG avec les nouvelles valeures.			
END;
]]></definition>
</function>

<function name="delete_synthese_cor_bryo_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
--il n'y a pas de trigger delete sur la table t_stations_fs parce qu'il un delete cascade dans la fk id_station de cor_fs_taxon
--donc si on supprime la station, on supprime sa ou ces taxons relevés et donc ce trigger sera déclanché et fera le ménage dans la table syntheseff

BEGIN
        --on fait le delete dans syntheseff
        DELETE FROM synthese.syntheseff WHERE id_source = 6 AND id_fiche_source = CAST(old.gid AS VARCHAR(25));
	RETURN old; 			
END;
]]></definition>
</function>

<function name="insert_synthese_cor_bryo_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    fiche RECORD;
    mesobservateurs character varying(255);
BEGIN
    SELECT INTO fiche * FROM bryophytes.t_stations_bryo WHERE id_station = new.id_station;
    --Récupération des données dans la table t_zprospection et de la liste des observateurs	
    SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM bryophytes.cor_bryo_observateur c
    JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
    JOIN bryophytes.t_stations_bryo s ON s.id_station = c.id_station
    WHERE c.id_station = new.id_station;
    
    -- MAJ de la table cor_unite_taxon, on commence par récupérer les zonnes à statuts à partir du pointage (table t_fiches_cf)
    INSERT INTO synthese.syntheseff
    (
      id_source,
      id_fiche_source,
      code_fiche_source,
      id_organisme,
      id_protocole,
      id_precision,
      cd_nom,
      insee,
      dateobs,
      observateurs,
      altitude_retenue,
      remarques,
      derniere_action,
      supprime,
      id_lot,
      the_geom_3857,
      the_geom_2154,
      the_geom_point
    )
    VALUES
    ( 
      6, 
      new.gid,
      'st' || new.id_station || '-' || 'cdnom' || new.cd_nom,
      fiche.id_organisme,
	  fiche.id_protocole,
      1,
      new.cd_nom,
      fiche.insee,
      fiche.dateobs,
      mesobservateurs,
      fiche.altitude_retenue,
      fiche.remarques,
      'c',
      new.supprime,
      fiche.id_lot,
      fiche.the_geom_3857,
      fiche.the_geom_2154,
      fiche.the_geom_3857
    );
	
RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_cor_bryo_observateur"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    monreleve RECORD;
    mesobservateurs character varying(255);
BEGIN
    --Récupération de la liste des observateurs	
    --ici on va mettre à jour l'enregistrement dans syntheseff autant de fois qu'on insert dans cette table
	SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM bryophytes.cor_bryo_observateur c
    JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
    JOIN bryophytes.t_stations_bryo s ON s.id_station = c.id_station
    WHERE c.id_station = new.id_station;
    --on boucle sur tous les enregistrements de la station
    FOR monreleve IN SELECT gid FROM bryophytes.cor_bryo_taxon WHERE id_station = new.id_station  LOOP
        --on fait le update du champ observateurs dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            observateurs = mesobservateurs,
            derniere_action = 'u'
        WHERE id_source = 6 AND id_fiche_source = CAST(monreleve.gid AS VARCHAR(25));
    END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_cor_bryo_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
--On ne fait qq chose que si l'un des champs de la table cor_bryo_taxon concerné dans syntheseff a changé
IF (
        new.id_station <> old.id_station 
        OR new.gid <> old.gid 
        OR new.cd_nom <> old.cd_nom 
        OR new.supprime <> old.supprime 
    ) THEN
    --on fait le update dans syntheseff
    UPDATE synthese.syntheseff 
    SET 
	id_fiche_source = new.gid,
	code_fiche_source = 'st' || new.id_station || '-' || 'cdnom' || new.cd_nom,
	cd_nom = new.cd_nom,
	derniere_action = 'u',
	supprime = new.supprime
    WHERE id_source = 6 AND id_fiche_source = CAST(old.gid AS VARCHAR(25));
END IF;

RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_stations_bryo"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    monreleve RECORD;
BEGIN
FOR monreleve IN SELECT gid, cd_nom FROM bryophytes.cor_bryo_taxon WHERE id_station = new.id_station  LOOP
    --On ne fait qq chose que si l'un des champs de la table t_station_bryo concerné dans syntheseff a changé
    IF (
            new.id_station <> old.id_station 
            OR ((new.remarques <> old.remarques) OR (new.remarques is null and old.remarques is NOT NULL) OR (new.remarques is NOT NULL and old.remarques is null))
            OR ((new.insee <> old.insee) OR (new.insee is null and old.insee is NOT NULL) OR (new.insee is NOT NULL and old.insee is null))
            OR ((new.dateobs <> old.dateobs) OR (new.dateobs is null and old.dateobs is NOT NULL) OR (new.dateobs is NOT NULL and old.dateobs is null))
            OR ((new.altitude_retenue <> old.altitude_retenue) OR (new.altitude_retenue is null and old.altitude_retenue is NOT NULL) OR (new.altitude_retenue is NOT NULL and old.altitude_retenue is null))
        ) THEN
        --on fait le update dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            code_fiche_source = 'st' || new.id_station || '-' || 'cdnom' || monreleve.cd_nom,
            insee = new.insee,
            dateobs = new.dateobs,
            altitude_retenue = new.altitude_retenue,
            remarques = new.remarques,
            derniere_action = 'u',
            the_geom_3857 = new.the_geom_3857,
            the_geom_2154 = new.the_geom_2154,
            the_geom_point = new.the_geom_3857
        WHERE id_source = 6 AND id_fiche_source = CAST(monreleve.gid AS VARCHAR(25));
    END IF;
END LOOP;
	RETURN NEW; 
END;
]]></definition>
</function>

<function name="delete_synthese_ap"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
--il n'y a pas de trigger delete sur la table t_zprospection parce qu'il un delete cascade dans la fk indexzp de t_apresence
--donc si on supprime la zp, on supprime sa ou ces ap et donc ce trigger sera déclanché et fera le ménage dans la table syntheseff
DECLARE 
    mazp RECORD;
BEGIN
        --on fait le delete dans syntheseff
        DELETE FROM synthese.syntheseff WHERE id_source = 4 AND id_fiche_source = CAST(old.indexap AS VARCHAR(25));
	RETURN old; 			
END;
]]></definition>
</function>

<function name="insert_ap"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
moncentroide geometry;
BEGIN
------ si l'aire de présence est deja dans la BDD alors le trigger retourne null (l'insertion de la ligne est annulée)
IF new.indexap in (SELECT indexap FROM florepatri.t_apresence) THEN   
	RETURN NULL;    
ELSE
------ gestion de la date insert, la date update prend aussi comme valeur cette premiere date insert
	IF new.date_insert ISNULL THEN 
	new.date_insert='now';
	END IF;
	IF new.date_update ISNULL THEN 
	new.date_update='now';
	END IF;

------ gestion des géometries selon l'outil de saisie :
------ Attention !!! La saisie sur le web réalise un insert sur qq données mais the_geom_3857 est "faussement inséré" par un update !!!
	IF new.the_geom_3857 IS NOT NULL THEN -- saisie web avec the_geom_3857
		new.the_geom_2154 = ST_transform(new.the_geom_3857,2154);
	ELSIF new.the_geom_2154 IS NOT NULL THEN	-- saisie avec outil nomade android avec the_geom_2154
		new.the_geom_3857 = ST_transform(new.the_geom_2154,3857);
	END IF;

------ calcul de validité sur la base d'un double control (sur les deux polygones même si on a un seul champ topo_valid)
------ puis gestion des croisements SIG avec les layers altitude et communes en projection Lambert93

	IF ST_isvalid(new.the_geom_2154) AND ST_isvalid(new.the_geom_3857) THEN
		new.topo_valid = 'true';
		new.insee = layers.f_insee(new.the_geom_2154);-- mise a jour du code insee avec la fonction f_insee
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig avec la fonction f_isolines20
		IF new.altitude_saisie IS NULL OR new.altitude_saisie = 0 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE
		new.topo_valid = 'false';
		moncentroide = ST_setsrid(ST_centroid(Box2D(new.the_geom_2154)),2154); -- calcul le centroid de la bbox pour les croisements SIG
		new.insee = layers.f_insee(moncentroide);-- mise a jour du code insee
		new.altitude_sig = layers.f_isolines20(moncentroide); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS NULL OR new.altitude_saisie = 0 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;
----- fin des opérations et return
RETURN NEW;
END IF;
END;
]]></definition>
</function>

<function name="insert_synthese_ap"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    fiche RECORD;
    mesobservateurs character varying(255);
    monidprecision integer;
    mongeompoint geometry;
BEGIN
	SELECT INTO fiche * FROM florepatri.t_zprospection WHERE indexzp = new.indexzp;
    --Récupération des données dans la table t_zprospection et de la liste des observateurs	
	SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM florepatri.cor_zp_obs c
    JOIN utilisateurs.t_roles r ON r.id_role = c.codeobs
    JOIN florepatri.t_zprospection zp ON zp.indexzp = c.indexzp
    WHERE c.indexzp = new.indexzp;
    -- création du geom_point
    IF st_isvalid(new.the_geom_3857) THEN mongeompoint = st_pointonsurface(new.the_geom_3857);
    ELSE mongeompoint = ST_PointFromWKB(st_centroid(Box2D(new.the_geom_3857)),3857);
    END IF;
    -- récupération de la valeur de précision de la géométrie
    IF st_geometrytype(new.the_geom_3857) = 'ST_Point' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiPoint' THEN monidprecision = 1;
    ELSIF st_geometrytype(new.the_geom_3857) = 'ST_LineString' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiLineString' THEN monidprecision = 2;
    ELSIF st_geometrytype(new.the_geom_3857) = 'ST_Polygone' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiPolygon' THEN monidprecision = 3;
    ELSE monidprecision = 12;
    END IF;
    
    -- MAJ de la table cor_unite_taxon, on commence par récupérer les zonnes à statuts à partir du pointage (table t_fiches_cf)
    INSERT INTO synthese.syntheseff
    (
        id_source,
        id_fiche_source,
        code_fiche_source,
        id_organisme,
        id_protocole,
        id_precision,
        cd_nom,
        insee,
        dateobs,
        observateurs,
        altitude_retenue,
        remarques,
        derniere_action,
        supprime,
        id_lot,
        the_geom_3857,
        the_geom_2154,
        the_geom_point
    )
    VALUES( 
        4, 
        new.indexap,
        'zp' || new.indexzp || '-' || 'ap' || new.indexap,
        fiche.id_organisme,
        fiche.id_protocole,
        monidprecision,
        fiche.cd_nom,
        new.insee,
        fiche.dateobs,
        mesobservateurs,
        new.altitude_retenue,
        new.remarques,
        'c',
        new.supprime,
        fiche.id_lot,
        new.the_geom_3857,
        new.the_geom_2154,
        mongeompoint);
	
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="insert_zp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
monsectfp integer;
macommune character(5);
moncentroide geometry;
BEGIN
------ si la zone de prospection est deja dans la BDD alors le trigger retourne null
------ (l'insertion de la ligne est annulée et on passe a la donnée suivante).
IF new.indexzp in (SELECT indexzp FROM florepatri.t_zprospection) THEN
	RETURN NULL;
ELSE
------ gestion de la date insert, la date update prend aussi comme valeur cette premiere date insert
	IF new.date_insert IS NULL THEN 
		new.date_insert='now';
	END IF;
	IF new.date_update IS NULL THEN
		new.date_update='now';
	END IF;

------ gestion de la source des géometries selon l'outil de saisie :
    IF new.saisie_initiale = 'nomade' THEN
		new.srid_dessin = 2154;
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
	ELSIF new.saisie_initiale = 'web' THEN
		new.srid_dessin = 3857;
		-- attention : pas de calcul sur les geoemtry car "the_geom_3857" est inseré par le trigger update !!
	ELSIF new.saisie_initiale IS NULL THEN
		new.srid_dessin = 0;
		-- pas d'info sur le srid utilisé, cas possible des importations de couches SIG, il faudra gérer manuellement !
	END IF;

	------ début de calcul de validité sur la base d'un double control (sur les deux polygones même si on a un seul champ topo_valid)
	------ puis calcul du geom_point_3857 (selon validité de the_geom_3857)
	------ puis gestion des croisements SIG avec les layers secteur et communes en projection Lambert93
		IF ST_isvalid(new.the_geom_2154) AND ST_isvalid(new.the_geom_3857) THEN
			new.topo_valid = 'true';
			-- calcul du geom_point_3857 
			new.geom_point_3857 = ST_pointonsurface(new.the_geom_3857);  -- calcul du point pour le premier niveau de zoom appli web
			-- croisement secteur (celui qui contient le plus de zp en surface)
			SELECT INTO monsectfp ls.id_secteur FROM layers.l_secteurs ls WHERE ST_intersects(ls.the_geom, new.the_geom_2154)
			ORDER BY ST_area(ST_intersection(ls.the_geom, new.the_geom_2154)) DESC LIMIT 1;
			-- croisement commune (celle qui contient le plus de zp en surface)
			SELECT INTO macommune lc.insee FROM layers.l_communes lc WHERE ST_intersects(lc.the_geom, new.the_geom_2154)
			ORDER BY ST_area(ST_intersection(lc.the_geom, new.the_geom_2154)) DESC LIMIT 1;
		ELSE
			new.topo_valid = 'false';
			-- calcul du geom_point_3857
			new.geom_point_3857 = ST_setsrid(ST_centroid(Box2D(new.the_geom_3857)),3857);  -- calcul le centroid de la bbox pour premier niveau de zoom appli web
			moncentroide = ST_setsrid(ST_centroid(Box2D(new.the_geom_2154)),2154); -- calcul le centroid de la bbox pour les croisements SIG
			-- croisement secteur (celui qui contient moncentroide)
			SELECT INTO monsectfp ls.id_secteur FROM layers.l_secteurs ls WHERE ST_intersects(ls.the_geom, moncentroide);
			-- croisement commune (celle qui contient moncentroid)
			SELECT INTO macommune lc.insee FROM layers.l_communes lc WHERE ST_intersects(lc.the_geom, moncentroide);
		END IF;
		new.insee = macommune;
		IF monsectfp IS NULL THEN 		-- suite calcul secteur : si la requete sql renvoit null (cad pas d'intersection donc dessin hors zone)
			new.id_secteur = 999;	-- alors on met 999 (hors zone) en code secteur fp
		ELSE
			new.id_secteur = monsectfp; --sinon on met le code du secteur.
		END IF;

		------ calcul du geom_mixte_3857
		IF ST_area(new.the_geom_3857) <10000 THEN	   -- calcul du point (ou de la surface si > 1 hectare) pour le second niveau de zoom appli web
			new.geom_mixte_3857 = new.geom_point_3857;
		ELSE
			new.geom_mixte_3857 = new.the_geom_3857;
		END IF;
		
	------ fin de calcul

------  fin du ELSE et return des valeurs :
	RETURN NEW;
END IF;
END;
]]></definition>
</function>

<function name="letypedegeom"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="character varying"/>
	</return-type>
	<parameter name="mongeom">
		<type name="geometry"/>
	</parameter>
	<definition><![CDATA[

declare
thetype varchar(18);
montype varchar(15);

BEGIN
select st_geometrytype(mongeom) into thetype;
select
	case 	when thetype= 'ST_Polygon'  then 'Polygon'
		when thetype= 'ST_MultiPolygon' then 'Polygon'
		when thetype= 'ST_LineString' then 'LineString'
		when thetype= 'ST_MultiLineString' then 'LineString'
		when thetype= 'ST_Point' then 'Point'
		when thetype= 'ST_MultiPoint' then 'Point'
		into montype
	end;
return montype;

END;
]]></definition>
</function>

<function name="update_ap"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
moncentroide geometry;
BEGIN
------ gestion de la date update en cas de manip sql directement en base ou via l'appli web 
	--IF new.date_update IS NULL THEN
		new.date_update='now';
	--END IF;

-----------------------------------------------------------------------------------------------------------------
/*  section en attente : 
on pourrait verifier le changement des 3 geom pour lancer les commandes de geometries
car pour le moment on ne gere pas les 2 cas de changement sur le geom 2154 ou the geom
code ci dessous a revoir car ST_equals ne marche pas avec les objets invalid

IF 
    (NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 IS null AND new.the_geom_2154 IS NOT NULL))
    OR (NOT ST_Equals(new.the_geom_3857,old.the_geom_3857)OR (old.the_geom_3857 IS null AND new.the_geom_3857 IS NOT NULL)) 
THEN
    IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 IS null AND new.the_geom_3857 IS NOT NULL) THEN
		new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
	ELSIF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 IS null AND new.the_geom_2154 IS NOT NULL) THEN
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
	END IF;
puis suite du THEN
fin de section en attente */ 
------------------------------------------------------------------------------------------------------

------ gestion des infos relatives aux géométries
------ ATTENTION : la saisie en web insert quelques données MAIS the_geom_3857 est "inséré" par une commande update !
------ POUR LE MOMENT gestion des update dans l'appli web uniquement à partir du geom 3857
IF ST_NumGeometries(new.the_geom_3857)=1 THEN	-- si le Multi objet renvoyé par le oueb ne contient qu'un objet
	new.the_geom_3857 = ST_GeometryN(new.the_geom_3857, 1); -- alors on passe en objet simple ( multi vers single)
END IF;

new.the_geom_2154 = ST_transform(new.the_geom_3857,2154);

------ calcul de validité sur la base d'un double control (sur les deux polygones même si on a un seul champ topo_valid)
------ puis gestion des croisements SIG avec les layers altitude et communes en projection Lambert93
IF ST_isvalid(new.the_geom_2154) AND ST_isvalid(new.the_geom_3857) THEN
	new.topo_valid = 'true';
	new.insee = layers.f_insee(new.the_geom_2154);				-- mise a jour du code insee avec la fonction f_insee
	new.altitude_sig = layers.f_isolines20(new.the_geom_2154);		-- mise à jour de l'altitude sig avec la fonction f_isolines20
	IF new.altitude_saisie IS NULL OR new.altitude_saisie = 0 THEN	-- mise à jour de l'altitude retenue
		new.altitude_retenue = new.altitude_sig;
	ELSE
		new.altitude_retenue = new.altitude_saisie;
	END IF;
ELSE
	new.topo_valid = 'false';
	moncentroide = ST_setsrid(ST_centroid(Box2D(new.the_geom_2154)),2154); -- calcul le centroid de la bbox pour les croisements SIG
	new.insee = layers.f_insee(moncentroide);
	new.altitude_sig = layers.f_isolines20(moncentroide);
	IF new.altitude_saisie IS NULL OR new.altitude_saisie = 0 THEN
		new.altitude_retenue = new.altitude_sig;
	ELSE
		new.altitude_retenue = new.altitude_saisie;
	END IF;
END IF;
----- fin des opérations et return
RETURN NEW;
END;
]]></definition>
</function>

<function name="update_synthese_ap"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    monidprecision integer;
    mongeompoint geometry;
BEGIN
--On ne fait qq chose que si l'un des champs de la table t_apresence concerné dans syntheseff a changé
IF (
        new.indexap <> old.indexap 
        OR new.indexzp <> old.indexzp 
        OR ((new.insee <> old.insee) OR (new.insee is null and old.insee is NOT NULL) OR (new.insee is NOT NULL and old.insee is null))
        OR ((new.altitude_retenue <> old.altitude_retenue) OR (new.altitude_retenue is null and old.altitude_retenue is NOT NULL) OR (new.altitude_retenue is NOT NULL and old.altitude_retenue is null))
        OR ((new.remarques <> old.remarques) OR (new.remarques is null and old.remarques is NOT NULL) OR (new.remarques is NOT NULL and old.remarques is null))
        OR new.supprime <> old.supprime 
        OR (NOT ST_EQUALS(new.the_geom_3857,old.the_geom_3857) OR NOT ST_EQUALS(new.the_geom_2154,old.the_geom_2154))
    ) THEN
    -- création du geom_point
    IF st_isvalid(new.the_geom_3857) THEN mongeompoint = st_pointonsurface(new.the_geom_3857);
    ELSE mongeompoint = ST_PointFromWKB(st_centroid(Box2D(new.the_geom_3857)),3857);
    END IF;
    -- récupération de la valeur de précision de la géométrie
    IF st_geometrytype(new.the_geom_3857) = 'ST_Point' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiPoint' THEN monidprecision = 1;
    ELSIF st_geometrytype(new.the_geom_3857) = 'ST_LineString' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiLineString' THEN monidprecision = 2;
    ELSIF st_geometrytype(new.the_geom_3857) = 'ST_Polygone' OR st_geometrytype(new.the_geom_3857) = 'ST_MultiPolygon' THEN monidprecision = 3;
    ELSE monidprecision = 12;
    END IF;
    --on fait le update dans syntheseff
    UPDATE synthese.syntheseff 
	SET 
		id_fiche_source = new.indexap,
		code_fiche_source = 'zp' || new.indexzp || '-' || 'ap' || new.indexap,
		id_precision = monidprecision,
		insee = new.insee,
		altitude_retenue = new.altitude_retenue,
		remarques = new.remarques,
		derniere_action = 'u',
		supprime = new.supprime,
		the_geom_3857 = new.the_geom_3857,
		the_geom_2154 = new.the_geom_2154,
		the_geom_point = mongeompoint
	WHERE id_source = 4 AND id_fiche_source = CAST(old.indexap AS VARCHAR(25));
END IF;

RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_cor_zp_obs"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    mazp RECORD;
    mesobservateurs character varying(255);
BEGIN
    --Récupération de la liste des observateurs	
    --ici on va mettre à jour l'enregistrement dans syntheseff autant de fois qu'on insert dans cette table
	SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM florepatri.cor_zp_obs c
    JOIN utilisateurs.t_roles r ON r.id_role = c.codeobs
    JOIN florepatri.t_zprospection zp ON zp.indexzp = c.indexzp
    WHERE c.indexzp = new.indexzp;
    --on boucle sur tous les enregistrements de la zp
    --si la zp est sans ap, la boucle ne se fait pas
    FOR mazp IN SELECT ap.indexap FROM florepatri.t_zprospection zp JOIN florepatri.t_apresence ap ON ap.indexzp = zp.indexzp WHERE ap.indexzp = new.indexzp  LOOP
        --on fait le update du champ observateurs dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            observateurs = mesobservateurs,
            derniere_action = 'u'
        WHERE id_source = 4 AND id_fiche_source = CAST(mazp.indexap AS VARCHAR(25));
    END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_zp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    mazp RECORD;
BEGIN
FOR mazp IN SELECT ap.indexap FROM florepatri.t_zprospection zp JOIN florepatri.t_apresence ap ON ap.indexzp = zp.indexzp WHERE ap.indexzp = new.indexzp  LOOP
    --On ne fait qq chose que si l'un des champs de la table t_zprospection concerné dans syntheseff a changé
    IF (
            new.indexzp <> old.indexzp 
            OR ((new.cd_nom <> old.cd_nom) OR (new.cd_nom is null and old.cd_nom is NOT NULL) OR (new.cd_nom is NOT NULL and old.cd_nom is null))
            OR ((new.id_organisme <> old.id_organisme) OR (new.id_organisme is null and old.id_organisme is NOT NULL) OR (new.id_organisme is NOT NULL and old.id_organisme is null))
            OR ((new.dateobs <> old.dateobs) OR (new.dateobs is null and old.dateobs is NOT NULL) OR (new.dateobs is NOT NULL and old.dateobs is null))
            OR new.supprime <> old.supprime 
        ) THEN
        --on fait le update dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            code_fiche_source = 'zp' || new.indexzp || '-' || 'ap' || mazp.indexap,
            cd_nom = new.cd_nom,
            id_organisme = new.id_organisme,
            dateobs = new.dateobs,
            derniere_action = 'u',
            supprime = new.supprime
        WHERE id_source = 4 AND id_fiche_source = CAST(mazp.indexap AS VARCHAR(25));
    END IF;
END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_zp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
monsectfp integer;
macommune character(5);
moncentroide geometry;
BEGIN
------ gestion de la date update en cas de manip sql directement en base
	--IF new.date_update IS NULL THEN
		new.date_update='now';
	--END IF;
------ update en cas de passage du champ supprime = TRUE, alors on passe les aires de présence en supprime = TRUE
IF new.supprime = 't' THEN
	UPDATE florepatri.t_apresence SET supprime = 't' WHERE indexzp = old.indexzp; 
END IF;

-----------------------------------------------------------------------------------------------------------------
/*  section en attente : 
on pourrait verifier le changement des 3 geom pour lancer les commandes de geometries
car pour le moment on ne gere pas les 2 cas de changement sur le geom 2154 ou the geom
code ci dessous a revoir car ST_equals ne marche pas avec les objets invalid
 -- on verfie si 1 des 3 geom a changé
IF((old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) OR NOT ST_Equals(new.the_geom_3857,old.the_geom_3857))
OR ((old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) OR NOT ST_Equals(new.the_geom_2154,old.the_geom_2154)) THEN

-- si oui on regarde lequel et on repercute les modif :
	IF (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) OR NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) THEN
		-- verif si on est en multipolygon ou pas : A FAIRE !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
		new.the_geom_2154 = ST_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;	
	ELSIF (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) OR NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) THEN
		new.the_geom_3857 = ST_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
	END IF;
puis suite du THEN...
fin de section en attente */ 
------------------------------------------------------------------------------------------------------

------ gestion des infos relatives aux géométries
------ ATTENTION : la saisie en web insert quelques données MAIS the_geom_3857 est "faussement inséré" par une commande update !
------ POUR LE MOMENT gestion des update dans l'appli web uniquement à partir du geom 3857

IF ST_NumGeometries(new.the_geom_3857)=1 THEN	-- si le Multi objet renvoyé par le oueb ne contient qu'un objet
	new.the_geom_3857 = ST_GeometryN(new.the_geom_3857, 1); -- alors on passe en objet simple ( multi vers single)
END IF;

new.the_geom_2154 = ST_transform(new.the_geom_3857,2154);
new.srid_dessin = 3857;

------ 2) puis on calcul la validité des geom + on refait les calcul du geom_point_3857 + on refait les croisements SIG secteurs + communes
------    c'est la même chose que lors d'un INSERT ( cf trigger insert_zp)
IF ST_isvalid(new.the_geom_2154) AND ST_isvalid(new.the_geom_3857) THEN
	new.topo_valid = 'true';
	-- calcul du geom_point_3857 
	new.geom_point_3857 = ST_pointonsurface(new.the_geom_3857);  -- calcul du point pour le premier niveau de zoom appli web
	-- croisement secteur (celui qui contient le plus de zp en surface)
	SELECT INTO monsectfp ls.id_secteur FROM layers.l_secteurs ls WHERE ST_intersects(ls.the_geom, new.the_geom_2154)
	ORDER BY ST_area(ST_intersection(ls.the_geom, new.the_geom_2154)) DESC LIMIT 1;
	-- croisement commune (celle qui contient le plus de zp en surface)
	SELECT INTO macommune lc.insee FROM layers.l_communes lc WHERE ST_intersects(lc.the_geom, new.the_geom_2154)
	ORDER BY ST_area(ST_intersection(lc.the_geom, new.the_geom_2154)) DESC LIMIT 1;
ELSE
	new.topo_valid = 'false';
	-- calcul du geom_point_3857
	new.geom_point_3857 = ST_setsrid(ST_centroid(Box2D(new.the_geom_3857)),3857);  -- calcul le centroid de la bbox pour premier niveau de zoom appli web
	moncentroide = ST_setsrid(ST_centroid(Box2D(new.the_geom_2154)),2154); -- calcul le centroid de la bbox pour les croisements SIG
	-- croisement secteur (celui qui contient moncentroide)
	SELECT INTO monsectfp ls.id_secteur FROM layers.l_secteurs ls WHERE ST_intersects(ls.the_geom, moncentroide);
	-- croisement commune (celle qui contient moncentroid)
	SELECT INTO macommune lc.insee FROM layers.l_communes lc WHERE ST_intersects(lc.the_geom, moncentroide);
	END IF;
	new.insee = macommune;
	IF monsectfp IS NULL THEN 		-- suite calcul secteur : si la requete sql renvoit null (cad pas d'intersection donc dessin hors zone)
		new.id_secteur = 999;	-- alors on met 999 (hors zone) en code secteur fp
	ELSE
		new.id_secteur = monsectfp; --sinon on met le code du secteur.
END IF;

------ 3) puis calcul du geom_mixte_3857
------    c'est la même chose que lors d'un INSERT ( cf trigger insert_zp)
IF ST_area(new.the_geom_3857) <10000 THEN	   -- calcul du point (ou de la surface si > 1 hectare) pour le second niveau de zoom appli web
	new.geom_mixte_3857 = new.geom_point_3857;
ELSE
	new.geom_mixte_3857 = new.the_geom_3857;
END IF;
------  fin du IF pour les traitemenst sur les geometries

------  fin du trigger et return des valeurs :
	RETURN NEW;
END;
]]></definition>
</function>

<function name="application_rang_sp"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="integer"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de renvoyer le cd_ref au rang espèce d'une sous-espèce, une variété ou une convariété à partir de son cd_nom
--si le cd_nom passé est d'un rang espèce ou supérieur (genre, famille...), la fonction renvoie le cd_ref du même rang que le cd_nom passé en entré
--
--Gil DELUERMOZ septembre 2011

  DECLARE
  rang character(4);
  rangsup character(4);
  ref integer;
  sup integer;
  BEGIN
	SELECT INTO rang id_rang FROM taxonomie.taxref WHERE cd_nom = id;
	IF(rang='SSES' OR rang = 'VAR' OR rang = 'CVAR') THEN
	    IF(rang = 'SSES') THEN
		SELECT INTO ref cd_taxsup FROM taxonomie.taxref WHERE cd_nom = id;
	    END IF;
	    
	    IF(rang = 'VAR' OR rang = 'CVAR') THEN
		SELECT INTO sup cd_taxsup FROM taxonomie.taxref WHERE cd_nom = id;
		SELECT INTO rangsup id_rang FROM taxonomie.taxref WHERE cd_nom = sup;
		IF(rangsup = 'ES') THEN
			SELECT INTO ref cd_ref FROM taxonomie.taxref WHERE cd_nom = sup;
		END IF;
		IF(rangsup = 'SSES') THEN
			SELECT INTO ref cd_taxsup FROM taxonomie.taxref WHERE cd_nom = sup;
		END IF;
	    END IF;
	ELSE
	   SELECT INTO ref cd_ref FROM taxonomie.taxref WHERE cd_nom = id;
	END IF;
	return ref;
  END;
]]></definition>
</function>

<function name="delete_synthese_cor_fs_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
--il n'y a pas de trigger delete sur la table t_stations_fs parce qu'il un delete cascade dans la fk id_station de cor_fs_taxon
--donc si on supprime la station, on supprime sa ou ces taxons relevés et donc ce trigger sera déclanché et fera le ménage dans la table syntheseff

BEGIN
        --on fait le delete dans syntheseff
        DELETE FROM synthese.syntheseff WHERE id_source = 5 AND id_fiche_source = CAST(old.gid AS VARCHAR(25));
	RETURN old; 			
END;
]]></definition>
</function>

<function name="etiquette_utm"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="character"/>
	</return-type>
	<parameter name="mongeom">
		<type name="geometry"/>
	</parameter>
	<definition><![CDATA[
DECLARE
monx char(6);
mony char(7);
monetiquette char(24);
BEGIN
-- on prend le centroid du géom comme ça la fonction marchera avec tous les objets point ligne ou polygon
-- si la longitude en WGS84 degré decimal est < à 6 degrés on est en zone UTM 31
IF ST_x(ST_transform(ST_centroid(mongeom),4326))< 6 then
	monx = CAST(ST_x(ST_transform(ST_centroid(mongeom),32631)) AS integer)as string;
	mony = CAST(ST_y(ST_transform(ST_centroid(mongeom),32631)) AS integer)as string;
	monetiquette = 'UTM31 x:'|| monx || ' y:' || mony;
ELSE
	-- sinon on est en zone UTM 32
	monx = CAST(ST_x(ST_transform(ST_centroid(mongeom),32632)) AS integer)as string;
	mony = CAST(ST_y(ST_transform(ST_centroid(mongeom),32632)) AS integer)as string;
	monetiquette = 'UTM32 x:'|| monx || ' y:' || mony;
END IF;
RETURN monetiquette;
END;
]]></definition>
</function>

<function name="florestation_insert"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[

BEGIN	
new.date_insert= 'now';	 -- mise a jour de date insert
new.date_update= 'now';	 -- mise a jour de date update
--new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
--new.insee = layers.f_insee(new.the_geom_2154);-- mise a jour du code insee
--new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig

--if new.altitude_saisie is null or new.altitude_saisie = 0 then -- mis à jour de l'altitude retenue
  --new.altitude_retenue = new.altitude_sig;
--else
  --new.altitude_retenue = new.altitude_saisie;
--end if;

return new; -- return new procède à l'insertion de la donnée dans PG avec les nouvelles valeures.			

END;
]]></definition>
</function>

<function name="florestation_update"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
--si aucun geom n'existait et qu'au moins un geom est ajouté, on créé les 2 geom
IF (old.the_geom_2154 is null AND old.the_geom_3857 is null) THEN
    IF (new.the_geom_2154 is NOT NULL) THEN
        new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
    END IF;
    IF (new.the_geom_3857 is NOT NULL) THEN
        new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;
    END IF;
    -- on calcul la commune...
    new.insee = layers.f_insee(new.the_geom_2154);-- mise à jour du code insee
    -- on calcul l'altitude
    new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
    IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
        new.altitude_retenue = new.altitude_sig;
    ELSE
        new.altitude_retenue = new.altitude_saisie;
    END IF;
END IF;
--si au moins un geom existait et qu'il a changé on fait une mise à jour
IF (old.the_geom_2154 is NOT NULL OR old.the_geom_3857 is NOT NULL) THEN
    --si c'est le 2154 qui existait on teste s'il a changé
    IF (old.the_geom_2154 is NOT NULL AND new.the_geom_2154 is NOT NULL) THEN
        IF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) THEN
            new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
            new.srid_dessin = 2154;
        END IF;
    END IF;
    --si c'est le 3857 qui existait on teste s'il a changé
    IF (old.the_geom_3857 is NOT NULL AND new.the_geom_3857 is NOT NULL) THEN
        IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) THEN
            new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
            new.srid_dessin = 3857;
        END IF;
    END IF;
    -- on calcul la commune...
    new.insee = layers.f_insee(new.the_geom_2154);-- mise à jour du code insee
    -- on calcul l'altitude
    new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
    IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
        new.altitude_retenue = new.altitude_sig;
    ELSE
        new.altitude_retenue = new.altitude_saisie;
    END IF;
END IF;

IF (new.altitude_saisie <> old.altitude_saisie OR old.altitude_saisie is null OR new.altitude_saisie is null OR old.altitude_saisie=0 OR new.altitude_saisie=0) then  -- mis à jour de l'altitude retenue
	BEGIN
		if new.altitude_saisie is null or new.altitude_saisie = 0 then
			new.altitude_retenue = layers.f_isolines20(new.the_geom_2154);
		else
			new.altitude_retenue = new.altitude_saisie;
		end if;
	END;	
END IF;

new.date_update= 'now';	 -- mise a jour de date insert

RETURN new; -- return new procède à l'insertion de la donnée dans PG avec les nouvelles valeures.			
END;
]]></definition>
</function>

<function name="insert_synthese_cor_fs_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    fiche RECORD;
    mesobservateurs character varying(255);
BEGIN
    SELECT INTO fiche * FROM florestation.t_stations_fs WHERE id_station = new.id_station;
    --Récupération des données dans la table t_zprospection et de la liste des observateurs	
    SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM florestation.cor_fs_observateur c
    JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
    JOIN florestation.t_stations_fs s ON s.id_station = c.id_station
    WHERE c.id_station = new.id_station;
    
    -- MAJ de la table cor_unite_taxon, on commence par récupérer les zonnes à statuts à partir du pointage (table t_fiches_cf)
    INSERT INTO synthese.syntheseff
    (
      id_source,
      id_fiche_source,
      code_fiche_source,
      id_organisme,
      id_protocole,
      id_precision,
      cd_nom,
      insee,
      dateobs,
      observateurs,
      altitude_retenue,
      remarques,
      derniere_action,
      supprime,
      id_lot,
      the_geom_3857,
      the_geom_2154,
      the_geom_point
    )
    VALUES
    ( 
      5, 
      new.gid,
      'st' || new.id_station || '-' || 'cdnom' || new.cd_nom,
      fiche.id_organisme,
      fiche.id_protocole,
      1,
      new.cd_nom,
      fiche.insee,
      fiche.dateobs,
      mesobservateurs,
      fiche.altitude_retenue,
      fiche.remarques,
      'c',
      new.supprime,
      fiche.id_lot,
      fiche.the_geom_3857,
      fiche.the_geom_2154,
      fiche.the_geom_3857
    );
	
RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_cor_fs_observateur"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    monreleve RECORD;
    mesobservateurs character varying(255);
BEGIN
    --Récupération de la liste des observateurs	
    --ici on va mettre à jour l'enregistrement dans syntheseff autant de fois qu'on insert dans cette table
	SELECT INTO mesobservateurs array_to_string(array_agg(r.prenom_role || ' ' || r.nom_role), ', ') AS observateurs 
    FROM florestation.cor_fs_observateur c
    JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
    JOIN florestation.t_stations_fs s ON s.id_station = c.id_station
    WHERE c.id_station = new.id_station;
    --on boucle sur tous les enregistrements de la station
    FOR monreleve IN SELECT gid FROM florestation.cor_fs_taxon WHERE id_station = new.id_station  LOOP
        --on fait le update du champ observateurs dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            observateurs = mesobservateurs,
            derniere_action = 'u'
        WHERE id_source = 5 AND id_fiche_source = CAST(monreleve.gid AS VARCHAR(25));
    END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_cor_fs_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
--On ne fait qq chose que si l'un des champs de la table cor_fs_taxon concerné dans syntheseff a changé
IF (
        new.id_station <> old.id_station 
        OR new.gid <> old.gid 
        OR new.cd_nom <> old.cd_nom 
        OR new.supprime <> old.supprime 
    ) THEN
    --on fait le update dans syntheseff
    UPDATE synthese.syntheseff 
    SET 
	id_fiche_source = new.gid,
	code_fiche_source = 'st' || new.id_station || '-' || 'cdnom' || new.cd_nom,
	cd_nom = new.cd_nom,
	derniere_action = 'u',
	supprime = new.supprime
    WHERE id_source = 5 AND id_fiche_source = CAST(old.gid AS VARCHAR(25));
END IF;

RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_synthese_stations_fs"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE 
    monreleve RECORD;
BEGIN
FOR monreleve IN SELECT gid, cd_nom FROM florestation.cor_fs_taxon WHERE id_station = new.id_station  LOOP
    --On ne fait qq chose que si l'un des champs de la table t_stations_fs concerné dans syntheseff a changé
    IF (
            new.id_station <> old.id_station 
            OR ((new.remarques <> old.remarques) OR (new.remarques is null and old.remarques is NOT NULL) OR (new.remarques is NOT NULL and old.remarques is null))
            OR ((new.insee <> old.insee) OR (new.insee is null and old.insee is NOT NULL) OR (new.insee is NOT NULL and old.insee is null))
            OR ((new.dateobs <> old.dateobs) OR (new.dateobs is null and old.dateobs is NOT NULL) OR (new.dateobs is NOT NULL and old.dateobs is null))
            OR ((new.altitude_retenue <> old.altitude_retenue) OR (new.altitude_retenue is null and old.altitude_retenue is NOT NULL) OR (new.altitude_retenue is NOT NULL and old.altitude_retenue is null))
        ) THEN
        --on fait le update dans syntheseff
        UPDATE synthese.syntheseff 
        SET 
            code_fiche_source = 'st' || new.id_station || '-' || 'cdnom' || monreleve.cd_nom,
            insee = new.insee,
            dateobs = new.dateobs,
            altitude_retenue = new.altitude_retenue,
            remarques = new.remarques,
            derniere_action = 'u',
            the_geom_3857 = new.the_geom_3857,
            the_geom_2154 = new.the_geom_2154,
            the_geom_point = new.the_geom_3857
        WHERE id_source = 5 AND id_fiche_source = CAST(monreleve.gid AS VARCHAR(25));
    END IF;
END LOOP;
	RETURN NEW; 
END;
]]></definition>
</function>

<function name="f_dist_maille_commune"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="real"/>
	</return-type>
	<parameter name="mon_geom">
		<type name="geometry"/>
	</parameter>
	<parameter name="mon_insee">
		<type name="character"/>
	</parameter>
	<definition><![CDATA[
DECLARE
ma_distance real;
ma_commune geometry;
BEGIN
-- vérif si le code insee saisi est bien dans la couche commune
IF mon_insee IN (SELECT insee FROM layers.l_communes) THEN
	-- calcul la distance entre la maille et la commune (vérifie d'abord si la maille intersect la commune)
	SELECT INTO ma_commune lc.the_geom FROM layers.l_communes lc WHERE lc.insee = mon_insee;
	IF ST_Intersects(mon_geom, ma_commune) THEN
		  RETURN  0;		-- on est bon la maille est dans la commune saisie a la main
	ELSE
		 SELECT INTO ma_distance ST_Distance(mon_geom, ma_commune);
		 RETURN ma_distance;
	END IF;
ELSE
	RETURN  -1; -- le code insee saisi est mauvais
END IF;

END
]]></definition>
</function>

<function name="f_insee"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="character"/>
	</return-type>
	<parameter name="mongeom">
		<type name="geometry"/>
	</parameter>
	<definition><![CDATA[
DECLARE
mavariableinsee char(5);
BEGIN

select insee into mavariableinsee from 
layers.l_communes c where st_intersects(c.the_geom, mongeom)= true;

if mavariableinsee ISNULL then
	return null;
else
	return mavariableinsee; 
end if;

END
]]></definition>
</function>

<function name="f_isolines20"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="integer"/>
	</return-type>
	<parameter name="mongeom">
		<type name="geometry"/>
	</parameter>
	<definition><![CDATA[
DECLARE
mavariableiso integer;
BEGIN
select iso into mavariableiso from 
(
select i.iso, st_distance(mongeom, i.the_geom) 
from layers.l_isolines20 i
where mongeom&&i.the_geom  -- && renvoit true quand la bouding box de mon geom intersect la bounding box d'isolines20
order by st_distance asc limit 1
) SR;

if mavariableiso ISNULL then 	
	return  0;
else
	return mavariableiso; 
end if;

END
]]></definition>
</function>

<function name="f_nomcommune"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="character varying"/>
	</return-type>
	<parameter name="mongeom">
		<type name="geometry"/>
	</parameter>
	<definition><![CDATA[
DECLARE
macommmune character varying(40);
BEGIN

select commune_min into macommmune from 
layers.l_communes c where st_intersects(c.the_geom, mongeom)= true;

if macommmune ISNULL then
	return null;
else
	return macommmune; 
end if;

END
]]></definition>
</function>

<function name="calcul_cor_unite_taxon_cf"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="void"/>
	</return-type>
	<parameter name="monidtaxon">
		<type name="integer"/>
	</parameter>
	<parameter name="monunite">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
  DECLARE
  cdnom integer;
  BEGIN
	--récup du cd_nom du taxon
	SELECT INTO cdnom cd_nom FROM taxonomie.bib_taxons WHERE id_taxon = monidtaxon;
	DELETE FROM contactfaune.cor_unite_taxon WHERE id_unite_geo = monunite AND id_taxon = monidtaxon;
	INSERT INTO contactfaune.cor_unite_taxon (id_unite_geo,id_taxon,derniere_date,couleur,nb_obs)
	SELECT monunite, monidtaxon,  max(dateobs) AS derniere_date, contactfaune.couleur_taxon(monidtaxon,max(dateobs)) AS couleur, count(id_synthese) AS nb_obs
	FROM synthese.cor_unite_synthese
	WHERE cd_nom = cdnom
	AND id_unite_geo = monunite;
  END;
]]></definition>
</function>

<function name="calcul_cor_unite_taxon_inv"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="void"/>
	</return-type>
	<parameter name="monidtaxon">
		<type name="integer"/>
	</parameter>
	<parameter name="monunite">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
DECLARE
    cdnom integer;
BEGIN
	--récup du cd_nom du taxon
	SELECT INTO cdnom cd_nom FROM taxonomie.bib_taxons WHERE id_taxon = monidtaxon;
    DELETE FROM contactinv.cor_unite_taxon_inv WHERE id_unite_geo = monunite AND id_taxon = monidtaxon;
	INSERT INTO contactinv.cor_unite_taxon_inv (id_unite_geo,id_taxon,derniere_date,couleur,nb_obs)
	SELECT monunite, monidtaxon,  max(dateobs) AS derniere_date, contactinv.couleur_taxon(monidtaxon,max(dateobs)) AS couleur, count(id_synthese) AS nb_obs
	FROM synthese.cor_unite_synthese
	WHERE cd_nom = cdnom
	AND id_unite_geo = monunite;
END;
]]></definition>
</function>

<function name="insert_syntheseff"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
	new.date_insert= 'now';
	new.date_update= 'now';
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="maj_cor_unite_synthese"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
-- apres travail dans la table synthèsefaune on supprime la donnée correspondante dans la table cor_unite_synthese
IF (TG_OP = 'DELETE') or (TG_OP = 'UPDATE') THEN
	DELETE FROM synthese.cor_unite_synthese WHERE id_synthese = old.id_synthese;
END IF;
-- insert la donnée depuis la table synthèsefaune dans la table cor_unite_synthese :
-- La donnée dans la table synthèsefaune doit etre en supprime = FALSE sinon on ne l'insert pas,
-- S'il n'y a pas d'intersection avec une ou des unité geographique on ne l'insert pas.
IF (TG_OP = 'INSERT') OR (TG_OP = 'UPDATE') THEN
	IF new.supprime = FALSE THEN
		INSERT INTO synthese.cor_unite_synthese (id_synthese, cd_nom, dateobs, id_unite_geo)
		SELECT s.id_synthese, s.cd_nom, s.dateobs,u.id_unite_geo 
        FROM synthese.syntheseff s, layers.l_unites_geo u
		WHERE st_intersects(u.the_geom, s.the_geom_2154) 
		AND s.id_synthese = new.id_synthese;
	END IF;
END IF;	
RETURN NULL;	
END;
]]></definition>
</function>

<function name="maj_cor_unite_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
monembranchement varchar;
monregne varchar;
monidtaxon integer;
BEGIN

IF (TG_OP = 'DELETE') THEN
	--retrouver le id_taxon
	SELECT INTO monidtaxon id_taxon FROM taxonomie.bib_taxons WHERE cd_nom = old.cd_nom LIMIT 1; 
	--calcul du règne du taxon supprimé
		SELECT  INTO monregne tx.regne FROM taxonomie.taxref tx WHERE tx.cd_nom = old.cd_nom;
	IF monregne = 'Animalia' THEN
		--calcul de l'embranchement du taxon supprimé
			SELECT  INTO monembranchement tx.phylum FROM taxonomie.taxref tx WHERE tx.cd_nom = old.cd_nom;
		-- puis recalul des couleurs avec old.id_unite_geo et old.taxon selon que le taxon est vertébrés (embranchemet 1) ou invertébres
			IF monembranchement = 'Chordata' THEN
				IF (SELECT count(*) FROM synthese.cor_unite_synthese WHERE cd_nom = old.cd_nom AND id_unite_geo = old.id_unite_geo)= 0 THEN
					DELETE FROM contactfaune.cor_unite_taxon WHERE id_taxon = monidtaxon AND id_unite_geo = old.id_unite_geo;
				ELSE
					PERFORM synthese.calcul_cor_unite_taxon_cf(monidtaxon, old.id_unite_geo);
				END IF;
			ELSE
				IF (SELECT count(*) FROM synthese.cor_unite_synthese WHERE cd_nom = old.cd_nom AND id_unite_geo = old.id_unite_geo)= 0 THEN
					DELETE FROM contactinv.cor_unite_taxon_inv WHERE id_taxon = monidtaxon AND id_unite_geo = old.id_unite_geo;
				ELSE
					PERFORM synthese.calcul_cor_unite_taxon_inv(monidtaxon, old.id_unite_geo);
				END IF;
			END IF;
		END IF;
		RETURN OLD;		
ELSIF (TG_OP = 'INSERT') THEN
	--retrouver le id_taxon
	SELECT INTO monidtaxon id_taxon FROM taxonomie.bib_taxons WHERE cd_nom = new.cd_nom LIMIT 1;
	--calcul du règne du taxon inséré
		SELECT  INTO monregne tx.regne FROM taxonomie.taxref tx WHERE tx.cd_nom = new.cd_nom;
	IF monregne = 'Animalia' THEN
		--calcul de l'embranchement du taxon inséré
		SELECT INTO monembranchement tx.phylum FROM taxonomie.taxref tx WHERE tx.cd_nom = new.cd_nom;
		-- puis recalul des couleurs avec new.id_unite_geo et new.taxon selon que le taxon est vertébrés (embranchemet 1) ou invertébres
		IF monembranchement = 'Chordata' THEN
		    PERFORM synthese.calcul_cor_unite_taxon_cf(monidtaxon, new.id_unite_geo);
		ELSE
		    PERFORM synthese.calcul_cor_unite_taxon_inv(monidtaxon, new.id_unite_geo);
		END IF;
        END IF;
	RETURN NEW;
END IF;
END;
]]></definition>
</function>

<function name="maj_cor_zonesstatut_synthese"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
-- apres travail dans la table synthèsefaune on supprime la donnée correspondante dans la table cor_zonesstatut_synthese
IF (TG_OP = 'DELETE') or (TG_OP = 'UPDATE') THEN
	DELETE FROM synthese.cor_zonesstatut_synthese WHERE id_synthese = old.id_synthese;
END IF;
-- insert la donnée depuis la table synthèsefaune dans la table cor_zonesstatut_synthese :
-- La donnée dans la table synthèsefaune doit etre en supprime = FALSE sinon on ne l'insert pas,
-- on calcul la ou les zones à statuts correspondant à la donnée.
-- ces intersections  servent à eviter des intersect lourd en requete spatiale dans l'appli web, ainsi
-- les intersections avec les zones à statut principales sont déja calculées en tables relationelles
IF (TG_OP = 'INSERT') or (TG_OP = 'UPDATE') THEN
	IF new.supprime = FALSE THEN
		INSERT INTO synthese.cor_zonesstatut_synthese (id_zone,id_synthese)
		SELECT z.id_zone,s.id_synthese FROM synthese.syntheseff s, layers.l_zonesstatut z 
		WHERE ST_Intersects(z.the_geom, s.the_geom_2154)
		AND z.id_type IN(1,4,5,6,7,8,9,10,11) -- typologie limitée au coeur, reserve, natura2000 etc...
		AND s.id_synthese = new.id_synthese;
	END IF;
END IF;
RETURN NULL; 
END;
]]></definition>
</function>

<function name="update_syntheseff"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
	new.date_update= 'now';
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="find_cdref"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="integer"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de renvoyer le cd_ref d'un taxon à partir de son cd_nom
--
--Gil DELUERMOZ septembre 2011

  DECLARE ref integer;
  BEGIN
	SELECT INTO ref cd_ref FROM taxonomie.taxref WHERE cd_nom = id;
	return ref;
  END;
]]></definition>
</function>

<function name="modify_date_insert"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
    NEW.date_insert := now();
    NEW.date_update := now();
    RETURN NEW;
END;
]]></definition>
</function>

<function name="modify_date_update"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
BEGIN
    NEW.date_update := now();
    RETURN NEW;
END;
]]></definition>
</function>

<table name="cor_boolean">
	<schema name="public"/>
	<role name="geonatuser"/>
	<position x="45" y="61.6667"/>
	<column name="expression" not-null="true">
		<type name="character varying" length="25"/>
	</column>
	<column name="bool" not-null="true">
		<type name="boolean"/>
	</column>
	<constraint name="pk_cor_boolean" type="pk-constr" table="public.cor_boolean">
		<columns names="expression" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_criteres_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="1421.93" y="330"/>
	<column name="id_critere_cf" not-null="true">
		<type name="integer"/>
	</column>
	<column name="code_critere_cf">
		<type name="character varying" length="3"/>
	</column>
	<column name="nom_critere_cf">
		<type name="character varying" length="90"/>
	</column>
	<column name="tri_cf">
		<type name="integer"/>
	</column>
	<column name="cincomplet">
		<type name="character" length="2"/>
	</column>
	<column name="id_critere_synthese">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_criteres_cf" type="pk-constr" table="contactfaune.bib_criteres_cf">
		<columns names="id_critere_cf" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_messages_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="994.766" y="200"/>
	<column name="id_message_cf" not-null="true">
		<type name="integer"/>
	</column>
	<column name="texte_message_cf">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="pk_bib_types_comptage" type="pk-constr" table="contactfaune.bib_messages_cf">
		<columns names="id_message_cf" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_critere_liste">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="1918.6" y="330"/>
	<column name="id_critere_cf" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_liste" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_critere_liste" type="pk-constr" table="contactfaune.cor_critere_liste">
		<columns names="id_critere_cf,id_liste" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_message_taxon">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="1721.86" y="200"/>
	<column name="id_message_cf" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_message_taxon" type="pk-constr" table="contactfaune.cor_message_taxon">
		<columns names="id_message_cf,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_role_fiche_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="834.797" y="948.333"/>
	<column name="id_cf" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_role_fiche_cf" type="pk-constr" table="contactfaune.cor_role_fiche_cf">
		<columns names="id_cf,id_role" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_unite_taxon">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="1870.26" y="448.867"/>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="derniere_date">
		<type name="date"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying" length="10"/>
	</column>
	<column name="nb_obs">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_unite_taxon" type="pk-constr" table="contactfaune.cor_unite_taxon">
		<columns names="id_unite_geo,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="log_colors">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="824.766" y="407.2"/>
	<column name="annee" not-null="true">
		<type name="integer"/>
	</column>
	<column name="mois" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying"/>
	</column>
	<column name="nbtaxons">
		<type name="numeric"/>
	</column>
	<column name="nb_data">
		<type name="integer"/>
	</column>
	<constraint name="pk_log_colors" type="pk-constr" table="contactfaune.log_colors">
		<columns names="annee,mois,id_unite_geo,couleur" ref-type="src-columns"/>
	</constraint>
</table>

<table name="log_colors_day">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="825.6" y="328.867"/>
	<column name="jour" not-null="true">
		<type name="date"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying"/>
	</column>
	<column name="nbtaxons">
		<type name="numeric"/>
	</column>
	<constraint name="pk_log_colors_day" type="pk-constr" table="contactfaune.log_colors_day">
		<columns names="jour,couleur" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_fiches_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="812.766" y="575.533"/>
	<column name="id_cf" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="dateobs" not-null="true">
		<type name="date"/>
	</column>
	<column name="altitude_saisie">
		<type name="integer"/>
	</column>
	<column name="altitude_sig">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue">
		<type name="integer"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="pdop">
		<type name="double precision"/>
	</column>
	<column name="saisie_initiale">
		<type name="character varying" length="20"/>
	</column>
	<column name="id_organisme">
		<type name="integer"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="id_protocole">
		<type name="integer"/>
	</column>
	<column name="id_lot">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POINT'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="contactfaune.t_fiches_cf">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="pk_t_fiches_cf" type="pk-constr" table="contactfaune.t_fiches_cf">
		<columns names="id_cf" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_releves_cf_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_releves_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="1421.03" y="565.533"/>
	<column name="id_releve_cf" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_cf" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_critere_cf" not-null="true">
		<type name="integer"/>
	</column>
	<column name="am">
		<type name="integer"/>
	</column>
	<column name="af">
		<type name="integer"/>
	</column>
	<column name="ai">
		<type name="integer"/>
	</column>
	<column name="na">
		<type name="integer"/>
	</column>
	<column name="sai">
		<type name="integer"/>
	</column>
	<column name="jeune">
		<type name="integer"/>
	</column>
	<column name="yearling">
		<type name="integer"/>
	</column>
	<column name="cd_ref_origine">
		<type name="integer"/>
	</column>
	<column name="nom_taxon_saisi">
		<type name="character varying" length="255"/>
	</column>
	<column name="commentaire">
		<type name="text"/>
	</column>
	<column name="determinateur">
		<type name="character varying" length="255"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="prelevement" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('t_releves_cf_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<constraint name="pk_t_releves_cf" type="pk-constr" table="contactfaune.t_releves_cf">
		<columns names="id_releve_cf" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_abondances">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<position x="697.861" y="1462.54"/>
	<column name="id_abondance" not-null="true">
		<type name="character"/>
	</column>
	<column name="nom_abondance" not-null="true">
		<type name="character varying" length="128"/>
	</column>
	<constraint name="pk_bib_abondances" type="pk-constr" table="bryophytes.bib_abondances">
		<columns names="id_abondance" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_expositions">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<position x="807.691" y="1558.97"/>
	<column name="id_exposition" not-null="true">
		<type name="character" length="2"/>
	</column>
	<column name="nom_exposition" not-null="true">
		<type name="character varying" length="10"/>
	</column>
	<column name="tri_exposition">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_expositions" type="pk-constr" table="bryophytes.bib_expositions">
		<columns names="id_exposition" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_bryo_observateur">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<position x="867.432" y="1776.1"/>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<constraint name="pk_cor_bryo_observateur" type="pk-constr" table="bryophytes.cor_bryo_observateur">
		<columns names="id_role,id_station" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="cor_bryo_taxon_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
</sequence>

<sequence name="cor_bryo_taxon_id_station_cd_nom_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
</sequence>

<table name="cor_bryo_taxon">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<position x="777.598" y="1215.87"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_abondance">
		<type name="character"/>
	</column>
	<column name="taxon_saisi">
		<type name="character varying" length="255"/>
	</column>
	<column name="supprime" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="id_station_cd_nom" not-null="true" default-value="nextval('cor_bryo_taxon_id_station_cd_nom_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('cor_bryo_taxon_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_bryo_taxons" type="pk-constr" table="bryophytes.cor_bryo_taxon">
		<columns names="id_station,cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_stations_bryo_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_stations_bryo">
	<schema name="bryophytes"/>
	<role name="geonatuser"/>
	<position x="1296.19" y="1414.2"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_exposition" not-null="true">
		<type name="character" length="2"/>
	</column>
	<column name="id_support" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_protocole" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_lot" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_organisme" not-null="true">
		<type name="integer"/>
	</column>
	<column name="dateobs">
		<type name="date"/>
	</column>
	<column name="info_acces">
		<type name="character varying" length="1000"/>
	</column>
	<column name="surface" default-value="1">
		<type name="integer"/>
	</column>
	<column name="complet_partiel">
		<type name="character"/>
	</column>
	<column name="altitude_saisie" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_sig" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue" default-value="0">
		<type name="integer"/>
	</column>
	<column name="remarques">
		<type name="text"/>
	</column>
	<column name="pdop" default-value="0">
		<type name="real"/>
	</column>
	<column name="supprime" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('t_stations_bryo_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POINT'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="bryophytes.t_stations_bryo">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="pk_t_stations_bryo" type="pk-constr" table="bryophytes.t_stations_bryo">
		<columns names="id_station" ref-type="src-columns"/>
	</constraint>
	<constraint name="t_stations_bryo_gid_key" type="uq-constr" table="bryophytes.t_stations_bryo">
		<columns names="gid" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_comptages_methodo">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6643.8" y="494.2"/>
	<column name="id_comptage_methodo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_comptage_methodo">
		<type name="character varying" length="100"/>
	</column>
	<constraint name="bib_comptages_methodo_pkey" type="pk-constr" table="florepatri.bib_comptages_methodo">
		<columns names="id_comptage_methodo" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_frequences_methodo_new">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6645.96" y="389.2"/>
	<column name="id_frequence_methodo_new" not-null="true">
		<type name="character"/>
	</column>
	<column name="nom_frequence_methodo_new">
		<type name="character varying" length="100"/>
	</column>
	<constraint name="bib_frequences_methodo_new_pkey" type="pk-constr" table="florepatri.bib_frequences_methodo_new">
		<columns names="id_frequence_methodo_new" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_pentes">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6646.46" y="607.533"/>
	<column name="id_pente" not-null="true">
		<type name="integer"/>
	</column>
	<column name="val_pente" not-null="true">
		<type name="real"/>
	</column>
	<column name="nom_pente">
		<type name="character varying" length="100"/>
	</column>
	<constraint name="bib_pentes_pkey" type="pk-constr" table="florepatri.bib_pentes">
		<columns names="id_pente" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_perturbations">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6741.3" y="67.533"/>
	<column name="codeper" not-null="true">
		<type name="smallint"/>
	</column>
	<column name="classification" not-null="true">
		<type name="character varying" length="30"/>
	</column>
	<column name="description" not-null="true">
		<type name="character varying" length="65"/>
	</column>
	<constraint name="pk_bib_perturbation" type="pk-constr" table="florepatri.bib_perturbations">
		<columns names="codeper" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_phenologies">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6645.46" y="270.866"/>
	<column name="codepheno" not-null="true">
		<type name="smallint"/>
	</column>
	<column name="pheno" not-null="true">
		<type name="character varying" length="45"/>
	</column>
	<constraint name="pk_bib_phenologie" type="pk-constr" table="florepatri.bib_phenologies">
		<columns names="codepheno" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_physionomies">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5152.13" y="247.266"/>
	<column name="id_physionomie" not-null="true">
		<type name="integer"/>
	</column>
	<column name="groupe_physionomie">
		<type name="character varying" length="20"/>
	</column>
	<column name="nom_physionomie">
		<type name="character varying" length="100"/>
	</column>
	<column name="definition_physionomie">
		<type name="text"/>
	</column>
	<column name="code_physionomie">
		<type name="character varying" length="3"/>
	</column>
	<constraint name="bib_physionomies_pk" type="pk-constr" table="florepatri.bib_physionomies">
		<columns names="id_physionomie" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_rezo_ecrins">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5726.3" y="1147.27"/>
	<column name="id_rezo_ecrins" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_rezo_ecrins">
		<type name="character varying" length="100"/>
	</column>
	<constraint name="bib_rezo_ecrins_pkey" type="pk-constr" table="florepatri.bib_rezo_ecrins">
		<columns names="id_rezo_ecrins" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_statuts">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4863.13" y="377.266"/>
	<column name="id_statut" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_statut" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<column name="desc_statut">
		<type name="text"/>
	</column>
	<constraint name="pk_bib_statuts" type="pk-constr" table="florepatri.bib_statuts">
		<columns names="id_statut" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_taxons_fp">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5619.63" y="550.6"/>
	<column name="num_nomenclatural" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="francais">
		<type name="character varying" length="100"/>
	</column>
	<column name="latin">
		<type name="character varying" length="100"/>
	</column>
	<column name="echelle" not-null="true">
		<type name="smallint"/>
	</column>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nomade_ecrins" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<constraint name="bib_taxons_fp_pkey" type="pk-constr" table="florepatri.bib_taxons_fp">
		<columns names="cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_ap_perturb">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6644.8" y="173.933"/>
	<column name="indexap" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="codeper" not-null="true">
		<type name="smallint"/>
	</column>
	<constraint name="pk_cor_ap_perturb" type="pk-constr" table="florepatri.cor_ap_perturb">
		<columns names="indexap,codeper" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_ap_physionomie">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5633.8" y="94.333"/>
	<column name="indexap" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_physionomie" not-null="true">
		<type name="smallint"/>
	</column>
	<constraint name="pk_cor_ap_physionomie" type="pk-constr" table="florepatri.cor_ap_physionomie">
		<columns names="indexap,id_physionomie" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_taxon_statut">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5301.63" y="484.333"/>
	<column name="id_statut" not-null="true">
		<type name="integer"/>
	</column>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_taxon_statut" type="pk-constr" table="florepatri.cor_taxon_statut">
		<columns names="id_statut,cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_zp_obs">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5735.13" y="1032.67"/>
	<column name="indexzp" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="codeobs" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="cor_zp_obs_pkey" type="pk-constr" table="florepatri.cor_zp_obs">
		<columns names="indexzp,codeobs" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_apresence">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6043.07" y="259.333"/>
	<column name="indexap" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="codepheno" not-null="true">
		<type name="smallint"/>
	</column>
	<column name="indexzp" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="altitude_saisie">
		<type name="smallint"/>
	</column>
	<column name="surfaceap" not-null="true">
		<type name="integer"/>
	</column>
	<column name="frequenceap" not-null="true">
		<type name="real"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="topo_valid">
		<type name="boolean"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="erreur_signalee" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="altitude_sig" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue" default-value="0">
		<type name="integer"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="id_frequence_methodo_new" not-null="true">
		<type name="character"/>
	</column>
	<column name="nb_transects_frequence" default-value="0">
		<type name="integer"/>
	</column>
	<column name="nb_points_frequence" default-value="0">
		<type name="integer"/>
	</column>
	<column name="nb_contacts_frequence" default-value="0">
		<type name="integer"/>
	</column>
	<column name="id_comptage_methodo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nb_placettes_comptage">
		<type name="integer"/>
	</column>
	<column name="surface_placette_comptage">
		<type name="real"/>
	</column>
	<column name="remarques">
		<type name="text"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="longueur_pas">
		<type name="numeric" length="10" precision="2"/>
	</column>
	<column name="effectif_placettes_steriles">
		<type name="integer"/>
	</column>
	<column name="effectif_placettes_fertiles">
		<type name="integer"/>
	</column>
	<column name="total_steriles">
		<type name="integer"/>
	</column>
	<column name="total_fertiles">
		<type name="integer"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="florepatri.t_apresence">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="florepatri.t_apresence">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="florepatri.t_apresence">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="florepatri.t_apresence">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="_t_apresence_pkey" type="pk-constr" table="florepatri.t_apresence">
		<columns names="indexap" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_zprospection">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="6213.66" y="874.333"/>
	<column name="indexzp" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_secteur" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_protocole" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_lot" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_organisme" not-null="true">
		<type name="integer"/>
	</column>
	<column name="dateobs" not-null="true">
		<type name="date"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="validation" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="topo_valid">
		<type name="boolean"/>
	</column>
	<column name="erreur_signalee" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="cd_nom">
		<type name="integer"/>
	</column>
	<column name="saisie_initiale">
		<type name="character varying" length="20"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="taxon_saisi">
		<type name="character varying" length="100"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<column name="geom_point_3857">
		<type name="geometry"/>
	</column>
	<column name="geom_mixte_3857">
		<type name="geometry"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="id_rezo_ecrins" not-null="true" default-value="0">
		<type name="integer"/>
	</column>
	<constraint name="enforce_dims_geom_mixte_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_ndims(geom_mixte_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_geom_point_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_ndims(geom_point_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_geom_point_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[((public.geometrytype(geom_point_3857) = 'POINT'::text) OR (geom_point_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POLYGON'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POLYGON'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_geom_mixte_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_srid(geom_mixte_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="enforce_srid_geom_point_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_srid(geom_point_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="florepatri.t_zprospection">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="_t_zprospection_pkey" type="pk-constr" table="florepatri.t_zprospection">
		<columns names="indexzp" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_abondances">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="5814.63" y="1430.86"/>
	<column name="id_abondance" not-null="true">
		<type name="character"/>
	</column>
	<column name="nom_abondance" not-null="true">
		<type name="character varying" length="128"/>
	</column>
	<constraint name="pk_bib_abondances" type="pk-constr" table="florestation.bib_abondances">
		<columns names="id_abondance" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_expositions">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6047.8" y="1902.53"/>
	<column name="id_exposition" not-null="true">
		<type name="character" length="2"/>
	</column>
	<column name="nom_exposition" not-null="true">
		<type name="character varying" length="10"/>
	</column>
	<column name="tri_exposition">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_expositions" type="pk-constr" table="florestation.bib_expositions">
		<columns names="id_exposition" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_homogenes">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6053.97" y="2064.2"/>
	<column name="id_homogene" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_homogene" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<constraint name="pk_bib_homogenes" type="pk-constr" table="florestation.bib_homogenes">
		<columns names="id_homogene" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_microreliefs">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6423.8" y="1434.2"/>
	<column name="id_microrelief" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_microrelief" not-null="true">
		<type name="character varying" length="128"/>
	</column>
	<constraint name="pk_bib_microreliefs" type="pk-constr" table="florestation.bib_microreliefs">
		<columns names="id_microrelief" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_programmes_fs">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6038.63" y="1769.2"/>
	<column name="id_programme_fs" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_programme_fs" not-null="true">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="pk_bib_programmes_fs" type="pk-constr" table="florestation.bib_programmes_fs">
		<columns names="id_programme_fs" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_surfaces">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6059.63" y="2228.93"/>
	<column name="id_surface" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_surface" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<constraint name="pk_bib_surfaces" type="pk-constr" table="florestation.bib_surfaces">
		<columns names="id_surface" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_fs_delphine">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6059.8" y="1630.6"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_delphine" not-null="true">
		<type name="character varying" length="5"/>
	</column>
	<constraint name="pk_cor_fs_delphine" type="pk-constr" table="florestation.cor_fs_delphine">
		<columns names="id_station,id_delphine" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_fs_microrelief">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6093.97" y="1505.6"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_microrelief" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_fs_microrelief" type="pk-constr" table="florestation.cor_fs_microrelief">
		<columns names="id_station,id_microrelief" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_fs_observateur">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="4816.13" y="1475.6"/>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<constraint name="pk_cor_fs_observateur" type="pk-constr" table="florestation.cor_fs_observateur">
		<columns names="id_role,id_station" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="cor_fs_taxon_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="florestation"/>
	<role name="geonatuser"/>
</sequence>

<sequence name="cor_fs_taxon_id_station_cd_nom_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="florestation"/>
	<role name="geonatuser"/>
</sequence>

<table name="cor_fs_taxon">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="5273.39" y="1478.93"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="herb">
		<type name="character"/>
	</column>
	<column name="inf_1m">
		<type name="character"/>
	</column>
	<column name="de_1_4m">
		<type name="character"/>
	</column>
	<column name="sup_4m">
		<type name="character"/>
	</column>
	<column name="taxon_saisi">
		<type name="character varying" length="150"/>
	</column>
	<column name="supprime" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="id_station_cd_nom" not-null="true" default-value="nextval('cor_fs_taxon_id_station_cd_nom_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('cor_fs_taxon_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_fs_taxons" type="pk-constr" table="florestation.cor_fs_taxon">
		<columns names="id_station,cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_stations_fs_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="florestation"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_stations_fs">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="5307.97" y="1767.13"/>
	<column name="id_station" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_exposition" not-null="true">
		<type name="character" length="2"/>
	</column>
	<column name="id_sophie">
		<type name="character varying" length="5"/>
	</column>
	<column name="id_programme_fs" not-null="true" default-value="999">
		<type name="integer"/>
	</column>
	<column name="id_support" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_protocole" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_lot" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_organisme" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_homogene">
		<type name="integer"/>
	</column>
	<column name="dateobs">
		<type name="date"/>
	</column>
	<column name="info_acces">
		<type name="character varying" length="255"/>
	</column>
	<column name="id_surface" default-value="1">
		<type name="integer"/>
	</column>
	<column name="complet_partiel">
		<type name="character"/>
	</column>
	<column name="meso_longitudinal" default-value="0">
		<type name="integer"/>
	</column>
	<column name="meso_lateral" default-value="0">
		<type name="integer"/>
	</column>
	<column name="canopee" default-value="0">
		<type name="real"/>
	</column>
	<column name="ligneux_hauts" default-value="0">
		<type name="integer"/>
	</column>
	<column name="ligneux_bas" default-value="0">
		<type name="integer"/>
	</column>
	<column name="ligneux_tbas" default-value="0">
		<type name="integer"/>
	</column>
	<column name="herbaces" default-value="0">
		<type name="integer"/>
	</column>
	<column name="mousses" default-value="0">
		<type name="integer"/>
	</column>
	<column name="litiere" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_saisie" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_sig" default-value="0">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue" default-value="0">
		<type name="integer"/>
	</column>
	<column name="remarques">
		<type name="text"/>
	</column>
	<column name="pdop" default-value="0">
		<type name="real"/>
	</column>
	<column name="supprime" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('t_stations_fs_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="validation" default-value="false">
		<type name="boolean"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POINT'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="florestation.t_stations_fs">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="pk_t_stations_fs" type="pk-constr" table="florestation.t_stations_fs">
		<columns names="id_station" ref-type="src-columns"/>
	</constraint>
	<constraint name="t_stations_fs_gid_key" type="uq-constr" table="florestation.t_stations_fs">
		<columns names="gid" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_criteres_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="263.6" y="314.733"/>
	<reference>
		<expression><![CDATA[ SELECT c.id_critere_cf,
    c.nom_critere_cf,
    c.tri_cf,
    ccl.id_liste AS id_classe
   FROM (contactfaune.bib_criteres_cf c
     JOIN contactfaune.cor_critere_liste ccl ON ((ccl.id_critere_cf = c.id_critere_cf)))
  ORDER BY ccl.id_liste, c.tri_cf;]]></expression>
	</reference>
</view>

<table name="cor_role_menu">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<comment><![CDATA[gestion du contenu des menus utilisateurs dans les applications]]></comment>
	<position x="2864.3" y="3001.07"/>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_menu" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="cor_role_menu_pkey" type="pk-constr" table="utilisateurs.cor_role_menu">
		<columns names="id_role,id_menu" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_roles">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="3173.18" y="3415.59"/>
	<column name="id_role_groupe" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_role_utilisateur" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="cor_roles_pkey" type="pk-constr" table="utilisateurs.cor_roles">
		<columns names="id_role_groupe,id_role_utilisateur" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_roles_id_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_roles">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="3582.02" y="3214.64"/>
	<column name="groupe" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="id_role" not-null="true" default-value="nextval('t_roles_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="identifiant">
		<type name="character varying" length="100"/>
	</column>
	<column name="nom_role">
		<type name="character varying" length="50"/>
	</column>
	<column name="prenom_role">
		<type name="character varying" length="50"/>
	</column>
	<column name="desc_role">
		<type name="text"/>
	</column>
	<column name="pass">
		<type name="character varying" length="100"/>
	</column>
	<column name="email">
		<type name="character varying" length="250"/>
	</column>
	<column name="id_organisme">
		<type name="integer"/>
	</column>
	<column name="organisme">
		<type name="character" length="32"/>
	</column>
	<column name="id_unite">
		<type name="integer"/>
	</column>
	<column name="remarques">
		<type name="text"/>
	</column>
	<column name="pn">
		<type name="boolean"/>
	</column>
	<column name="session_appli">
		<type name="character varying" length="50"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<constraint name="pk_roles" type="pk-constr" table="utilisateurs.t_roles">
		<columns names="id_role" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_observateurs_faune">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="263.867" y="554.733"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 9)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 9)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role;]]></expression>
	</reference>
</view>

<table name="bib_filtres">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="2600.46" y="791.065"/>
	<column name="id_filtre" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_filtre">
		<type name="character varying" length="50"/>
	</column>
	<column name="label1">
		<type name="character varying" length="50"/>
	</column>
	<column name="label2">
		<type name="character varying" length="50"/>
	</column>
	<column name="label3">
		<type name="character varying" length="50"/>
	</column>
	<column name="descr_filtre">
		<type name="character varying" length="500"/>
	</column>
	<column name="img">
		<type name="character varying" length="250"/>
	</column>
	<column name="valeur_filtre">
		<type name="character varying" length="1000"/>
	</column>
	<column name="obligatoire" default-value="false">
		<type name="boolean"/>
	</column>
	<constraint name="pk_bib_filtres" type="pk-constr" table="taxonomie.bib_filtres">
		<columns names="id_filtre" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_attributs">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="4051.3" y="867.732"/>
	<column name="id_attribut" not-null="true" default-value="nextval('bib_attributs_id_attribut_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="nom_attribut" not-null="true">
		<type name="character varying" length="255"/>
	</column>
	<column name="label_attribut" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="liste_valeur_attribut" not-null="true">
		<type name="text"/>
	</column>
	<column name="obligatoire" not-null="true">
		<type name="boolean"/>
	</column>
	<column name="desc_attribut">
		<type name="text"/>
	</column>
	<column name="type_attribut">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="pk_bib_attributs" type="pk-constr" table="taxonomie.bib_attributs">
		<columns names="id_attribut" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_listes">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="2606.8" y="646.065"/>
	<column name="id_liste" not-null="true" default-value="nextval('bib_listes_id_liste_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="nom_liste" not-null="true">
		<type name="character varying" length="255"/>
	</column>
	<column name="desc_liste">
		<type name="text"/>
	</column>
	<column name="picto">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="pk_bib_listes" type="pk-constr" table="taxonomie.bib_listes">
		<columns names="id_liste" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_taxons">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3328.96" y="799.399"/>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="cd_nom">
		<type name="integer"/>
	</column>
	<column name="nom_latin">
		<type name="character varying" length="100"/>
	</column>
	<column name="nom_francais">
		<type name="character varying" length="255"/>
	</column>
	<column name="auteur">
		<type name="character varying" length="200"/>
	</column>
	<column name="filtre1">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre2">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre3">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre4">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre5">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre6">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre7">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre8">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre9">
		<type name="character varying" length="255"/>
	</column>
	<column name="filtre10">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="pk_bib_taxons" type="pk-constr" table="taxonomie.bib_taxons">
		<columns names="id_taxon" ref-type="src-columns"/>
	</constraint>
	<constraint name="unique_cd_nom" type="uq-constr" table="taxonomie.bib_taxons">
		<columns names="cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_taxon_attribut">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3718.46" y="704.399"/>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_attribut" not-null="true">
		<type name="integer"/>
	</column>
	<column name="valeur_attribut" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="cor_taxon_attribut_pkey" type="pk-constr" table="taxonomie.cor_taxon_attribut">
		<columns names="id_taxon,id_attribut" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_taxon_liste">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="2997.13" y="715.265"/>
	<column name="id_liste" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="cor_taxon_liste_pkey" type="pk-constr" table="taxonomie.cor_taxon_liste">
		<columns names="id_taxon,id_liste" ref-type="src-columns"/>
	</constraint>
</table>

<table name="taxref">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3315.06" y="358.599"/>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_statut">
		<type name="character"/>
	</column>
	<column name="id_habitat">
		<type name="integer"/>
	</column>
	<column name="id_rang">
		<type name="character" length="4"/>
	</column>
	<column name="regne">
		<type name="character varying" length="20"/>
	</column>
	<column name="phylum">
		<type name="character varying" length="50"/>
	</column>
	<column name="classe">
		<type name="character varying" length="50"/>
	</column>
	<column name="ordre">
		<type name="character varying" length="50"/>
	</column>
	<column name="famille">
		<type name="character varying" length="50"/>
	</column>
	<column name="cd_taxsup">
		<type name="integer"/>
	</column>
	<column name="cd_ref">
		<type name="integer"/>
	</column>
	<column name="lb_nom">
		<type name="character varying" length="100"/>
	</column>
	<column name="lb_auteur">
		<type name="character varying" length="250"/>
	</column>
	<column name="nom_complet">
		<type name="character varying" length="255"/>
	</column>
	<column name="nom_valide">
		<type name="character varying" length="255"/>
	</column>
	<column name="nom_vern">
		<type name="character varying" length="1000"/>
	</column>
	<column name="nom_vern_eng">
		<type name="character varying" length="500"/>
	</column>
	<column name="group1_inpn">
		<type name="character varying" length="50"/>
	</column>
	<column name="group2_inpn">
		<type name="character varying" length="50"/>
	</column>
	<column name="nom_complet_html">
		<type name="character varying" length="500"/>
	</column>
	<constraint name="pk_taxref" type="pk-constr" table="taxonomie.taxref">
		<columns names="cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="bib_attributs_id_attribut_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
</sequence>

<sequence name="bib_listes_id_liste_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
</sequence>

<view name="v_nomade_classes">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="264.133" y="849.733"/>
	<reference>
		<expression><![CDATA[ SELECT g.id_liste AS id_classe,
    g.nom_liste AS nom_classe_fr,
    g.desc_liste AS desc_classe
   FROM (( SELECT l.id_liste,
            l.nom_liste,
            l.desc_liste,
            min(taxonomie.find_cdref(tx.cd_nom)) AS cd_ref
           FROM ((taxonomie.bib_listes l
             JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_liste = l.id_liste)))
             JOIN taxonomie.bib_taxons tx ON ((tx.id_taxon = ctl.id_taxon)))
          WHERE (l.id_liste = ANY (ARRAY[1, 11, 12, 13, 14]))
          GROUP BY l.id_liste, l.nom_liste, l.desc_liste) g
     JOIN taxonomie.taxref t ON ((t.cd_nom = g.cd_ref)))
  WHERE ((t.phylum)::text = 'Chordata'::text);]]></expression>
	</reference>
</view>

<view name="v_nomade_taxons_faune">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="265.4" y="706.4"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT t.id_taxon,
    taxonomie.find_cdref(tx.cd_nom) AS cd_ref,
    tx.cd_nom,
    t.nom_latin,
    t.nom_francais,
    g.id_classe,
        CASE
            WHEN (tx.cd_nom = ANY (ARRAY[61098, 61119, 61000])) THEN 6
            ELSE 5
        END AS denombrement,
    f2.bool AS patrimonial,
    m.texte_message_cf AS message,
        CASE
            WHEN (tx.cd_nom = ANY (ARRAY[60577, 60612])) THEN false
            ELSE true
        END AS contactfaune,
    true AS mortalite
   FROM ((((((taxonomie.bib_taxons t
     LEFT JOIN contactfaune.cor_message_taxon cmt ON ((cmt.id_taxon = t.id_taxon)))
     LEFT JOIN contactfaune.bib_messages_cf m ON ((m.id_message_cf = cmt.id_message_cf)))
     JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_taxon = t.id_taxon)))
     JOIN contactfaune.v_nomade_classes g ON ((g.id_classe = ctl.id_liste)))
     JOIN taxonomie.taxref tx ON ((tx.cd_nom = t.cd_nom)))
     JOIN cor_boolean f2 ON (((f2.expression)::text = (t.filtre2)::text)))
  WHERE ((t.filtre1)::text = 'oui'::text)
  ORDER BY t.id_taxon, taxonomie.find_cdref(tx.cd_nom), t.nom_latin, t.nom_francais, g.id_classe, f2.bool, m.texte_message_cf;]]></expression>
	</reference>
</view>

<table name="l_unites_geo">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7266.19" y="622.323"/>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="coeur">
		<type name="character varying" length="80"/>
	</column>
	<column name="secteur">
		<type name="character varying" length="80"/>
	</column>
	<column name="code_insee">
		<type name="character varying" length="80"/>
	</column>
	<column name="commune">
		<type name="character varying" length="80"/>
	</column>
	<column name="reserve">
		<type name="character varying" length="80"/>
	</column>
	<column name="surface_ha">
		<type name="character varying" length="80"/>
	</column>
	<column name="n2000">
		<type name="character varying" length="50"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom" type="ck-constr" table="layers.l_unites_geo">
			<expression><![CDATA[(public.st_ndims(the_geom) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_unites_geo">
			<expression><![CDATA[(((public.geometrytype(the_geom) = 'MULTIPOLYGON'::text) OR (public.geometrytype(the_geom) = 'POLYGON'::text)) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_unites_geo">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="pk_l_unites_geo" type="pk-constr" table="layers.l_unites_geo">
		<columns names="id_unite_geo" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_unites_geo_cf">
	<schema name="contactfaune"/>
	<role name="geonatuser"/>
	<position x="261.333" y="426.4"/>
	<reference>
		<expression><![CDATA[ SELECT st_simplifypreservetopology(l_unites_geo.the_geom, (15)::double precision) AS the_geom,
    l_unites_geo.id_unite_geo
   FROM layers.l_unites_geo
  GROUP BY l_unites_geo.the_geom, l_unites_geo.id_unite_geo;]]></expression>
	</reference>
</view>

<table name="bib_criteres_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="4830.96" y="3218.34"/>
	<column name="id_critere_inv" not-null="true">
		<type name="integer"/>
	</column>
	<column name="code_critere_inv">
		<type name="character varying" length="3"/>
	</column>
	<column name="nom_critere_inv">
		<type name="character varying" length="90"/>
	</column>
	<column name="tri_inv">
		<type name="integer"/>
	</column>
	<column name="id_critere_synthese">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_criteres_inv" type="pk-constr" table="contactinv.bib_criteres_inv">
		<columns names="id_critere_inv" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_messages_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="6285.46" y="2563.34"/>
	<column name="id_message_inv" not-null="true">
		<type name="integer"/>
	</column>
	<column name="texte_message_inv">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="pk_bib_types_comptage" type="pk-constr" table="contactinv.bib_messages_inv">
		<columns names="id_message_inv" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_milieux_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5908.63" y="2696.67"/>
	<column name="id_milieu_inv" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_milieu_inv">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="pk_bib_milieux_inv" type="pk-constr" table="contactinv.bib_milieux_inv">
		<columns names="id_milieu_inv" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_message_taxon">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5831.8" y="2561.67"/>
	<column name="id_message_inv" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_message_taxon_inv" type="pk-constr" table="contactinv.cor_message_taxon">
		<columns names="id_message_inv,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_role_fiche_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="4833.3" y="3000"/>
	<column name="id_inv" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_role_fiche_inv" type="pk-constr" table="contactinv.cor_role_fiche_inv">
		<columns names="id_inv,id_role" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_unite_taxon_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="4854.3" y="2789.2"/>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="derniere_date">
		<type name="date"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying" length="10"/>
	</column>
	<column name="nb_obs">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_unite_taxon_inv" type="pk-constr" table="contactinv.cor_unite_taxon_inv">
		<columns names="id_unite_geo,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="log_colors">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5806.8" y="3242.54"/>
	<column name="annee" not-null="true">
		<type name="integer"/>
	</column>
	<column name="mois" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying"/>
	</column>
	<column name="nbtaxons">
		<type name="numeric"/>
	</column>
	<column name="nb_data">
		<type name="integer"/>
	</column>
	<constraint name="pk_log_colors_inv" type="pk-constr" table="contactinv.log_colors">
		<columns names="annee,mois,id_unite_geo,couleur" ref-type="src-columns"/>
	</constraint>
</table>

<table name="log_colors_day">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5820.96" y="3144.2"/>
	<column name="jour" not-null="true">
		<type name="date"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying"/>
	</column>
	<column name="nbtaxons">
		<type name="numeric"/>
	</column>
	<constraint name="pk_log_colors_day_inv" type="pk-constr" table="contactinv.log_colors_day">
		<columns names="jour,couleur" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_fiches_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5333.13" y="2600.87"/>
	<column name="id_inv" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="dateobs" not-null="true">
		<type name="date"/>
	</column>
	<column name="heure">
		<type name="integer"/>
	</column>
	<column name="altitude_saisie">
		<type name="integer"/>
	</column>
	<column name="altitude_sig">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue">
		<type name="integer"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="pdop">
		<type name="integer"/>
	</column>
	<column name="saisie_initiale">
		<type name="character varying" length="20"/>
	</column>
	<column name="id_organisme">
		<type name="integer"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="id_protocole">
		<type name="integer"/>
	</column>
	<column name="id_lot">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="id_milieu_inv">
		<type name="integer"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POINT'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="contactinv.t_fiches_inv">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="pk_t_fiches_inv" type="pk-constr" table="contactinv.t_fiches_inv">
		<columns names="id_inv" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_releves_inv_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_releves_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5320.4" y="3022.54"/>
	<column name="id_releve_inv" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_inv" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_critere_inv" not-null="true">
		<type name="integer"/>
	</column>
	<column name="am">
		<type name="integer"/>
	</column>
	<column name="af">
		<type name="integer"/>
	</column>
	<column name="ai">
		<type name="integer"/>
	</column>
	<column name="na">
		<type name="integer"/>
	</column>
	<column name="cd_ref_origine">
		<type name="integer"/>
	</column>
	<column name="nom_taxon_saisi">
		<type name="character varying" length="255"/>
	</column>
	<column name="commentaire">
		<type name="text"/>
	</column>
	<column name="determinateur">
		<type name="character varying" length="255"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="prelevement" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('t_releves_inv_gid_seq'::regclass)">
		<type name="integer"/>
		<comment><![CDATA[pour qgis]]></comment>
	</column>
	<constraint name="pk_t_releves_inv" type="pk-constr" table="contactinv.t_releves_inv">
		<columns names="id_releve_inv" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_classes">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5897.63" y="2979.07"/>
	<reference>
		<expression><![CDATA[ SELECT g.id_liste AS id_classe,
    g.nom_liste AS nom_classe_fr,
    g.desc_liste AS desc_classe
   FROM (( SELECT l.id_liste,
            l.nom_liste,
            l.desc_liste,
            min(taxonomie.find_cdref(tx.cd_nom)) AS cd_ref
           FROM ((taxonomie.bib_listes l
             JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_liste = l.id_liste)))
             JOIN taxonomie.bib_taxons tx ON ((tx.id_taxon = ctl.id_taxon)))
          WHERE (l.id_liste = ANY (ARRAY[2, 5, 8, 9, 10, 15, 16]))
          GROUP BY l.id_liste, l.nom_liste, l.desc_liste) g
     JOIN taxonomie.taxref t ON ((t.cd_nom = g.cd_ref)))
  WHERE (((t.phylum)::text <> 'Chordata'::text) AND ((t.regne)::text = 'Animalia'::text));]]></expression>
	</reference>
</view>

<view name="v_nomade_criteres_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="6137.23" y="2979.07"/>
	<reference>
		<expression><![CDATA[ SELECT c.id_critere_inv,
    c.nom_critere_inv,
    c.tri_inv
   FROM contactinv.bib_criteres_inv c
  ORDER BY c.tri_inv;]]></expression>
	</reference>
</view>

<view name="v_nomade_milieux_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="6402.83" y="2979.07"/>
	<reference>
		<expression><![CDATA[ SELECT bib_milieux_inv.id_milieu_inv,
    bib_milieux_inv.nom_milieu_inv
   FROM contactinv.bib_milieux_inv
  ORDER BY bib_milieux_inv.id_milieu_inv;]]></expression>
	</reference>
</view>

<view name="v_nomade_observateurs_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="6138.76" y="3065.74"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 11)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 11)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role;]]></expression>
	</reference>
</view>

<view name="v_nomade_taxons_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="6439.36" y="3065.74"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT t.id_taxon,
    taxonomie.find_cdref(tx.cd_nom) AS cd_ref,
    tx.cd_nom,
    t.nom_latin,
    t.nom_francais,
    g.id_classe,
    f2.bool AS patrimonial,
    m.texte_message_inv AS message
   FROM ((((((taxonomie.bib_taxons t
     LEFT JOIN contactinv.cor_message_taxon cmt ON ((cmt.id_taxon = t.id_taxon)))
     LEFT JOIN contactinv.bib_messages_inv m ON ((m.id_message_inv = cmt.id_message_inv)))
     JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_taxon = t.id_taxon)))
     JOIN contactinv.v_nomade_classes g ON ((g.id_classe = ctl.id_liste)))
     JOIN taxonomie.taxref tx ON ((tx.cd_nom = t.cd_nom)))
     JOIN cor_boolean f2 ON (((f2.expression)::text = (t.filtre2)::text)));]]></expression>
	</reference>
</view>

<view name="v_nomade_unites_geo_inv">
	<schema name="contactinv"/>
	<role name="geonatuser"/>
	<position x="5897.63" y="3064.47"/>
	<reference>
		<expression><![CDATA[ SELECT st_simplifypreservetopology(l_unites_geo.the_geom, (15)::double precision) AS the_geom,
    l_unites_geo.id_unite_geo
   FROM layers.l_unites_geo
  GROUP BY l_unites_geo.the_geom, l_unites_geo.id_unite_geo;]]></expression>
	</reference>
</view>

<table name="bib_typeszones">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7985.65" y="135.061"/>
	<column name="id_type" not-null="true">
		<type name="integer"/>
	</column>
	<column name="typezone">
		<type name="character varying" length="200"/>
	</column>
	<constraint name="pk_typeszones" type="pk-constr" table="layers.bib_typeszones">
		<columns names="id_type" ref-type="src-columns"/>
	</constraint>
</table>

<table name="l_aireadhesion">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7633.86" y="100.657"/>
	<column name="gid" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id">
		<type name="integer"/>
	</column>
	<column name="nouveaucha">
		<type name="integer"/>
	</column>
	<column name="count">
		<type name="integer"/>
	</column>
	<column name="length">
		<type name="double precision"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom" type="ck-constr" table="layers.l_aireadhesion">
			<expression><![CDATA[(public.st_ndims(the_geom) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_aireadhesion">
			<expression><![CDATA[((((public.geometrytype(the_geom) = 'LINESTRING'::text) OR (public.geometrytype(the_geom) = 'MULTIPOLYGON'::text)) OR (public.geometrytype(the_geom) = 'POLYGON'::text)) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_aireadhesion">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="aireadhesion_pkey" type="pk-constr" table="layers.l_aireadhesion">
		<columns names="gid" ref-type="src-columns"/>
	</constraint>
</table>

<table name="l_communes">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7252.12" y="92.3229"/>
	<column name="insee" not-null="true">
		<type name="character" length="5"/>
	</column>
	<column name="idbdcarto">
		<type name="bigint"/>
	</column>
	<column name="commune_maj">
		<type name="character varying" length="50"/>
	</column>
	<column name="commune_min">
		<type name="character varying" length="50"/>
	</column>
	<column name="inseedep">
		<type name="character varying" length="3"/>
	</column>
	<column name="nomdep">
		<type name="character varying" length="30"/>
	</column>
	<column name="inseereg">
		<type name="character varying" length="2"/>
	</column>
	<column name="nomreg">
		<type name="character varying" length="30"/>
	</column>
	<column name="inseearr">
		<type name="character varying"/>
	</column>
	<column name="inseecan">
		<type name="character varying" length="2"/>
	</column>
	<column name="statut">
		<type name="character varying" length="20"/>
	</column>
	<column name="xcom">
		<type name="bigint"/>
	</column>
	<column name="ycom">
		<type name="bigint"/>
	</column>
	<column name="surface">
		<type name="bigint"/>
	</column>
	<column name="epci">
		<type name="character varying" length="40"/>
	</column>
	<column name="coeur_aoa">
		<type name="character varying" length="5"/>
	</column>
	<column name="codenum">
		<type name="integer"/>
	</column>
	<column name="pays">
		<type name="character varying" length="50"/>
	</column>
	<column name="id_secteur">
		<type name="integer"/>
	</column>
	<column name="saisie">
		<type name="boolean"/>
	</column>
	<column name="organisme">
		<type name="boolean"/>
	</column>
	<column name="id_secteur_fp">
		<type name="integer"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom" type="ck-constr" table="layers.l_communes">
			<expression><![CDATA[(public.st_ndims(the_geom) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_communes">
			<expression><![CDATA[((public.geometrytype(the_geom) = 'MULTIPOLYGON'::text) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_communes">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="l_communes_pkey" type="pk-constr" table="layers.l_communes">
		<columns names="insee" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="l_isolines20_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="layers"/>
	<role name="geonatuser"/>
</sequence>

<table name="l_isolines20">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="8049.39" y="689.465"/>
	<column name="gid" not-null="true" default-value="nextval('l_isolines20_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="iso">
		<type name="bigint"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom" type="ck-constr" table="layers.l_isolines20">
			<expression><![CDATA[(public.st_ndims(the_geom) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_isolines20">
			<expression><![CDATA[((public.geometrytype(the_geom) = 'MULTILINESTRING'::text) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_isolines20">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="l_isolines20_pkey" type="pk-constr" table="layers.l_isolines20">
		<columns names="gid" ref-type="src-columns"/>
	</constraint>
</table>

<table name="l_secteurs">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7271.91" y="499.094"/>
	<column name="nom_secteur">
		<type name="character varying" length="50"/>
	</column>
	<column name="id_secteur" not-null="true">
		<type name="integer"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom" type="ck-constr" table="layers.l_secteurs">
			<expression><![CDATA[(public.st_ndims(the_geom) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_secteurs">
			<expression><![CDATA[((public.geometrytype(the_geom) = 'MULTIPOLYGON'::text) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_secteurs">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="pk_l_secteurs" type="pk-constr" table="layers.l_secteurs">
		<columns names="id_secteur" ref-type="src-columns"/>
	</constraint>
</table>

<table name="l_zonesstatut">
	<schema name="layers"/>
	<role name="geonatuser"/>
	<position x="7638.5" y="264.094"/>
	<column name="id_zone" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_type" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_mnhn">
		<type name="character varying" length="20"/>
	</column>
	<column name="nomzone">
		<type name="character varying" length="250"/>
	</column>
	<column name="the_geom">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_geotype_the_geom" type="ck-constr" table="layers.l_zonesstatut">
			<expression><![CDATA[((public.geometrytype(the_geom) = 'MULTIPOLYGON'::text) OR (the_geom IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom" type="ck-constr" table="layers.l_zonesstatut">
			<expression><![CDATA[(public.st_srid(the_geom) = 2154)]]></expression>
	</constraint>
	<constraint name="pk_l_zonesstatut" type="pk-constr" table="layers.l_zonesstatut">
		<columns names="id_zone" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_lots">
	<schema name="meta"/>
	<role name="geonatuser"/>
	<position x="2999.67" y="1256.13"/>
	<column name="id_lot" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_lot">
		<type name="character varying" length="255"/>
	</column>
	<column name="desc_lot">
		<type name="text"/>
	</column>
	<column name="menu_cf" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="pn" default-value="true">
		<type name="boolean"/>
	</column>
	<column name="menu_inv" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="id_programme" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="bib_lots_pkey" type="pk-constr" table="meta.bib_lots">
		<columns names="id_lot" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_programmes">
	<schema name="meta"/>
	<role name="geonatuser"/>
	<position x="3535.17" y="1245.3"/>
	<column name="id_programme" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_programme">
		<type name="character varying" length="255"/>
	</column>
	<column name="desc_programme">
		<type name="text"/>
	</column>
	<column name="actif">
		<type name="boolean"/>
	</column>
	<column name="programme_public">
		<type name="boolean"/>
	</column>
	<column name="desc_programme_public">
		<type name="text"/>
	</column>
	<constraint name="bib_programmes_pkey" type="pk-constr" table="meta.bib_programmes">
		<columns names="id_programme" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_supports">
	<schema name="meta"/>
	<role name="geonatuser"/>
	<position x="3092.5" y="1431.13"/>
	<column name="id_support" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_support" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<constraint name="bib_supports_pkey" type="pk-constr" table="meta.bib_supports">
		<columns names="id_support" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_precisions">
	<schema name="meta"/>
	<role name="geonatuser"/>
	<position x="3533.67" y="1548.63"/>
	<column name="id_precision" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_precision">
		<type name="character varying" length="50"/>
	</column>
	<column name="desc_precision">
		<type name="text"/>
	</column>
	<constraint name="pk_bib_precision" type="pk-constr" table="meta.t_precisions">
		<columns names="id_precision" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_protocoles">
	<schema name="meta"/>
	<role name="geonatuser"/>
	<position x="3086.5" y="1558.63"/>
	<column name="id_protocole" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_protocole">
		<type name="character varying" length="250"/>
	</column>
	<column name="question">
		<type name="text"/>
	</column>
	<column name="objectifs">
		<type name="text"/>
	</column>
	<column name="methode">
		<type name="text"/>
	</column>
	<column name="avancement">
		<type name="character varying" length="50"/>
	</column>
	<column name="date_debut">
		<type name="date"/>
	</column>
	<column name="date_fin">
		<type name="date"/>
	</column>
	<constraint name="pk_bib_protocoles" type="pk-constr" table="meta.t_protocoles">
		<columns names="id_protocole" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_criteres_synthese">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="2578.33" y="2007.73"/>
	<column name="id_critere_synthese" not-null="true">
		<type name="integer"/>
	</column>
	<column name="code_critere_synthese">
		<type name="character varying" length="3"/>
	</column>
	<column name="nom_critere_synthese">
		<type name="character varying" length="90"/>
	</column>
	<column name="tri">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_criteres_synthese" type="pk-constr" table="synthese.bib_criteres_synthese">
		<columns names="id_critere_synthese" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="syntheseff_id_synthese_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="synthese"/>
	<role name="geonatuser"/>
</sequence>

<sequence name="bib_organismes_id_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
</sequence>

<table name="bib_organismes">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="3628.28" y="2977.26"/>
	<column name="nom_organisme" not-null="true">
		<type name="character varying" length="100"/>
	</column>
	<column name="adresse_organisme">
		<type name="character varying" length="128"/>
	</column>
	<column name="cp_organisme">
		<type name="character varying" length="5"/>
	</column>
	<column name="ville_organisme">
		<type name="character varying" length="100"/>
	</column>
	<column name="tel_organisme">
		<type name="character varying" length="14"/>
	</column>
	<column name="fax_organisme">
		<type name="character varying" length="14"/>
	</column>
	<column name="email_organisme">
		<type name="character varying" length="100"/>
	</column>
	<column name="id_organisme" not-null="true" default-value="nextval('bib_organismes_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_organismes" type="pk-constr" table="utilisateurs.bib_organismes">
		<columns names="id_organisme" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="erreurs_cf_id_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
</sequence>

<table name="erreurs_cf">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
	<position x="1234.33" y="3159.46"/>
	<column name="id" not-null="true" default-value="nextval('erreurs_cf_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="json">
		<type name="text"/>
	</column>
	<column name="date_import">
		<type name="date"/>
	</column>
	<constraint name="erreurs_cf_pkey" type="pk-constr" table="synchronomade.erreurs_cf">
		<columns names="id" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="erreurs_inv_id_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
</sequence>

<table name="erreurs_inv">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
	<position x="1461.83" y="3159.46"/>
	<column name="id" not-null="true" default-value="nextval('erreurs_inv_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="json">
		<type name="text"/>
	</column>
	<column name="date_import">
		<type name="date"/>
	</column>
	<constraint name="erreurs_inv_pkey" type="pk-constr" table="synchronomade.erreurs_inv">
		<columns names="id" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="erreurs_mortalite_id_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
</sequence>

<table name="erreurs_mortalite">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
	<position x="1689.33" y="3159.46"/>
	<column name="id" not-null="true" default-value="nextval('erreurs_mortalite_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="json">
		<type name="text"/>
	</column>
	<column name="date_import">
		<type name="date"/>
	</column>
	<constraint name="erreurs_mortalite_pkey" type="pk-constr" table="synchronomade.erreurs_mortalite">
		<columns names="id" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="erreurs_flora_id_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
</sequence>

<table name="erreurs_flora">
	<schema name="synchronomade"/>
	<role name="geonatuser"/>
	<position x="1953.93" y="3159.46"/>
	<column name="id" not-null="true" default-value="nextval('erreurs_flora_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="json">
		<type name="text"/>
	</column>
	<column name="date_import">
		<type name="date"/>
	</column>
	<constraint name="erreurs_flora_pkey" type="pk-constr" table="synchronomade.erreurs_flora">
		<columns names="id" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_sources">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3556.43" y="2262.73"/>
	<column name="id_source" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_source">
		<type name="character varying" length="255"/>
	</column>
	<column name="desc_source">
		<type name="text"/>
	</column>
	<column name="host">
		<type name="character varying" length="100"/>
	</column>
	<column name="port">
		<type name="integer"/>
	</column>
	<column name="username">
		<type name="character varying" length="50"/>
	</column>
	<column name="pass">
		<type name="character varying" length="50"/>
	</column>
	<column name="db_name">
		<type name="character varying" length="50"/>
	</column>
	<column name="db_schema">
		<type name="character varying" length="50"/>
	</column>
	<column name="db_table">
		<type name="character varying" length="50"/>
	</column>
	<column name="db_field">
		<type name="character varying" length="50"/>
	</column>
	<column name="url">
		<type name="character varying" length="255"/>
	</column>
	<column name="target">
		<type name="character varying" length="10"/>
	</column>
	<column name="picto">
		<type name="character varying" length="255"/>
	</column>
	<column name="groupe" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="actif" not-null="true">
		<type name="boolean"/>
	</column>
	<constraint name="bib_sources_pkey" type="pk-constr" table="synthese.bib_sources">
		<columns names="id_source" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_unite_synthese">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3786.93" y="2092.73"/>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_synthese" not-null="true">
		<type name="integer"/>
	</column>
	<column name="dateobs">
		<type name="date"/>
	</column>
	<column name="cd_nom">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_unite_synthese" type="pk-constr" table="synthese.cor_unite_synthese">
		<columns names="id_unite_geo,id_synthese" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_zonesstatut_synthese">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3782.53" y="1986.06"/>
	<column name="id_zone" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_synthese" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_zonesstatut_synthese" type="pk-constr" table="synthese.cor_zonesstatut_synthese">
		<columns names="id_zone,id_synthese" ref-type="src-columns"/>
	</constraint>
</table>

<table name="syntheseff">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<comment><![CDATA[Table de synthèse destinée à recevoir les données de tous les schémas.Pour consultation uniquement]]></comment>
	<position x="3009.16" y="1994.4"/>
	<column name="id_synthese" not-null="true" default-value="nextval('syntheseff_id_synthese_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="id_source">
		<type name="integer"/>
	</column>
	<column name="id_fiche_source">
		<type name="character varying" length="50"/>
	</column>
	<column name="code_fiche_source">
		<type name="character varying" length="50"/>
	</column>
	<column name="id_organisme">
		<type name="integer"/>
	</column>
	<column name="id_protocole">
		<type name="integer"/>
	</column>
	<column name="id_precision">
		<type name="integer"/>
	</column>
	<column name="cd_nom">
		<type name="integer"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="dateobs" not-null="true">
		<type name="date"/>
	</column>
	<column name="observateurs">
		<type name="character varying" length="255"/>
	</column>
	<column name="determinateur">
		<type name="character varying" length="255"/>
	</column>
	<column name="altitude_retenue">
		<type name="integer"/>
	</column>
	<column name="remarques">
		<type name="text"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="derniere_action">
		<type name="character"/>
	</column>
	<column name="supprime">
		<type name="boolean"/>
	</column>
	<column name="the_geom_point">
		<type name="geometry"/>
	</column>
	<column name="id_lot">
		<type name="integer"/>
	</column>
	<column name="id_critere_synthese">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="effectif_total">
		<type name="integer"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_point" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_ndims(the_geom_point) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_point" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[((public.geometrytype(the_geom_point) = 'POINT'::text) OR (the_geom_point IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_point" type="ck-constr" table="synthese.syntheseff">
			<expression><![CDATA[(public.st_srid(the_geom_point) = 3857)]]></expression>
	</constraint>
	<constraint name="syntheseff_pkey" type="pk-constr" table="synthese.syntheseff">
		<columns names="id_synthese" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_taxref_habitats">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3340.9" y="196.932"/>
	<column name="id_habitat" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_habitat" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="pk_bib_taxref_habitats" type="pk-constr" table="taxonomie.bib_taxref_habitats">
		<columns names="id_habitat" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_taxref_rangs">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3361.4" y="120.265"/>
	<column name="id_rang" not-null="true">
		<type name="character" length="4"/>
	</column>
	<column name="nom_rang" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<constraint name="pk_bib_taxref_rangs" type="pk-constr" table="taxonomie.bib_taxref_rangs">
		<columns names="id_rang" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_taxref_statuts">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3310.56" y="43.5987"/>
	<column name="id_statut" not-null="true">
		<type name="character"/>
	</column>
	<column name="nom_statut" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<constraint name="pk_bib_taxref_statuts" type="pk-constr" table="taxonomie.bib_taxref_statuts">
		<columns names="id_statut" ref-type="src-columns"/>
	</constraint>
</table>

<table name="import_taxref">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="2543.79" y="47.7986"/>
	<column name="regne">
		<type name="character varying" length="20"/>
	</column>
	<column name="phylum">
		<type name="character varying" length="50"/>
	</column>
	<column name="classe">
		<type name="character varying" length="50"/>
	</column>
	<column name="ordre">
		<type name="character varying" length="50"/>
	</column>
	<column name="famille">
		<type name="character varying" length="50"/>
	</column>
	<column name="group1_inpn">
		<type name="character varying" length="50"/>
	</column>
	<column name="group2_inpn">
		<type name="character varying" length="50"/>
	</column>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="cd_taxsup">
		<type name="integer"/>
	</column>
	<column name="cd_ref">
		<type name="integer"/>
	</column>
	<column name="rang">
		<type name="character varying" length="10"/>
	</column>
	<column name="lb_nom">
		<type name="character varying" length="100"/>
	</column>
	<column name="lb_auteur">
		<type name="character varying" length="250"/>
	</column>
	<column name="nom_complet">
		<type name="character varying" length="255"/>
	</column>
	<column name="nom_complet_html">
		<type name="character varying" length="500"/>
	</column>
	<column name="nom_valide">
		<type name="character varying" length="255"/>
	</column>
	<column name="nom_vern">
		<type name="character varying" length="1000"/>
	</column>
	<column name="nom_vern_eng">
		<type name="character varying" length="500"/>
	</column>
	<column name="habitat">
		<type name="character varying" length="10"/>
	</column>
	<column name="fr">
		<type name="character varying" length="10"/>
	</column>
	<column name="gf">
		<type name="character varying" length="10"/>
	</column>
	<column name="mar">
		<type name="character varying" length="10"/>
	</column>
	<column name="gua">
		<type name="character varying" length="10"/>
	</column>
	<column name="sm">
		<type name="character varying" length="10"/>
	</column>
	<column name="sb">
		<type name="character varying" length="10"/>
	</column>
	<column name="spm">
		<type name="character varying" length="10"/>
	</column>
	<column name="may">
		<type name="character varying" length="10"/>
	</column>
	<column name="epa">
		<type name="character varying" length="10"/>
	</column>
	<column name="reu">
		<type name="character varying" length="10"/>
	</column>
	<column name="taaf">
		<type name="character varying" length="10"/>
	</column>
	<column name="pf">
		<type name="character varying" length="10"/>
	</column>
	<column name="nc">
		<type name="character varying" length="10"/>
	</column>
	<column name="wf">
		<type name="character varying" length="10"/>
	</column>
	<column name="cli">
		<type name="character varying" length="10"/>
	</column>
	<column name="url">
		<type name="text"/>
	</column>
	<constraint name="pk_import_taxref" type="pk-constr" table="taxonomie.import_taxref">
		<columns names="cd_nom" ref-type="src-columns"/>
	</constraint>
</table>

<table name="taxref_changes">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="2932.96" y="46.1319"/>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="num_version_init">
		<type name="character varying" length="5"/>
	</column>
	<column name="num_version_final">
		<type name="character varying" length="5"/>
	</column>
	<column name="champ" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="valeur_init">
		<type name="character varying" length="255"/>
	</column>
	<column name="valeur_final">
		<type name="character varying" length="255"/>
	</column>
	<column name="type_change">
		<type name="character varying" length="25"/>
	</column>
	<constraint name="pk_taxref_changes" type="pk-constr" table="taxonomie.taxref_changes">
		<columns names="cd_nom,champ" ref-type="src-columns"/>
	</constraint>
</table>

<table name="taxref_protection_articles">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="4131.8" y="44.4653"/>
	<column name="cd_protection" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<column name="article">
		<type name="character varying" length="100"/>
	</column>
	<column name="intitule">
		<type name="text"/>
	</column>
	<column name="protection">
		<type name="text"/>
	</column>
	<column name="arrete">
		<type name="text"/>
	</column>
	<column name="fichier">
		<type name="text"/>
	</column>
	<column name="fg_afprot">
		<type name="integer"/>
	</column>
	<column name="niveau">
		<type name="character varying" length="250"/>
	</column>
	<column name="cd_arrete">
		<type name="integer"/>
	</column>
	<column name="url">
		<type name="character varying" length="250"/>
	</column>
	<column name="date_arrete">
		<type name="integer"/>
	</column>
	<column name="rang_niveau">
		<type name="integer"/>
	</column>
	<column name="lb_article">
		<type name="text"/>
	</column>
	<column name="type_protection">
		<type name="character varying" length="250"/>
	</column>
	<column name="concerne_mon_territoire">
		<type name="boolean"/>
	</column>
	<constraint name="taxref_protection_articles_pkey" type="pk-constr" table="taxonomie.taxref_protection_articles">
		<columns names="cd_protection" ref-type="src-columns"/>
	</constraint>
</table>

<table name="taxref_protection_especes">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="3728.29" y="164.465"/>
	<column name="cd_nom" not-null="true">
		<type name="integer"/>
	</column>
	<column name="cd_protection" not-null="true">
		<type name="character varying" length="20"/>
	</column>
	<column name="nom_cite">
		<type name="character varying" length="200"/>
	</column>
	<column name="syn_cite">
		<type name="character varying" length="200"/>
	</column>
	<column name="nom_francais_cite">
		<type name="character varying" length="100"/>
	</column>
	<column name="precisions">
		<type name="text"/>
	</column>
	<column name="cd_nom_cite" not-null="true">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="taxref_protection_especes_pkey" type="pk-constr" table="taxonomie.taxref_protection_especes">
		<columns names="cd_nom,cd_protection,cd_nom_cite" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_tree_taxons_synthese">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3018.33" y="2531.93"/>
	<reference>
		<expression><![CDATA[ WITH taxon AS (
         SELECT tx.id_taxon,
            tx.nom_latin,
            tx.nom_francais,
            taxref.cd_nom,
            taxref.id_statut,
            taxref.id_habitat,
            taxref.id_rang,
            taxref.regne,
            taxref.phylum,
            taxref.classe,
            taxref.ordre,
            taxref.famille,
            taxref.cd_taxsup,
            taxref.cd_ref,
            taxref.lb_nom,
            taxref.lb_auteur,
            taxref.nom_complet,
            taxref.nom_valide,
            taxref.nom_vern,
            taxref.nom_vern_eng,
            taxref.group1_inpn,
            taxref.group2_inpn
           FROM (( SELECT tx_1.id_taxon,
                    taxref_1.cd_nom,
                    taxref_1.cd_ref,
                    taxref_1.lb_nom AS nom_latin,
                        CASE
                            WHEN (tx_1.nom_francais IS NULL) THEN taxref_1.lb_nom
                            WHEN ((tx_1.nom_francais)::text = ''::text) THEN taxref_1.lb_nom
                            ELSE tx_1.nom_francais
                        END AS nom_francais
                   FROM (taxonomie.taxref taxref_1
                     LEFT JOIN taxonomie.bib_taxons tx_1 ON ((tx_1.cd_nom = taxref_1.cd_nom)))
                  WHERE (taxref_1.cd_nom IN ( SELECT DISTINCT syntheseff.cd_nom
                           FROM synthese.syntheseff))) tx
             JOIN taxonomie.taxref taxref ON ((taxref.cd_nom = tx.cd_ref)))
        )
 SELECT t.id_taxon,
    t.cd_ref,
    t.nom_latin,
    t.nom_francais,
    t.id_regne,
    t.nom_regne,
    COALESCE(t.id_embranchement, t.id_regne) AS id_embranchement,
    COALESCE(t.nom_embranchement, ' Sans embranchement dans taxref'::character varying) AS nom_embranchement,
    COALESCE(t.id_classe, t.id_embranchement) AS id_classe,
    COALESCE(t.nom_classe, ' Sans classe dans taxref'::character varying) AS nom_classe,
    COALESCE(t.desc_classe, ' Sans classe dans taxref'::character varying) AS desc_classe,
    COALESCE(t.id_ordre, t.id_classe) AS id_ordre,
    COALESCE(t.nom_ordre, ' Sans ordre dans taxref'::character varying) AS nom_ordre,
    COALESCE(t.id_famille, t.id_ordre) AS id_famille,
    COALESCE(t.nom_famille, ' Sans famille dans taxref'::character varying) AS nom_famille
   FROM ( SELECT DISTINCT t_1.id_taxon,
            t_1.cd_ref,
            t_1.nom_latin,
            t_1.nom_francais,
            ( SELECT taxref.cd_nom
                   FROM taxonomie.taxref
                  WHERE ((taxref.id_rang = 'KD'::bpchar) AND ((taxref.lb_nom)::text = (t_1.regne)::text))) AS id_regne,
            t_1.regne AS nom_regne,
            ph.cd_nom AS id_embranchement,
            t_1.phylum AS nom_embranchement,
            t_1.phylum AS desc_embranchement,
            cl.cd_nom AS id_classe,
            t_1.classe AS nom_classe,
            t_1.classe AS desc_classe,
            ord.cd_nom AS id_ordre,
            t_1.ordre AS nom_ordre,
            f.cd_nom AS id_famille,
            t_1.famille AS nom_famille
           FROM ((((taxon t_1
             LEFT JOIN taxonomie.taxref ph ON (((((ph.id_rang = 'PH'::bpchar) AND (ph.cd_nom = ph.cd_ref)) AND ((ph.lb_nom)::text = (t_1.phylum)::text)) AND (NOT (t_1.phylum IS NULL)))))
             LEFT JOIN taxonomie.taxref cl ON (((((cl.id_rang = 'CL'::bpchar) AND (cl.cd_nom = cl.cd_ref)) AND ((cl.lb_nom)::text = (t_1.classe)::text)) AND (NOT (t_1.classe IS NULL)))))
             LEFT JOIN taxonomie.taxref ord ON (((((ord.id_rang = 'OR'::bpchar) AND (ord.cd_nom = ord.cd_ref)) AND ((ord.lb_nom)::text = (t_1.ordre)::text)) AND (NOT (t_1.ordre IS NULL)))))
             LEFT JOIN taxonomie.taxref f ON ((((((f.id_rang = 'FM'::bpchar) AND (f.cd_nom = f.cd_ref)) AND ((f.lb_nom)::text = (t_1.famille)::text)) AND ((f.phylum)::text = (t_1.phylum)::text)) AND (NOT (t_1.famille IS NULL)))))) t;]]></expression>
	</reference>
</view>

<view name="v_taxons_synthese">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3249.93" y="2528.6"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT t.nom_francais,
    txr.lb_nom AS nom_latin,
    f2.bool AS patrimonial,
    f3.bool AS protection_stricte,
    txr.cd_ref,
    txr.cd_nom,
    txr.nom_valide,
    txr.famille,
    txr.ordre,
    txr.classe,
    txr.regne,
    prot.protections,
    l.id_liste,
    l.picto
   FROM (((((((taxonomie.taxref txr
     JOIN taxonomie.bib_taxons t ON ((txr.cd_nom = t.cd_nom)))
     JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_taxon = t.id_taxon)))
     JOIN taxonomie.bib_listes l ON (((l.id_liste = ctl.id_liste) AND (l.id_liste = ANY (ARRAY[1001, 1002, 1003, 1004])))))
     LEFT JOIN ( SELECT tpe.cd_nom,
            string_agg(((((tpa.arrete || ' '::text) || (tpa.article)::text) || '__'::text) || (tpa.url)::text), '#'::text) AS protections
           FROM (taxonomie.taxref_protection_especes tpe
             JOIN taxonomie.taxref_protection_articles tpa ON ((((tpa.cd_protection)::text = (tpe.cd_protection)::text) AND (tpa.concerne_mon_territoire = true))))
          GROUP BY tpe.cd_nom) prot ON ((prot.cd_nom = t.cd_nom)))
     JOIN cor_boolean f2 ON (((f2.expression)::text = (t.filtre2)::text)))
     JOIN cor_boolean f3 ON (((f3.expression)::text = (t.filtre3)::text)))
     JOIN ( SELECT DISTINCT syntheseff.cd_nom
           FROM synthese.syntheseff
          WHERE (syntheseff.supprime = false)) s ON ((s.cd_nom = t.cd_nom)))
  ORDER BY t.nom_francais;]]></expression>
	</reference>
</view>

<table name="bib_droits">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="2733.63" y="3446.3"/>
	<column name="id_droit" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_droit">
		<type name="character varying" length="50"/>
	</column>
	<column name="desc_droit">
		<type name="text"/>
	</column>
	<constraint name="bib_droits_pkey" type="pk-constr" table="utilisateurs.bib_droits">
		<columns names="id_droit" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="bib_unites_id_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
</sequence>

<table name="bib_unites">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="4251.44" y="3251.51"/>
	<column name="nom_unite" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="adresse_unite">
		<type name="character varying" length="128"/>
	</column>
	<column name="cp_unite">
		<type name="character varying" length="5"/>
	</column>
	<column name="ville_unite">
		<type name="character varying" length="100"/>
	</column>
	<column name="tel_unite">
		<type name="character varying" length="14"/>
	</column>
	<column name="fax_unite">
		<type name="character varying" length="14"/>
	</column>
	<column name="email_unite">
		<type name="character varying" length="100"/>
	</column>
	<column name="id_unite" not-null="true" default-value="nextval('bib_unites_id_seq'::regclass)">
		<type name="integer"/>
	</column>
	<constraint name="pk_bib_services" type="pk-constr" table="utilisateurs.bib_unites">
		<columns names="id_unite" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_role_droit_application">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="3058.32" y="3293.17"/>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_droit" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_application" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="cor_role_droit_application_pkey" type="pk-constr" table="utilisateurs.cor_role_droit_application">
		<columns names="id_role,id_droit,id_application" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_applications_id_application_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_applications">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="2704.87" y="3186.74"/>
	<column name="id_application" not-null="true" default-value="nextval('t_applications_id_application_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="nom_application" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="desc_application">
		<type name="text"/>
	</column>
	<constraint name="t_applications_pkey" type="pk-constr" table="utilisateurs.t_applications">
		<columns names="id_application" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_menus_id_menu_seq"
	 start="1000000" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_menus">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<comment><![CDATA[table des menus déroulants des applications. Les roles de niveau groupes ou utilisateurs devant figurer dans un menu sont gérés dans la table cor_role_menu_application.]]></comment>
	<position x="2348.18" y="3013.41"/>
	<column name="id_menu" not-null="true" default-value="nextval('t_menus_id_menu_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="nom_menu" not-null="true">
		<type name="character varying" length="50"/>
	</column>
	<column name="desc_menu">
		<type name="text"/>
	</column>
	<column name="id_application">
		<type name="integer"/>
	</column>
	<constraint name="t_menus_pkey" type="pk-constr" table="utilisateurs.t_menus">
		<columns names="id_menu" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_observateurs_all">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="4144.02" y="3535.79"/>
	<reference>
		<expression><![CDATA[( SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role,
    'fauna'::text AS mode
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 9)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 9)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role)
UNION
( SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role,
    'flora'::text AS mode
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 10)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 10)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role)
UNION
( SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role,
    'inv'::text AS mode
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 9)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 9)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role);]]></expression>
	</reference>
</view>

<view name="v_observateurs">
	<schema name="utilisateurs"/>
	<role name="geonatuser"/>
	<position x="4391.68" y="3539.09"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT r.id_role AS codeobs,
    (((r.nom_role)::text || ' '::text) || (r.prenom_role)::text) AS nomprenom
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 9)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 9)) AND (r_1.groupe = false)))))))
  ORDER BY (((r.nom_role)::text || ' '::text) || (r.prenom_role)::text), r.id_role;]]></expression>
	</reference>
</view>

<view name="v_mobile_observateurs_fp">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5557.13" y="741.866"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 5)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 5)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role;]]></expression>
	</reference>
</view>

<view name="v_touteslesap_2154_line">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4807.73" y="1091.87"/>
	<reference>
		<expression><![CDATA[ SELECT ap.indexap AS gid,
    ap.indexzp,
    ap.indexap,
    s.nom_secteur AS secteur,
    zp.dateobs,
    t.latin AS taxon,
    o.observateurs,
    p.pheno AS phenologie,
    ap.surfaceap,
    ap.insee,
    com.commune_min,
    ap.altitude_retenue AS altitude,
    f.nom_frequence_methodo_new AS met_frequence,
    ap.frequenceap,
    compt.nom_comptage_methodo AS met_comptage,
    ap.total_fertiles AS tot_fertiles,
    ap.total_steriles AS tot_steriles,
    per.perturbations,
    phy.physionomies,
    ap.the_geom_2154,
    ap.topo_valid AS ap_topo_valid,
    zp.validation AS relue,
    ap.remarques
   FROM ((((((((((florepatri.t_apresence ap
     JOIN florepatri.t_zprospection zp ON ((ap.indexzp = zp.indexzp)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = zp.cd_nom)))
     JOIN layers.l_secteurs s ON ((s.id_secteur = zp.id_secteur)))
     JOIN florepatri.bib_phenologies p ON ((p.codepheno = ap.codepheno)))
     JOIN layers.l_communes com ON ((com.insee = ap.insee)))
     JOIN florepatri.bib_frequences_methodo_new f ON ((f.id_frequence_methodo_new = ap.id_frequence_methodo_new)))
     JOIN florepatri.bib_comptages_methodo compt ON ((compt.id_comptage_methodo = ap.id_comptage_methodo)))
     JOIN ( SELECT c.indexzp,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florepatri.cor_zp_obs c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.codeobs)))
          GROUP BY c.indexzp) o ON ((o.indexzp = ap.indexzp)))
     LEFT JOIN ( SELECT c.indexap,
            array_to_string(array_agg(((((per_1.description)::text || ' ('::text) || (per_1.classification)::text) || ')'::text)), ', '::text) AS perturbations
           FROM (florepatri.cor_ap_perturb c
             JOIN florepatri.bib_perturbations per_1 ON ((per_1.codeper = c.codeper)))
          GROUP BY c.indexap) per ON ((per.indexap = ap.indexap)))
     LEFT JOIN ( SELECT p_1.indexap,
            array_to_string(array_agg(((((phy_1.nom_physionomie)::text || ' ('::text) || (phy_1.groupe_physionomie)::text) || ')'::text)), ', '::text) AS physionomies
           FROM (florepatri.cor_ap_physionomie p_1
             JOIN florepatri.bib_physionomies phy_1 ON ((phy_1.id_physionomie = p_1.id_physionomie)))
          GROUP BY p_1.indexap) phy ON ((phy.indexap = ap.indexap)))
  WHERE ((ap.supprime = false) AND (geometrytype(ap.the_geom_2154) = 'LINESTRING'::text))
  ORDER BY s.nom_secteur, ap.indexzp;]]></expression>
	</reference>
</view>

<view name="v_touteslesap_2154_point">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5135.33" y="1091.87"/>
	<reference>
		<expression><![CDATA[ SELECT ap.indexap AS gid,
    ap.indexzp,
    ap.indexap,
    s.nom_secteur AS secteur,
    zp.dateobs,
    t.latin AS taxon,
    o.observateurs,
    p.pheno AS phenologie,
    ap.surfaceap,
    ap.insee,
    com.commune_min,
    ap.altitude_retenue AS altitude,
    f.nom_frequence_methodo_new AS met_frequence,
    ap.frequenceap,
    compt.nom_comptage_methodo AS met_comptage,
    ap.total_fertiles AS tot_fertiles,
    ap.total_steriles AS tot_steriles,
    per.perturbations,
    phy.physionomies,
    ap.the_geom_2154,
    ap.topo_valid AS ap_topo_valid,
    zp.validation AS relue,
    ap.remarques
   FROM ((((((((((florepatri.t_apresence ap
     JOIN florepatri.t_zprospection zp ON ((ap.indexzp = zp.indexzp)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = zp.cd_nom)))
     JOIN layers.l_secteurs s ON ((s.id_secteur = zp.id_secteur)))
     JOIN florepatri.bib_phenologies p ON ((p.codepheno = ap.codepheno)))
     JOIN layers.l_communes com ON ((com.insee = ap.insee)))
     JOIN florepatri.bib_frequences_methodo_new f ON ((f.id_frequence_methodo_new = ap.id_frequence_methodo_new)))
     JOIN florepatri.bib_comptages_methodo compt ON ((compt.id_comptage_methodo = ap.id_comptage_methodo)))
     JOIN ( SELECT c.indexzp,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florepatri.cor_zp_obs c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.codeobs)))
          GROUP BY c.indexzp) o ON ((o.indexzp = ap.indexzp)))
     LEFT JOIN ( SELECT c.indexap,
            array_to_string(array_agg(((((per_1.description)::text || ' ('::text) || (per_1.classification)::text) || ')'::text)), ', '::text) AS perturbations
           FROM (florepatri.cor_ap_perturb c
             JOIN florepatri.bib_perturbations per_1 ON ((per_1.codeper = c.codeper)))
          GROUP BY c.indexap) per ON ((per.indexap = ap.indexap)))
     LEFT JOIN ( SELECT p_1.indexap,
            array_to_string(array_agg(((((phy_1.nom_physionomie)::text || ' ('::text) || (phy_1.groupe_physionomie)::text) || ')'::text)), ', '::text) AS physionomies
           FROM (florepatri.cor_ap_physionomie p_1
             JOIN florepatri.bib_physionomies phy_1 ON ((phy_1.id_physionomie = p_1.id_physionomie)))
          GROUP BY p_1.indexap) phy ON ((phy.indexap = ap.indexap)))
  WHERE ((ap.supprime = false) AND (geometrytype(ap.the_geom_2154) = 'POINT'::text))
  ORDER BY s.nom_secteur, ap.indexzp;]]></expression>
	</reference>
</view>

<view name="v_touteslesap_2154_polygon">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5296.93" y="740.2"/>
	<reference>
		<expression><![CDATA[ SELECT ap.indexap AS gid,
    ap.indexzp,
    ap.indexap,
    s.nom_secteur AS secteur,
    zp.dateobs,
    t.latin AS taxon,
    o.observateurs,
    p.pheno AS phenologie,
    ap.surfaceap,
    ap.insee,
    com.commune_min,
    ap.altitude_retenue AS altitude,
    f.nom_frequence_methodo_new AS met_frequence,
    ap.frequenceap,
    compt.nom_comptage_methodo AS met_comptage,
    ap.total_fertiles AS tot_fertiles,
    ap.total_steriles AS tot_steriles,
    per.perturbations,
    phy.physionomies,
    ap.the_geom_2154,
    ap.topo_valid AS ap_topo_valid,
    zp.validation AS relue,
    ap.remarques
   FROM ((((((((((florepatri.t_apresence ap
     JOIN florepatri.t_zprospection zp ON ((ap.indexzp = zp.indexzp)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = zp.cd_nom)))
     JOIN layers.l_secteurs s ON ((s.id_secteur = zp.id_secteur)))
     JOIN florepatri.bib_phenologies p ON ((p.codepheno = ap.codepheno)))
     JOIN layers.l_communes com ON ((com.insee = ap.insee)))
     JOIN florepatri.bib_frequences_methodo_new f ON ((f.id_frequence_methodo_new = ap.id_frequence_methodo_new)))
     JOIN florepatri.bib_comptages_methodo compt ON ((compt.id_comptage_methodo = ap.id_comptage_methodo)))
     JOIN ( SELECT c.indexzp,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florepatri.cor_zp_obs c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.codeobs)))
          GROUP BY c.indexzp) o ON ((o.indexzp = ap.indexzp)))
     LEFT JOIN ( SELECT c.indexap,
            array_to_string(array_agg(((((per_1.description)::text || ' ('::text) || (per_1.classification)::text) || ')'::text)), ', '::text) AS perturbations
           FROM (florepatri.cor_ap_perturb c
             JOIN florepatri.bib_perturbations per_1 ON ((per_1.codeper = c.codeper)))
          GROUP BY c.indexap) per ON ((per.indexap = ap.indexap)))
     LEFT JOIN ( SELECT p_1.indexap,
            array_to_string(array_agg(((((phy_1.nom_physionomie)::text || ' ('::text) || (phy_1.groupe_physionomie)::text) || ')'::text)), ', '::text) AS physionomies
           FROM (florepatri.cor_ap_physionomie p_1
             JOIN florepatri.bib_physionomies phy_1 ON ((phy_1.id_physionomie = p_1.id_physionomie)))
          GROUP BY p_1.indexap) phy ON ((phy.indexap = ap.indexap)))
  WHERE ((ap.supprime = false) AND (geometrytype(ap.the_geom_2154) = 'POLYGON'::text))
  ORDER BY s.nom_secteur, ap.indexzp;]]></expression>
	</reference>
</view>

<view name="v_toutesleszp_2154">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5441.53" y="1091.87"/>
	<reference>
		<expression><![CDATA[ SELECT zp.indexzp AS gid,
    zp.indexzp,
    s.nom_secteur AS secteur,
    count(ap.indexap) AS nbap,
    zp.dateobs,
    t.latin AS taxon,
    zp.taxon_saisi,
    o.observateurs,
    zp.the_geom_2154,
    zp.insee,
    com.commune_min AS commune,
    org.nom_organisme AS organisme_producteur,
    zp.topo_valid AS zp_topo_valid,
    zp.validation AS relue,
    zp.saisie_initiale,
    zp.srid_dessin
   FROM ((((((florepatri.t_zprospection zp
     LEFT JOIN florepatri.t_apresence ap ON ((ap.indexzp = zp.indexzp)))
     LEFT JOIN layers.l_communes com ON ((com.insee = zp.insee)))
     LEFT JOIN utilisateurs.bib_organismes org ON ((org.id_organisme = zp.id_organisme)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = zp.cd_nom)))
     JOIN layers.l_secteurs s ON ((s.id_secteur = zp.id_secteur)))
     JOIN ( SELECT c.indexzp,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florepatri.cor_zp_obs c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.codeobs)))
          GROUP BY c.indexzp) o ON ((o.indexzp = zp.indexzp)))
  WHERE (zp.supprime = false)
  GROUP BY s.nom_secteur, zp.indexzp, zp.dateobs, t.latin, zp.taxon_saisi, o.observateurs, zp.the_geom_2154, zp.insee, com.commune_min, org.nom_organisme, zp.topo_valid, zp.validation, zp.saisie_initiale, zp.srid_dessin
  ORDER BY s.nom_secteur, zp.indexzp;]]></expression>
	</reference>
</view>

<view name="v_ap_line">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4807.13" y="990.6"/>
	<reference>
		<expression><![CDATA[ SELECT a.indexap,
    a.indexzp,
    a.surfaceap AS surface,
    a.altitude_saisie AS altitude,
    a.id_frequence_methodo_new AS id_frequence_methodo,
    a.the_geom_2154,
    a.frequenceap,
    a.topo_valid,
    a.date_update,
    a.supprime,
    a.date_insert
   FROM florepatri.t_apresence a
  WHERE ((geometrytype(a.the_geom_2154) = 'MULTILINESTRING'::text) OR (geometrytype(a.the_geom_2154) = 'LINESTRING'::text));]]></expression>
	</reference>
</view>

<view name="v_ap_point">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5042.9" y="990.6"/>
	<reference>
		<expression><![CDATA[ SELECT a.indexap,
    a.indexzp,
    a.surfaceap AS surface,
    a.altitude_saisie AS altitude,
    a.id_frequence_methodo_new AS id_frequence_methodo,
    a.the_geom_2154,
    a.frequenceap,
    a.topo_valid,
    a.date_update,
    a.supprime,
    a.date_insert
   FROM florepatri.t_apresence a
  WHERE ((geometrytype(a.the_geom_2154) = 'POINT'::text) OR (geometrytype(a.the_geom_2154) = 'MULTIPOINT'::text));]]></expression>
	</reference>
</view>

<view name="v_ap_poly">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5277" y="990.6"/>
	<reference>
		<expression><![CDATA[ SELECT a.indexap,
    a.indexzp,
    a.surfaceap AS surface,
    a.altitude_saisie AS altitude,
    a.id_frequence_methodo_new AS id_frequence_methodo,
    a.the_geom_2154,
    a.frequenceap,
    a.topo_valid,
    a.date_update,
    a.supprime,
    a.date_insert
   FROM florepatri.t_apresence a
  WHERE ((geometrytype(a.the_geom_2154) = 'POLYGON'::text) OR (geometrytype(a.the_geom_2154) = 'MULTIPOLYGON'::text));]]></expression>
	</reference>
</view>

<view name="v_mobile_pentes">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4809.43" y="737.266"/>
	<reference>
		<expression><![CDATA[ SELECT bib_pentes.id_pente,
    bib_pentes.val_pente,
    bib_pentes.nom_pente
   FROM florepatri.bib_pentes
  ORDER BY bib_pentes.id_pente;]]></expression>
	</reference>
</view>

<view name="v_mobile_perturbations">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5043.53" y="737.266"/>
	<reference>
		<expression><![CDATA[ SELECT bib_perturbations.codeper,
    bib_perturbations.classification,
    bib_perturbations.description
   FROM florepatri.bib_perturbations
  ORDER BY bib_perturbations.codeper;]]></expression>
	</reference>
</view>

<view name="v_mobile_phenologies">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4808.8" y="827.663"/>
	<reference>
		<expression><![CDATA[ SELECT bib_phenologies.codepheno,
    bib_phenologies.pheno
   FROM florepatri.bib_phenologies
  ORDER BY bib_phenologies.codepheno;]]></expression>
	</reference>
</view>

<view name="v_mobile_physionomies">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5065.4" y="827.663"/>
	<reference>
		<expression><![CDATA[ SELECT bib_physionomies.id_physionomie,
    bib_physionomies.groupe_physionomie,
    bib_physionomies.nom_physionomie
   FROM florepatri.bib_physionomies
  ORDER BY bib_physionomies.id_physionomie;]]></expression>
	</reference>
</view>

<view name="v_mobile_taxons_fp">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5331" y="827.663"/>
	<reference>
		<expression><![CDATA[ SELECT bt.cd_nom,
    bt.latin AS nom_latin,
    bt.francais AS nom_francais
   FROM florepatri.bib_taxons_fp bt
  WHERE (bt.nomade_ecrins = true)
  ORDER BY bt.latin;]]></expression>
	</reference>
</view>

<view name="v_mobile_visu_zp">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5570.6" y="827.663"/>
	<reference>
		<expression><![CDATA[ SELECT t_zprospection.indexzp,
    t_zprospection.cd_nom,
    t_zprospection.the_geom_2154
   FROM florepatri.t_zprospection
  WHERE (date_part('year'::text, t_zprospection.dateobs) = date_part('year'::text, now()));]]></expression>
	</reference>
</view>

<view name="v_nomade_taxon">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5511.7" y="917.663"/>
	<reference>
		<expression><![CDATA[ SELECT bt.cd_nom,
    bt.latin,
    bt.francais,
    bt.echelle,
    '1,2,3,4,5,6,7,8'::character(15) AS codepheno,
    'TF,RS'::character(5) AS codeobjet
   FROM florepatri.bib_taxons_fp bt
  WHERE (bt.nomade_ecrins = true)
  ORDER BY bt.latin;]]></expression>
	</reference>
</view>

<view name="v_nomade_zp">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="4808.8" y="913.063"/>
	<reference>
		<expression><![CDATA[ SELECT zp.indexzp,
    zp.cd_nom,
    vobs.codeobs,
    zp.dateobs,
    'Polygon'::character(7) AS montype,
    substr(st_asgml(zp.the_geom_2154), (strpos(st_asgml(zp.the_geom_2154), '<gml:coordinates>'::text) + 17), (strpos(st_asgml(zp.the_geom_2154), '</gml:coordinates>'::text) - (strpos(st_asgml(zp.the_geom_2154), '<gml:coordinates>'::text) + 17))) AS coordinates,
    vap.indexap,
    zp.id_secteur AS id_secteur_fp
   FROM ((florepatri.t_zprospection zp
     JOIN ( SELECT cor.indexzp,
            substr((array_agg(cor.codeobs))::text, 2, (strpos((array_agg(cor.codeobs))::text, '}'::text) - 2)) AS codeobs
           FROM ( SELECT aa.indexzp,
                    aa.codeobs
                   FROM florepatri.cor_zp_obs aa
                  WHERE (aa.codeobs <> 247)
                  ORDER BY aa.indexzp, aa.codeobs) cor
          GROUP BY cor.indexzp) vobs ON ((vobs.indexzp = zp.indexzp)))
     LEFT JOIN ( SELECT ap.indexzp,
            substr((array_agg(ap.indexap))::text, 2, (strpos((array_agg(ap.indexap))::text, '}'::text) - 2)) AS indexap
           FROM ( SELECT aa.indexzp,
                    aa.indexap
                   FROM florepatri.t_apresence aa
                  WHERE (aa.supprime = false)
                  ORDER BY aa.indexzp, aa.indexap) ap
          GROUP BY ap.indexzp) vap ON ((vap.indexzp = zp.indexzp)))
  WHERE (((((zp.topo_valid = true) AND (zp.supprime = false)) AND (zp.id_secteur < 9)) AND (zp.dateobs > '2010-01-01'::date)) AND (zp.cd_nom IN ( SELECT v_nomade_taxon.cd_nom
           FROM florepatri.v_nomade_taxon)))
  ORDER BY zp.indexzp;]]></expression>
	</reference>
</view>

<view name="v_nomade_ap">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5041.9" y="913.063"/>
	<reference>
		<expression><![CDATA[ SELECT ap.indexap,
    ap.codepheno,
    florepatri.letypedegeom(ap.the_geom_2154) AS montype,
    substr(st_asgml(ap.the_geom_2154), (strpos(st_asgml(ap.the_geom_2154), '<gml:coordinates>'::text) + 17), (strpos(st_asgml(ap.the_geom_2154), '</gml:coordinates>'::text) - (strpos(st_asgml(ap.the_geom_2154), '<gml:coordinates>'::text) + 17))) AS coordinates,
    ap.surfaceap,
    (((ap.id_frequence_methodo_new)::text || ';'::text) || (ap.frequenceap)::integer) AS frequence,
    vper.codeper,
    ((('TF;'::text || ((ap.total_fertiles)::character(1))::text) || ',RS;'::text) || ((ap.total_steriles)::character(1))::text) AS denombrement,
    zp.id_secteur_fp
   FROM ((florepatri.t_apresence ap
     JOIN florepatri.v_nomade_zp zp ON ((ap.indexzp = zp.indexzp)))
     LEFT JOIN ( SELECT ab.indexap,
            substr((array_agg(ab.codeper))::text, 2, (strpos((array_agg(ab.codeper))::text, '}'::text) - 2)) AS codeper
           FROM ( SELECT aa.indexap,
                    aa.codeper
                   FROM florepatri.cor_ap_perturb aa
                  ORDER BY aa.indexap, aa.codeper) ab
          GROUP BY ab.indexap) vper ON ((vper.indexap = ap.indexap)))
  WHERE (ap.supprime = false)
  ORDER BY ap.indexap;]]></expression>
	</reference>
</view>

<view name="v_florestation_all">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6605.89" y="1627.13"/>
	<reference>
		<expression><![CDATA[ SELECT cor.id_station_cd_nom AS indexbidon,
    fs.id_station,
    fs.dateobs,
    cor.cd_nom,
    btrim((tr.nom_valide)::text) AS nom_valid,
    btrim((tr.nom_vern)::text) AS nom_vern,
    st_transform(fs.the_geom_2154, 2154) AS the_geom
   FROM ((florestation.t_stations_fs fs
     JOIN florestation.cor_fs_taxon cor ON ((cor.id_station = fs.id_station)))
     JOIN taxonomie.taxref tr ON ((cor.cd_nom = tr.cd_nom)))
  WHERE ((fs.supprime = false) AND (cor.supprime = false));]]></expression>
	</reference>
</view>

<view name="v_florestation_patrimoniale">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6601.83" y="1825.46"/>
	<reference>
		<expression><![CDATA[ SELECT cor.id_station_cd_nom AS indexbidon,
    fs.id_station,
    bt.francais,
    bt.latin,
    fs.dateobs,
    fs.the_geom_2154
   FROM ((florestation.t_stations_fs fs
     JOIN florestation.cor_fs_taxon cor ON ((cor.id_station = fs.id_station)))
     JOIN florepatri.bib_taxons_fp bt ON ((cor.cd_nom = bt.cd_nom)))
  WHERE ((fs.supprime = false) AND (cor.supprime = false))
  ORDER BY fs.id_station, bt.latin;]]></expression>
	</reference>
</view>

<view name="v_taxons_fs">
	<schema name="florestation"/>
	<role name="geonatuser"/>
	<position x="6602.76" y="2035.46"/>
	<reference>
		<expression><![CDATA[ SELECT t.cd_nom,
    t.nom_complet
   FROM (taxonomie.taxref t
     JOIN (( SELECT DISTINCT t_1.cd_ref
           FROM ((taxonomie.taxref t_1
             JOIN florestation.cor_fs_taxon c ON ((c.cd_nom = t_1.cd_nom)))
             RIGHT JOIN florestation.t_stations_fs s ON ((s.id_station = c.id_station)))
          WHERE ((s.supprime = false) AND (c.supprime = false))
          ORDER BY t_1.cd_ref)
        UNION
         SELECT t_1.cd_ref
           FROM taxonomie.taxref t_1
          WHERE (t_1.cd_nom = ANY (ARRAY[106226, 95136, 134738, 91823, 109422, 84904, 113388, 97502, 138537, 611325, 81376, 115437, 127191, 115228, 88108, 137138, 139803, 89840, 124967, 82656, 136028, 97785, 117952, 112747, 117933, 125337, 123156, 111297, 1000001, 131447, 122118, 134958, 99882, 111311, 123711, 90319, 111996, 89881, 97262, 117951, 95186, 98474, 115110, 90259, 119818, 126541, 117087, 87690, 131610, 127450, 116265, 97502, 125816, 104221, 95398, 138515, 86429, 83528, 110994, 121039, 110410, 87143, 110421, 82285, 126628, 103478, 129325, 81065, 81166, 106220, 90561, 86948, 73574, 73558]))) a ON ((a.cd_ref = t.cd_nom)));]]></expression>
	</reference>
</view>

<index name="fki_" table="contactfaune.bib_criteres_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_critere_synthese"/>
		</idxelement>
</index>

<index name="i_fk_cor_critere_liste_bib_li" table="contactfaune.cor_critere_liste"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_liste"/>
		</idxelement>
</index>

<index name="i_fk_cor_critere_liste_bib_cr" table="contactfaune.cor_critere_liste"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_critere_cf"/>
		</idxelement>
</index>

<index name="i_fk_cor_message_cf_bib_me" table="contactfaune.cor_message_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_message_cf"/>
		</idxelement>
</index>

<index name="i_fk_cor_message_cf_bib_ta" table="contactfaune.cor_message_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_cf_t_fiche" table="contactfaune.cor_role_fiche_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_cf"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_cf_t_roles" table="contactfaune.cor_role_fiche_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_role"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_taxon_bib_taxon" table="contactfaune.cor_unite_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_taxon_l_unites_" table="contactfaune.cor_unite_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_unite_geo"/>
		</idxelement>
</index>

<index name="i_fk_t_fiches_cf_l_communes" table="contactfaune.t_fiches_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="insee"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_cf_bib_criteres" table="contactfaune.t_releves_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_critere_cf"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_cf_bib_taxons_f" table="contactfaune.t_releves_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_cf_t_fiches_cf" table="contactfaune.t_releves_cf"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_cf"/>
		</idxelement>
</index>

<index name="fki_" table="contactinv.bib_criteres_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_critere_synthese"/>
		</idxelement>
</index>

<index name="fki_t_fiches_inv_bib_milieux_inv" table="contactinv.t_fiches_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_milieu_inv"/>
		</idxelement>
</index>

<index name="i_fk_cor_msg_inv_bib_msg" table="contactinv.cor_message_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_message_inv"/>
		</idxelement>
</index>

<index name="i_fk_cor_msg_inv_bib_taxons" table="contactinv.cor_message_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_inv_t_fiche" table="contactinv.cor_role_fiche_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_inv"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_inv_t_roles" table="contactinv.cor_role_fiche_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_role"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_taxon_inv_bib_taxon" table="contactinv.cor_unite_taxon_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_taxon_inv_l_unites" table="contactinv.cor_unite_taxon_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_unite_geo"/>
		</idxelement>
</index>

<index name="i_fk_t_fiches_inv_l_communes" table="contactinv.t_fiches_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="insee"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_inv_bib_criteres" table="contactinv.t_releves_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_critere_inv"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_inv_bib_taxons_f" table="contactinv.t_releves_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_t_releves_inv_t_fiches_inv" table="contactinv.t_releves_inv"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_inv"/>
		</idxelement>
</index>

<index name="fki_t_stations_bryo_gid" table="bryophytes.t_stations_bryo"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
	<comment><![CDATA[pour le fonctionnement de qgis]]></comment>
		<idxelement use-sorting="false">
			<column name="gid"/>
		</idxelement>
</index>

<index name="i_fk_t_stations_bryo_bib_exposit" table="bryophytes.t_stations_bryo"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_exposition"/>
		</idxelement>
</index>

<index name="i_fk_t_stations_bryo_bib_support" table="bryophytes.t_stations_bryo"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_support"/>
		</idxelement>
</index>

<index name="index_cd_nom" table="bryophytes.cor_bryo_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="fki_cor_zp_obs_t_roles" table="florepatri.cor_zp_obs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="codeobs"/>
		</idxelement>
</index>

<index name="fki_t_apresence_t_zprospection" table="florepatri.t_apresence"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="indexzp"/>
		</idxelement>
</index>

<index name="i_fk_t_apresence_bib_phenologi" table="florepatri.t_apresence"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="codepheno"/>
		</idxelement>
</index>

<index name="i_fk_t_zprospection_bib_secteu" table="florepatri.t_zprospection"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_secteur"/>
		</idxelement>
</index>

<index name="fki_t_stations_fs_bib_homogenes" table="florestation.t_stations_fs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_homogene"/>
		</idxelement>
</index>

<index name="fki_t_stations_fs_gid" table="florestation.t_stations_fs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
	<comment><![CDATA[pour le fonctionnement de qgis]]></comment>
		<idxelement use-sorting="false">
			<column name="gid"/>
		</idxelement>
</index>

<index name="i_fk_t_stations_fs_bib_exposit" table="florestation.t_stations_fs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_exposition"/>
		</idxelement>
</index>

<index name="i_fk_t_stations_fs_bib_program" table="florestation.t_stations_fs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_programme_fs"/>
		</idxelement>
</index>

<index name="i_fk_t_stations_fs_bib_support" table="florestation.t_stations_fs"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_support"/>
		</idxelement>
</index>

<index name="index_cd_nom" table="florestation.cor_fs_taxon"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="fki_" table="layers.l_communes"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_secteur"/>
		</idxelement>
</index>

<index name="fki_synthese_bib_proprietaires" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_organisme"/>
		</idxelement>
</index>

<index name="fki_synthese_bib_protocoles_id" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_protocole"/>
		</idxelement>
</index>

<index name="fki_synthese_insee_fkey" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="insee"/>
		</idxelement>
</index>

<index name="fki_syntheseff_bib_sources" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_source"/>
		</idxelement>
</index>

<index name="i_fk_cor_cor_zonesstatut_synthese_l_zonesstatut" table="synthese.cor_zonesstatut_synthese"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_zone"/>
		</idxelement>
</index>

<index name="i_fk_cor_cor_zonesstatut_synthese_syntheseff" table="synthese.cor_zonesstatut_synthese"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_synthese"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_synthese_l_unites" table="synthese.cor_unite_synthese"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_unite_geo"/>
		</idxelement>
</index>

<index name="i_fk_cor_unite_synthese_syntheseff" table="synthese.cor_unite_synthese"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_synthese"/>
		</idxelement>
</index>

<index name="i_synthese_cd_nom" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="i_synthese_dateobs" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="dateobs"/>
		</idxelement>
</index>

<index name="i_synthese_id_lot" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_lot"/>
		</idxelement>
</index>

<index name="index_gist_synthese_the_geom_point" table="synthese.syntheseff"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="gist" factor="90">
		<idxelement use-sorting="false">
			<column name="the_geom_point"/>
		</idxelement>
</index>

<index name="i_taxref_hierarchy" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="regne"/>
		</idxelement>
		<idxelement use-sorting="false">
			<column name="phylum"/>
		</idxelement>
		<idxelement use-sorting="false">
			<column name="classe"/>
		</idxelement>
		<idxelement use-sorting="false">
			<column name="ordre"/>
		</idxelement>
		<idxelement use-sorting="false">
			<column name="famille"/>
		</idxelement>
</index>

<index name="fki_cor_taxon_attribut" table="taxonomie.cor_taxon_attribut"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="valeur_attribut"/>
		</idxelement>
</index>

<index name="fki_bib_taxons_bib_listes" table="taxonomie.cor_taxon_liste"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_liste"/>
		</idxelement>
</index>

<index name="fki_cd_nom_taxref_protection_especes" table="taxonomie.taxref_protection_especes"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="i_fk_bib_taxons_taxr" table="taxonomie.bib_taxons"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="i_fk_taxref_bib_taxref_habitat" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_habitat"/>
		</idxelement>
</index>

<index name="i_fk_taxref_bib_taxref_rangs" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_rang"/>
		</idxelement>
</index>

<index name="i_fk_taxref_bib_taxref_statuts" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_statut"/>
		</idxelement>
</index>

<index name="i_taxref_cd_nom" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_nom"/>
		</idxelement>
</index>

<index name="i_taxref_cd_ref" table="taxonomie.taxref"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="cd_ref"/>
		</idxelement>
</index>

<trigger name="tri_insert_fiche_cf" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactfaune.t_fiches_cf">
		<function signature="contactfaune.insert_fiche_cf()"/>
</trigger>

<trigger name="tri_insert_releve_cf" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactfaune.t_releves_cf">
		<function signature="contactfaune.insert_releve_cf()"/>
</trigger>

<trigger name="tri_synthese_delete_releve_cf" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="contactfaune.t_releves_cf">
		<function signature="contactfaune.synthese_delete_releve_cf()"/>
</trigger>

<trigger name="tri_synthese_insert_releve_cf" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactfaune.t_releves_cf">
		<function signature="contactfaune.synthese_insert_releve_cf()"/>
</trigger>

<trigger name="tri_synthese_update_fiche_cf" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactfaune.t_fiches_cf">
		<function signature="contactfaune.synthese_update_fiche_cf()"/>
</trigger>

<trigger name="tri_synthese_update_releve_cf" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactfaune.t_releves_cf">
		<function signature="contactfaune.synthese_update_releve_cf()"/>
</trigger>

<trigger name="tri_update_fiche_cf" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactfaune.t_fiches_cf">
		<function signature="contactfaune.update_fiche_cf()"/>
</trigger>

<trigger name="tri_update_releve_cf" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactfaune.t_releves_cf">
		<function signature="contactfaune.update_releve_cf()"/>
</trigger>

<trigger name="tri_update_synthese_cor_role_fiche_cf" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="true" trunc-event="false"
	 table="contactfaune.cor_role_fiche_cf">
		<function signature="contactfaune.synthese_update_cor_role_fiche_cf()"/>
</trigger>

<trigger name="tri_insert_fiche_inv" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactinv.t_fiches_inv">
		<function signature="contactinv.insert_fiche_inv()"/>
</trigger>

<trigger name="tri_insert_releve_inv" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactinv.t_releves_inv">
		<function signature="contactinv.insert_releve_inv()"/>
</trigger>

<trigger name="tri_synthese_delete_releve_inv" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="contactinv.t_releves_inv">
		<function signature="contactinv.synthese_delete_releve_inv()"/>
</trigger>

<trigger name="tri_synthese_insert_releve_inv" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactinv.t_releves_inv">
		<function signature="contactinv.synthese_insert_releve_inv()"/>
</trigger>

<trigger name="tri_synthese_update_fiche_inv" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactinv.t_fiches_inv">
		<function signature="contactinv.synthese_update_fiche_inv()"/>
</trigger>

<trigger name="tri_synthese_update_releve_inv" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactinv.t_releves_inv">
		<function signature="contactinv.synthese_update_releve_inv()"/>
</trigger>

<trigger name="tri_update_fiche_inv" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactinv.t_fiches_inv">
		<function signature="contactinv.update_fiche_inv()"/>
</trigger>

<trigger name="tri_update_releve_inv" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactinv.t_releves_inv">
		<function signature="contactinv.update_releve_inv()"/>
</trigger>

<trigger name="tri_update_synthese_cor_role_fiche_inv" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="true" trunc-event="false"
	 table="contactinv.cor_role_fiche_inv">
		<function signature="contactinv.synthese_update_cor_role_fiche_inv()"/>
</trigger>

<trigger name="tri_delete_synthese_cor_bryo_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="bryophytes.cor_bryo_taxon">
		<function signature="bryophytes.delete_synthese_cor_bryo_taxon()"/>
</trigger>

<trigger name="tri_insert" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="bryophytes.t_stations_bryo">
		<function signature="bryophytes.bryophytes_insert()"/>
</trigger>

<trigger name="tri_insert_synthese_cor_bryo_observateur" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="bryophytes.cor_bryo_observateur">
		<function signature="bryophytes.update_synthese_cor_bryo_observateur()"/>
</trigger>

<trigger name="tri_insert_synthese_cor_bryo_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="bryophytes.cor_bryo_taxon">
		<function signature="bryophytes.insert_synthese_cor_bryo_taxon()"/>
</trigger>

<trigger name="tri_update" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="bryophytes.t_stations_bryo">
		<function signature="bryophytes.bryophytes_update()"/>
</trigger>

<trigger name="tri_update_synthese_cor_bryo_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="bryophytes.cor_bryo_taxon">
		<function signature="bryophytes.update_synthese_cor_bryo_taxon()"/>
</trigger>

<trigger name="tri_update_synthese_stations_bryo" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="bryophytes.t_stations_bryo">
		<function signature="bryophytes.update_synthese_stations_bryo()"/>
</trigger>

<trigger name="tri_delete_synthese_ap" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="florepatri.t_apresence">
		<function signature="florepatri.delete_synthese_ap()"/>
</trigger>

<trigger name="tri_insert_ap" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florepatri.t_apresence">
		<function signature="florepatri.insert_ap()"/>
</trigger>

<trigger name="tri_insert_synthese_ap" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florepatri.t_apresence">
		<function signature="florepatri.insert_synthese_ap()"/>
</trigger>

<trigger name="tri_insert_synthese_cor_zp_obs" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florepatri.cor_zp_obs">
		<function signature="florepatri.update_synthese_cor_zp_obs()"/>
</trigger>

<trigger name="tri_insert_zp" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florepatri.t_zprospection">
		<function signature="florepatri.insert_zp()"/>
</trigger>

<trigger name="tri_update_ap" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florepatri.t_apresence">
		<function signature="florepatri.update_ap()"/>
</trigger>

<trigger name="tri_update_synthese_ap" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florepatri.t_apresence">
		<function signature="florepatri.update_synthese_ap()"/>
</trigger>

<trigger name="tri_update_synthese_zp" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florepatri.t_zprospection">
		<function signature="florepatri.update_synthese_zp()"/>
</trigger>

<trigger name="tri_update_zp" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florepatri.t_zprospection">
		<function signature="florepatri.update_zp()"/>
</trigger>

<trigger name="tri_delete_synthese_cor_fs_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="florestation.cor_fs_taxon">
		<function signature="florestation.delete_synthese_cor_fs_taxon()"/>
</trigger>

<trigger name="tri_insert" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florestation.t_stations_fs">
		<function signature="florestation.florestation_insert()"/>
</trigger>

<trigger name="tri_insert_synthese_cor_fs_observateur" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florestation.cor_fs_observateur">
		<function signature="florestation.update_synthese_cor_fs_observateur()"/>
</trigger>

<trigger name="tri_insert_synthese_cor_fs_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="florestation.cor_fs_taxon">
		<function signature="florestation.insert_synthese_cor_fs_taxon()"/>
</trigger>

<trigger name="tri_update" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florestation.t_stations_fs">
		<function signature="florestation.florestation_update()"/>
</trigger>

<trigger name="tri_update_synthese_cor_fs_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florestation.cor_fs_taxon">
		<function signature="florestation.update_synthese_cor_fs_taxon()"/>
</trigger>

<trigger name="tri_update_synthese_stations_fs" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="florestation.t_stations_fs">
		<function signature="florestation.update_synthese_stations_fs()"/>
</trigger>

<trigger name="tri_insert_syntheseff" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="synthese.syntheseff">
		<function signature="synthese.insert_syntheseff()"/>
</trigger>

<trigger name="tri_maj_cor_unite_synthese" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="true" upd-event="true" trunc-event="false"
	 table="synthese.syntheseff">
		<function signature="synthese.maj_cor_unite_synthese()"/>
</trigger>

<trigger name="tri_maj_cor_unite_taxon" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="true" upd-event="false" trunc-event="false"
	 table="synthese.cor_unite_synthese">
		<function signature="synthese.maj_cor_unite_taxon()"/>
</trigger>

<trigger name="tri_maj_cor_zonesstatut_synthese" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="true" upd-event="true" trunc-event="false"
	 table="synthese.syntheseff">
		<function signature="synthese.maj_cor_zonesstatut_synthese()"/>
</trigger>

<trigger name="tri_update_syntheseff" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="synthese.syntheseff">
		<function signature="synthese.update_syntheseff()"/>
</trigger>

<trigger name="modify_date_insert_trigger" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="utilisateurs.t_roles">
		<function signature="utilisateurs.modify_date_insert()"/>
</trigger>

<trigger name="modify_date_update_trigger" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="utilisateurs.t_roles">
		<function signature="utilisateurs.modify_date_update()"/>
</trigger>

<view name="v_nomade_classes">
	<schema name="florepatri"/>
	<role name="geonatuser"/>
	<position x="5279" y="913.063"/>
	<reference>
		<expression><![CDATA[ SELECT g.id_liste AS id_classe,
    g.nom_liste AS nom_classe_fr,
    g.desc_liste AS desc_classe
   FROM (( SELECT l.id_liste,
            l.nom_liste,
            l.desc_liste,
            min(taxonomie.find_cdref(tx.cd_nom)) AS cd_ref
           FROM ((taxonomie.bib_listes l
             JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_liste = l.id_liste)))
             JOIN taxonomie.bib_taxons tx ON ((tx.id_taxon = ctl.id_taxon)))
          WHERE ((l.id_liste >= 300) AND (l.id_liste < 400))
          GROUP BY l.id_liste, l.nom_liste, l.desc_liste) g
     JOIN taxonomie.taxref t ON ((t.cd_nom = g.cd_ref)))
  WHERE ((t.regne)::text = 'Plantae'::text);]]></expression>
	</reference>
</view>

<view name="v_nomade_classes">
	<schema name="taxonomie"/>
	<role name="geonatuser"/>
	<position x="4082.79" y="556.132"/>
	<reference>
		<expression><![CDATA[ SELECT v_nomade_classes.id_classe,
    v_nomade_classes.nom_classe_fr,
    v_nomade_classes.desc_classe
   FROM contactfaune.v_nomade_classes
UNION
 SELECT v_nomade_classes.id_classe,
    v_nomade_classes.nom_classe_fr,
    v_nomade_classes.desc_classe
   FROM contactinv.v_nomade_classes
UNION
 SELECT v_nomade_classes.id_classe,
    v_nomade_classes.nom_classe_fr,
    v_nomade_classes.desc_classe
   FROM florepatri.v_nomade_classes
UNION
 SELECT v_nomade_classes.id_classe,
    v_nomade_classes.nom_classe_fr,
    v_nomade_classes.desc_classe
   FROM contactflore.v_nomade_classes;]]></expression>
	</reference>
</view>

<view name="v_mobile_recherche">
	<schema name="public"/>
	<role name="geonatuser"/>
	<position x="368.5" y="50"/>
	<reference>
		<expression><![CDATA[( SELECT ap.indexap AS gid,
    zp.dateobs,
    t.latin AS taxon,
    o.observateurs,
    st_asgeojson(st_transform(ap.the_geom_2154, 4326)) AS geom_4326,
    st_x(st_transform(st_centroid(ap.the_geom_2154), 4326)) AS centroid_x,
    st_y(st_transform(st_centroid(ap.the_geom_2154), 4326)) AS centroid_y
   FROM (((florepatri.t_apresence ap
     JOIN florepatri.t_zprospection zp ON ((ap.indexzp = zp.indexzp)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = zp.cd_nom)))
     JOIN ( SELECT c.indexzp,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florepatri.cor_zp_obs c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.codeobs)))
          GROUP BY c.indexzp) o ON ((o.indexzp = ap.indexzp)))
  WHERE (((ap.supprime = false) AND st_isvalid(ap.the_geom_2154)) AND (ap.topo_valid = true))
  ORDER BY zp.dateobs DESC)
UNION
( SELECT cft.id_station AS gid,
    s.dateobs,
    t.latin AS taxon,
    o.observateurs,
    st_asgeojson(st_transform(s.the_geom_3857, 4326)) AS geom_4326,
    st_x(st_transform(st_centroid(s.the_geom_3857), 4326)) AS centroid_x,
    st_y(st_transform(st_centroid(s.the_geom_3857), 4326)) AS centroid_y
   FROM (((florestation.cor_fs_taxon cft
     JOIN florestation.t_stations_fs s ON ((s.id_station = cft.id_station)))
     JOIN florepatri.bib_taxons_fp t ON ((t.cd_nom = cft.cd_nom)))
     JOIN ( SELECT c.id_station,
            array_to_string(array_agg((((r.prenom_role)::text || ' '::text) || (r.nom_role)::text)), ', '::text) AS observateurs
           FROM (florestation.cor_fs_observateur c
             JOIN utilisateurs.t_roles r ON ((r.id_role = c.id_role)))
          GROUP BY c.id_station) o ON ((o.id_station = cft.id_station)))
  WHERE ((cft.supprime = false) AND st_isvalid(s.the_geom_3857))
  ORDER BY s.dateobs DESC);]]></expression>
	</reference>
</view>

<view name="v_export_sinp">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3018.03" y="2638.6"/>
	<reference>
		<expression><![CDATA[ SELECT s.id_synthese,
    o.nom_organisme,
    s.dateobs,
    s.observateurs,
    t.cd_nom,
    t.nom_latin,
    c.nom_critere_synthese AS critere,
    s.effectif_total,
    s.remarques,
    p.nom_programme,
    s.insee,
    s.altitude_retenue AS altitude,
    (st_x(st_transform(s.the_geom_point, 2154)))::integer AS x,
    (st_y(st_transform(s.the_geom_point, 2154)))::integer AS y,
    s.derniere_action,
    s.date_insert,
    s.date_update
   FROM ((((((synthese.syntheseff s
     JOIN taxonomie.taxref tx ON ((tx.cd_nom = s.cd_nom)))
     LEFT JOIN utilisateurs.bib_organismes o ON ((o.id_organisme = s.id_organisme)))
     JOIN taxonomie.bib_taxons t ON ((t.cd_nom = s.cd_nom)))
     LEFT JOIN synthese.bib_criteres_synthese c ON ((c.id_critere_synthese = s.id_critere_synthese)))
     LEFT JOIN meta.bib_lots l ON ((l.id_lot = s.id_lot)))
     LEFT JOIN meta.bib_programmes p ON ((p.id_programme = l.id_programme)))
  WHERE (s.supprime = false);]]></expression>
	</reference>
</view>

<view name="v_export_sinp_deleted">
	<schema name="synthese"/>
	<role name="geonatuser"/>
	<position x="3252.47" y="2641.93"/>
	<reference>
		<expression><![CDATA[ SELECT s.id_synthese
   FROM (synthese.syntheseff s
     JOIN taxonomie.taxref tx ON ((tx.cd_nom = s.cd_nom)))
  WHERE (s.supprime = true);]]></expression>
	</reference>
</view>

<schema name="contactflore" rect-visible="true" fill-color="#90ffa6">
	<role name="geonatuser"/>
</schema>

<function name="couleur_taxon"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="text"/>
	</return-type>
	<parameter name="id">
		<type name="integer"/>
	</parameter>
	<parameter name="maxdateobs">
		<type name="date"/>
	</parameter>
	<definition><![CDATA[
--fonction permettant de renvoyer la couleur d'un taxon à partir de la dernière date d'observation 
--
--Gil DELUERMOZ mars 2016

  DECLARE
  couleur text;
  patri character(3);
  BEGIN
    SELECT filtre2 INTO patri 
    FROM taxonomie.bib_taxons
    WHERE id_taxon = id;
	IF patri = 'oui' THEN
		IF date_part('year',maxdateobs)=date_part('year',now()) THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSIF patri = 'non' THEN
		IF date_part('year',maxdateobs)>=date_part('year',now())-3 THEN couleur = 'gray';
		ELSE couleur = 'red';
		END IF;
	ELSE
	return false;	
	END IF;
	return couleur;
  END;
]]></definition>
</function>

<function name="insert_fiche_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
------- si le pointage est deja dans la BDD alors le trigger retourne null (l'insertion de la ligne est annulée).
IF new.id_cflore in (SELECT id_cflore FROM contactflore.t_fiches_cflore) THEN	
	return null;
ELSE
	new.date_insert= 'now';
	new.date_update= 'now';
-------gestion des infos relatives a la numerisation (srid utilisé et support utilisé : nomade ou web ou autre)
	IF new.saisie_initiale = 'pda' OR new.saisie_initiale = 'nomade' THEN
		new.srid_dessin = 2154;
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
	ELSIF new.saisie_initiale = 'web' THEN
		new.srid_dessin = 3857;
		-- attention : pas de creation des geom 2154 car c'est fait par l'application web
	ELSIF new.saisie_initiale ISNULL THEN
		new.srid_dessin = 0;
		-- pas d'info sur le srid utilisé, cas des importations à gérer manuellement. Ne devrait pas exister.
	END IF;
-------gestion des divers control avec attributions des secteurs + communes : dans le cas d'un insert depuis le nomade uniquement via the_geom !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;
	RETURN NEW; 			
END IF;
END;
]]></definition>
</function>

<function name="insert_releve_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
cdnom integer;
re integer;
unite integer;
nbobs integer;
line record;
fiche record;
BEGIN
    --récup du cd_nom du taxon
	SELECT INTO cdnom cd_nom FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
    --récup du cd_ref du taxon pour le stocker en base au moment de l'enregistrement (= conseil inpn)
	SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
	new.cd_ref_origine = re;
    -- MAJ de la table cor_unite_taxon, on commence par récupérer l'unité à partir du pointage (table t_fiches_cf)
	SELECT INTO fiche * FROM contactflore.t_fiches_cflore WHERE id_cflore = new.id_cflore;
	SELECT INTO unite u.id_unite_geo FROM layers.l_unites_geo u WHERE ST_INTERSECTS(fiche.the_geom_2154,u.the_geom);
	--si on est dans une des unités on peut mettre à jour la table cor_unite_taxon, sinon on fait rien
	IF unite>0 THEN
		SELECT INTO line * FROM contactflore.cor_unite_taxon WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		--si la ligne existe dans cor_unite_taxon on la supprime
		IF line IS NOT NULL THEN
			DELETE FROM contactflore.cor_unite_taxon WHERE id_unite_geo = unite AND id_taxon = new.id_taxon;
		END IF;
		--on compte le nombre d'enregistrement pour ce taxon dans l'unité
		SELECT INTO nbobs count(*) from synthese.syntheseff s
		JOIN layers.l_unites_geo u ON ST_Intersects(u.the_geom, s.the_geom_2154) AND u.id_unite_geo = unite
		WHERE s.cd_nom = cdnom;
		--on créé ou recréé la ligne
		INSERT INTO contactflore.cor_unite_taxon VALUES(unite,new.id_taxon,fiche.dateobs,contactflore.couleur_taxon(new.id_taxon,fiche.dateobs), nbobs+1);
	END IF;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_delete_releve_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    idsource integer;
BEGIN
    --SUPRESSION EN SYNTHESE
    
    SELECT INTO idsource id_source FROM synthese.bib_sources  WHERE db_schema='contactflore' AND db_field = 'id_releve_cflore' ;
    
	DELETE FROM synthese.syntheseff WHERE id_source = idsource AND id_fiche_source = old.id_releve_cflore::text; 
    RETURN OLD; 
END;
]]></definition>
</function>

<function name="synthese_insert_releve_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	fiche RECORD;
	mesobservateurs character varying(255);
	idsourcecflore integer;
BEGIN
	--Récupération des données id_source dans la table synthese.bib_sources
	SELECT INTO idsourcecflore id_source FROM synthese.bib_sources  WHERE db_schema='contactflore' AND db_field = 'id_releve_cflore' AND nom_source = 'Contact flore';
	--Récupération des données dans la table t_fiches_cf et de la liste des observateurs
	SELECT INTO fiche * FROM contactflore.t_fiches_cflore WHERE id_cflore = new.id_cflore;
	
	SELECT INTO mesobservateurs o.observateurs FROM contactflore.t_releves_cflore r
	JOIN contactflore.t_fiches_cflore f ON f.id_cflore = r.id_cflore
	LEFT JOIN (
                SELECT id_cflore, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
                FROM contactflore.cor_role_fiche_cflore c
                JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
                GROUP BY id_cflore
            ) o ON o.id_cflore = f.id_cflore
	WHERE r.id_releve_cflore = new.id_releve_cflore;
	
	INSERT INTO synthese.syntheseff (
		id_source,
		id_fiche_source,
		code_fiche_source,
		id_organisme,
		id_protocole,
		id_precision,
		cd_nom,
		insee,
		dateobs,
		observateurs,
		determinateur,
		altitude_retenue,
		remarques,
		derniere_action,
		supprime,
		the_geom_3857,
		the_geom_2154,
		the_geom_point,
		id_lot
	)
	VALUES(
	idsourcecflore,
	new.id_releve_cflore,
	'f'||new.id_cflore||'-r'||new.id_releve_cflore,
	fiche.id_organisme,
	fiche.id_protocole,
	1,
	new.cd_ref_origine,
	fiche.insee,
	fiche.dateobs,
	mesobservateurs,
        new.determinateur,
	fiche.altitude_retenue,
	new.commentaire,
	'c',
	false,
	fiche.the_geom_3857,
	fiche.the_geom_2154,
	fiche.the_geom_3857,
	fiche.id_lot
	);
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_cor_role_fiche_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    releves RECORD;
    test integer;
    mesobservateurs character varying(255);
    sources RECORD;
    idsource integer;
    idsourcecflore integer;
BEGIN
    --
    --CE TRIGGER NE DEVRAIT SERVIR QU'EN CAS DE MISE A JOUR MANUELLE SUR CETTE TABLE cor_role_fiche_cf
    --L'APPLI WEB ET LES TABLETTES NE FONT QUE DES INSERTS QUI SONT GERER PAR LE TRIGGER INSERT DE t_releves_cf
    --
        --on doit boucler pour récupérer le id_source car il y en a 2 possibles (cf et mortalité) pour le même schéma
    FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactflore' AND db_field = 'id_releve_cflore' LOOP
        IF sources.url = 'cflore' THEN
            idsourcecflore = sources.id_source;
        END IF;
    END LOOP;
    
    --Récupération des enregistrements de la table t_releves_cf avec l'id_cf de la table cor_role_fiche_cf
    FOR releves IN SELECT * FROM contactflore.t_releves_cflore WHERE id_cflore = new.id_cflore LOOP
        --test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
        SELECT INTO test id_fiche_source FROM synthese.syntheseff 
        WHERE (id_source = idsourcecflore) AND id_fiche_source = releves.id_releve_cflore::text;
        IF test ISNULL THEN
            RETURN null;
        ELSE
            SELECT INTO mesobservateurs o.observateurs FROM contactflore.t_releves_cflore r
            JOIN contactflore.t_fiches_cflore f ON f.id_cflore = r.id_cflore
            LEFT JOIN (
                SELECT id_cflore, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
                FROM contactflore.cor_role_fiche_cflore c
                JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
                GROUP BY id_cflore
            ) o ON o.id_cflore = f.id_cflore
            WHERE r.id_releve_cflore = releves.id_releve_cflore;
            --mise à jour de l'enregistrement correspondant dans syntheseff ; uniquement le champ observateurs ici
            UPDATE synthese.syntheseff SET
                observateurs = mesobservateurs
            WHERE (id_source = idsourcecflore) AND id_fiche_source = releves.id_releve_cflore::text; 
        END IF;
    END LOOP;
    RETURN NEW; 
END;
]]></definition>
</function>

<function name="synthese_update_fiche_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    releves RECORD;
    test integer;
    mesobservateurs character varying(255);
    sources RECORD;
    idsourcecflore integer;
BEGIN

    --on doit boucler pour récupérer le id_source car il y en a 2 possibles (cf et mortalité) pour le même schéma
    FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactflore' AND db_field = 'id_releve_cflore' LOOP
	IF sources.url = 'cflore' THEN
	    idsourcecflore = sources.id_source;
	END IF;
    END LOOP;
	--Récupération des données de la table t_releves_cf avec l'id_cf de la fiche modifié
	-- Ici on utilise le OLD id_cf pour être sur qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_fiches_cf
	--le trigger met à jour avec le NEW --> SET code_fiche_source =  ....
	FOR releves IN SELECT * FROM contactflore.t_releves_cflore WHERE id_cflore = old.id_cflore LOOP
		--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
		SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_fiche_source = releves.id_releve_cflore::text AND (id_source = idsourcecflore);
		IF test IS NOT NULL THEN
			SELECT INTO mesobservateurs o.observateurs FROM contactflore.t_releves_cflore r
			JOIN contactflore.t_fiches_cflore f ON f.id_cflore = r.id_cflore
			LEFT JOIN (
				SELECT id_cflore, array_to_string(array_agg(r.nom_role || ' ' || r.prenom_role), ', ') AS observateurs 
				FROM contactflore.cor_role_fiche_cflore c
				JOIN utilisateurs.t_roles r ON r.id_role = c.id_role
				GROUP BY id_cflore
			) o ON o.id_cflore = f.id_cflore
			WHERE r.id_releve_cflore = releves.id_releve_cflore;
			IF NOT St_Equals(new.the_geom_3857,old.the_geom_3857) OR NOT St_Equals(new.the_geom_2154,old.the_geom_2154) THEN
				
				--mise à jour de l'enregistrement correspondant dans syntheseff
				UPDATE synthese.syntheseff SET
				code_fiche_source = 'f'||new.id_cflore||'-r'||releves.id_releve_cf,
				id_organisme = new.id_organisme,
				id_protocole = new.id_protocole,
				insee = new.insee,
				dateobs = new.dateobs,
				observateurs = mesobservateurs,
				altitude_retenue = new.altitude_retenue,
				derniere_action = 'u',
				supprime = new.supprime,
				the_geom_3857 = new.the_geom_3857,
				the_geom_2154 = new.the_geom_2154,
				the_geom_point = new.the_geom_3857,
				id_lot = new.id_lot
				WHERE id_fiche_source = releves.id_releve_cflore::text AND (id_source = idsourcecflore) ;
			ELSE
				--mise à jour de l'enregistrement correspondant dans syntheseff
				UPDATE synthese.syntheseff SET
				code_fiche_source = 'f'||new.id_cflore||'-r'||releves.id_releve_cflore,
				id_organisme = new.id_organisme,
				id_protocole = new.id_protocole,
				insee = new.insee,
				dateobs = new.dateobs,
				observateurs = mesobservateurs,
				altitude_retenue = new.altitude_retenue,
				derniere_action = 'u',
				supprime = new.supprime,
				the_geom_3857 = new.the_geom_3857,
				the_geom_2154 = new.the_geom_2154,
				the_geom_point = new.the_geom_3857,
				id_lot = new.id_lot
			    WHERE id_fiche_source = releves.id_releve_cflore::text AND (id_source = idsourcecflore);
			END IF;
		END IF;
	END LOOP;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="synthese_update_releve_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
    test integer;
    sources RECORD;
    idsourcecflore integer;
BEGIN
    
	--on doit boucler pour récupérer le id_source car il y en a 2 possibles (cflore et mortalité) pour le même schéma
        FOR sources IN SELECT id_source, url  FROM synthese.bib_sources WHERE db_schema='contactflore' AND db_field = 'id_releve_cflore' LOOP
	    IF sources.url = 'cflore' THEN
	        idsourcecflore = sources.id_source;
	    END IF;
        END LOOP;
	--test si on a bien l'enregistrement dans la table syntheseff avant de le mettre à jour
	SELECT INTO test id_fiche_source FROM synthese.syntheseff WHERE id_fiche_source = old.id_releve_cflore::text AND (id_source = idsourcecflore);
	IF test IS NOT NULL THEN
		

		--mise à jour de l'enregistrement correspondant dans syntheseff
		UPDATE synthese.syntheseff SET
			id_fiche_source = new.id_releve_cflore,
			code_fiche_source = 'f'||new.id_cflore||'-r'||new.id_releve_cflore,
			cd_nom = new.cd_ref_origine,
			remarques = new.commentaire,
			determinateur = new.determinateur,
			derniere_action = 'u',
			supprime = new.supprime
		WHERE id_fiche_source = old.id_releve_cflore::text AND (id_source = idsourcecflore); -- Ici on utilise le OLD id_releve_cflore pour être sur 
		--qu'il existe dans la table synthese (cas improbable où on changerait la pk de la table t_releves_cflore
		--le trigger met à jour avec le NEW --> SET id_fiche_source = new.id_releve_cflore
	END IF;
	RETURN NEW; 			
END;
]]></definition>
</function>

<function name="update_fiche_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
macommune character(5);
BEGIN
-------------------------- gestion des infos relatives a la numerisation (srid utilisé et support utilisé : pda ou web ou sig)
-------------------------- attention la saisie sur le web réalise un insert sur qq données mais the_geom_3857 est "faussement inséré" par un update !!!
IF (NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL))
  OR (NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL)) 
   THEN
	IF NOT ST_Equals(new.the_geom_3857,old.the_geom_3857) OR (old.the_geom_3857 is null AND new.the_geom_3857 is NOT NULL) THEN
		new.the_geom_2154 = st_transform(new.the_geom_3857,2154);
		new.srid_dessin = 3857;
	ELSIF NOT ST_Equals(new.the_geom_2154,old.the_geom_2154) OR (old.the_geom_2154 is null AND new.the_geom_2154 is NOT NULL) THEN
		new.the_geom_3857 = st_transform(new.the_geom_2154,3857);
		new.srid_dessin = 2154;
	END IF;
-------gestion des divers control avec attributions de la commune : dans le cas d'un insert depuis le nomade uniquement via the_geom_2154 !!!!
	IF st_isvalid(new.the_geom_2154) = true THEN	-- si la topologie est bonne alors...
		-- on calcul la commune (celle qui contient le plus de zp en surface)...
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, new.the_geom_2154);
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(new.the_geom_2154); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
		    new.altitude_retenue = new.altitude_sig;
		ELSE
		    new.altitude_retenue = new.altitude_saisie;
		END IF;
	ELSE					
		SELECT INTO macommune c.insee FROM layers.l_communes c WHERE st_intersects(c.the_geom, ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154));
		new.insee = macommune;
		-- on calcul l'altitude
		new.altitude_sig = layers.f_isolines20(ST_PointFromWKB(st_centroid(Box2D(new.the_geom_2154)),2154)); -- mise à jour de l'altitude sig
		IF new.altitude_saisie IS null OR new.altitude_saisie = -1 THEN-- mis à jour de l'altitude retenue
			new.altitude_retenue = new.altitude_sig;
		ELSE
			new.altitude_retenue = new.altitude_saisie;
		END IF;
	END IF;				
END IF;
--- divers update
IF new.altitude_saisie <> old.altitude_saisie THEN
   new.altitude_retenue = new.altitude_saisie;
END IF;
new.date_update = 'now';
IF new.supprime <> old.supprime THEN	 
  IF new.supprime = 't' THEN
     update contactflore.t_releves_cflore set supprime = 't' WHERE id_cflore = old.id_cflore; 
  END IF;
  IF new.supprime = 'f' THEN
     update contactflore.t_releves_cflore set supprime = 'f' WHERE id_cflore = old.id_cflore; 
  END IF;
END IF;
RETURN NEW; 
END;
]]></definition>
</function>

<function name="update_releve_cflore"
		window-func="false"
		returns-setof="false"
		behavior-type="CALLED ON NULL INPUT"
		function-type="VOLATILE"
		security-type="SECURITY INVOKER"
		execution-cost="100"
		row-amount="0">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<language name="plpgsql" protected="true" sql-disabled="true"/>
	<return-type>
	<type name="trigger"/>
	</return-type>
	<definition><![CDATA[
DECLARE
	re integer;
BEGIN
   -- Si changement de taxon, 
	IF new.id_taxon<>old.id_taxon THEN
	   -- Correction du cd_ref_origine
		SELECT INTO re taxonomie.find_cdref(cd_nom) FROM taxonomie.bib_taxons WHERE id_taxon = new.id_taxon;
		new.cd_ref_origine = re;
	END IF;
RETURN NEW;			
END;
]]></definition>
</function>

<table name="bib_abondances_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="510.332" y="2142.87"/>
	<column name="id_abondance_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_abondance_cflore">
		<type name="character varying" length="25"/>
	</column>
	<constraint name="bib_abondance_cflore_pkey" type="pk-constr" table="contactflore.bib_abondances_cflore">
		<columns names="id_abondance_cflore" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_messages_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="1800.83" y="2356.2"/>
	<column name="id_message_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="texte_message_cflore">
		<type name="character varying" length="255"/>
	</column>
	<constraint name="pk_bib_messages_cflore" type="pk-constr" table="contactflore.bib_messages_cflore">
		<columns names="id_message_cflore" ref-type="src-columns"/>
	</constraint>
</table>

<table name="bib_phenologies_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="509.999" y="2271.2"/>
	<column name="id_phenologie_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="nom_phenologie_cflore">
		<type name="character varying" length="100"/>
	</column>
	<constraint name="bib_phenologie_cflore_pkey" type="pk-constr" table="contactflore.bib_phenologies_cflore">
		<columns names="id_phenologie_cflore" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_message_taxon_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="1863.5" y="2199.53"/>
	<column name="id_message_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_message_taxon_cflore" type="pk-constr" table="contactflore.cor_message_taxon_cflore">
		<columns names="id_message_cflore,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_role_fiche_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="1653.29" y="2847.63"/>
	<column name="id_cflore" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_role" not-null="true">
		<type name="integer"/>
	</column>
	<constraint name="pk_cor_role_fiche_cflore" type="pk-constr" table="contactflore.cor_role_fiche_cflore">
		<columns names="id_cflore,id_role" ref-type="src-columns"/>
	</constraint>
</table>

<table name="cor_unite_taxon_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="533.666" y="2389.07"/>
	<column name="id_unite_geo" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="derniere_date">
		<type name="date"/>
	</column>
	<column name="couleur" not-null="true">
		<type name="character varying" length="10"/>
	</column>
	<column name="nb_obs">
		<type name="integer"/>
	</column>
	<constraint name="cor_unite_taxon_cflore_pkey" type="pk-constr" table="contactflore.cor_unite_taxon_cflore">
		<columns names="id_unite_geo,id_taxon" ref-type="src-columns"/>
	</constraint>
</table>

<table name="t_fiches_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="1623.17" y="2450.73"/>
	<column name="id_cflore" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="insee">
		<type name="character" length="5"/>
	</column>
	<column name="dateobs" not-null="true">
		<type name="date"/>
	</column>
	<column name="altitude_saisie">
		<type name="integer"/>
	</column>
	<column name="altitude_sig">
		<type name="integer"/>
	</column>
	<column name="altitude_retenue">
		<type name="integer"/>
	</column>
	<column name="date_insert">
		<type name="timestamp"/>
	</column>
	<column name="date_update">
		<type name="timestamp"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="pdop">
		<type name="double precision"/>
	</column>
	<column name="saisie_initiale">
		<type name="character varying" length="20"/>
	</column>
	<column name="id_organisme">
		<type name="integer"/>
	</column>
	<column name="srid_dessin">
		<type name="integer"/>
	</column>
	<column name="id_protocole">
		<type name="integer"/>
	</column>
	<column name="id_lot">
		<type name="integer"/>
	</column>
	<column name="the_geom_3857">
		<type name="geometry"/>
	</column>
	<column name="the_geom_2154">
		<type name="geometry"/>
	</column>
	<constraint name="enforce_dims_the_geom_2154" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[(public.st_ndims(the_geom_2154) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_dims_the_geom_3857" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[(public.st_ndims(the_geom_3857) = 2)]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_2154" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[((public.geometrytype(the_geom_2154) = 'POINT'::text) OR (the_geom_2154 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_geotype_the_geom_3857" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[((public.geometrytype(the_geom_3857) = 'POINT'::text) OR (the_geom_3857 IS NULL))]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_2154" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[(public.st_srid(the_geom_2154) = 2154)]]></expression>
	</constraint>
	<constraint name="enforce_srid_the_geom_3857" type="ck-constr" table="contactflore.t_fiches_cflore">
			<expression><![CDATA[(public.st_srid(the_geom_3857) = 3857)]]></expression>
	</constraint>
	<constraint name="pk_t_fiches_cflore" type="pk-constr" table="contactflore.t_fiches_cflore">
		<columns names="id_cflore" ref-type="src-columns"/>
	</constraint>
</table>

<sequence name="t_releves_cflore_gid_seq"
	 start="1" increment="1"
	 min-value="1" max-value="9223372036854775807"
	 cache="1" cycle="false">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
</sequence>

<table name="t_releves_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="1097.43" y="2102.4"/>
	<column name="id_releve_cflore" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_cflore" not-null="true">
		<type name="bigint"/>
	</column>
	<column name="id_taxon" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_abondance_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="id_phenologie_cflore" not-null="true">
		<type name="integer"/>
	</column>
	<column name="cd_ref_origine">
		<type name="integer"/>
	</column>
	<column name="nom_taxon_saisi">
		<type name="character varying" length="255"/>
	</column>
	<column name="commentaire">
		<type name="text"/>
	</column>
	<column name="determinateur">
		<type name="character varying" length="255"/>
	</column>
	<column name="supprime" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="herbier" not-null="true" default-value="false">
		<type name="boolean"/>
	</column>
	<column name="gid" not-null="true" default-value="nextval('t_releves_cflore_gid_seq'::regclass)">
		<type name="integer"/>
	</column>
	<column name="validite_cflore">
		<type name="boolean"/>
	</column>
	<constraint name="t_releves_cflore_pkey" type="pk-constr" table="contactflore.t_releves_cflore">
		<columns names="id_releve_cflore" ref-type="src-columns"/>
	</constraint>
</table>

<view name="v_nomade_abondances_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="420.363" y="2569.07"/>
	<reference>
		<expression><![CDATA[ SELECT a.id_abondance_cflore,
    a.nom_abondance_cflore
   FROM contactflore.bib_abondances_cflore a
  ORDER BY a.id_abondance_cflore;]]></expression>
	</reference>
</view>

<view name="v_nomade_classes">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="910.297" y="2567.4"/>
	<reference>
		<expression><![CDATA[ SELECT g.id_liste AS id_classe,
    g.nom_liste AS nom_classe_fr,
    g.desc_liste AS desc_classe
   FROM (( SELECT l.id_liste,
            l.nom_liste,
            l.desc_liste,
            min(taxonomie.find_cdref(tx.cd_nom)) AS cd_ref
           FROM ((taxonomie.bib_listes l
             JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_liste = l.id_liste)))
             JOIN taxonomie.bib_taxons tx ON ((tx.id_taxon = ctl.id_taxon)))
          WHERE ((l.id_liste > 300) AND (l.id_liste < 400))
          GROUP BY l.id_liste, l.nom_liste, l.desc_liste) g
     JOIN taxonomie.taxref t ON ((t.cd_nom = g.cd_ref)))
  WHERE ((t.regne)::text = 'Plantae'::text);]]></expression>
	</reference>
</view>

<view name="v_nomade_observateurs_flore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="421.999" y="2684.93"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT r.id_role,
    r.nom_role,
    r.prenom_role
   FROM utilisateurs.t_roles r
  WHERE ((r.id_role IN ( SELECT DISTINCT cr.id_role_utilisateur
           FROM utilisateurs.cor_roles cr
          WHERE (cr.id_role_groupe IN ( SELECT crm.id_role
                   FROM utilisateurs.cor_role_menu crm
                  WHERE (crm.id_menu = 10)))
          ORDER BY cr.id_role_utilisateur)) OR (r.id_role IN ( SELECT crm.id_role
           FROM (utilisateurs.cor_role_menu crm
             JOIN utilisateurs.t_roles r_1 ON ((((r_1.id_role = crm.id_role) AND (crm.id_menu = 9)) AND (r_1.groupe = false)))))))
  ORDER BY r.nom_role, r.prenom_role, r.id_role;]]></expression>
	</reference>
</view>

<view name="v_nomade_phenologies_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="422.599" y="2819.93"/>
	<reference>
		<expression><![CDATA[ SELECT p.id_phenologie_cflore,
    p.nom_phenologie_cflore
   FROM contactflore.bib_phenologies_cflore p
  ORDER BY p.id_phenologie_cflore;]]></expression>
	</reference>
</view>

<view name="v_nomade_taxons_flore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="911.866" y="2823.27"/>
	<reference>
		<expression><![CDATA[ SELECT DISTINCT t.id_taxon,
    taxonomie.find_cdref(tx.cd_nom) AS cd_ref,
    tx.cd_nom,
    t.nom_latin,
    t.nom_francais,
    g.id_classe,
    f2.bool AS patrimonial,
    m.texte_message_cflore AS message
   FROM ((((((taxonomie.bib_taxons t
     LEFT JOIN contactflore.cor_message_taxon_cflore cmt ON ((cmt.id_taxon = t.id_taxon)))
     LEFT JOIN contactflore.bib_messages_cflore m ON ((m.id_message_cflore = cmt.id_message_cflore)))
     JOIN taxonomie.cor_taxon_liste ctl ON ((ctl.id_taxon = t.id_taxon)))
     JOIN contactflore.v_nomade_classes g ON ((g.id_classe = ctl.id_liste)))
     JOIN taxonomie.taxref tx ON ((tx.cd_nom = t.cd_nom)))
     JOIN cor_boolean f2 ON (((f2.expression)::text = (t.filtre2)::text)))
  WHERE ((t.filtre1)::text = 'oui'::text)
  ORDER BY t.id_taxon, taxonomie.find_cdref(tx.cd_nom), t.nom_latin, t.nom_francais, g.id_classe, f2.bool;]]></expression>
	</reference>
</view>

<view name="v_nomade_unites_geo_cflore">
	<schema name="contactflore"/>
	<role name="geonatuser"/>
	<position x="908.133" y="2683.27"/>
	<reference>
		<expression><![CDATA[ SELECT st_simplifypreservetopology(l_unites_geo.the_geom, (15)::double precision) AS the_geom,
    l_unites_geo.id_unite_geo
   FROM layers.l_unites_geo
  GROUP BY l_unites_geo.the_geom, l_unites_geo.id_unite_geo;]]></expression>
	</reference>
</view>

<index name="i_fk_cor_message_cflore_bib_me" table="contactflore.cor_message_taxon_cflore"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_message_cflore"/>
		</idxelement>
</index>

<index name="i_fk_cor_message_cflore_bib_ta" table="contactflore.cor_message_taxon_cflore"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_taxon"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_cflore_t_fiche" table="contactflore.cor_role_fiche_cflore"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_cflore"/>
		</idxelement>
</index>

<index name="i_fk_cor_role_fiche_cflore_t_roles" table="contactflore.cor_role_fiche_cflore"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="id_role"/>
		</idxelement>
</index>

<index name="i_fk_t_fiches_cflore_l_communes" table="contactflore.t_fiches_cflore"
	 concurrent="false" unique="false" fast-update="false" buffering="false"
	 index-type="btree" factor="90">
		<idxelement use-sorting="false">
			<column name="insee"/>
		</idxelement>
</index>

<trigger name="tri_insert_fiche_cflore" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactflore.t_fiches_cflore">
		<function signature="contactflore.insert_fiche_cflore()"/>
</trigger>

<trigger name="tri_insert_releve_cflore" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactflore.t_releves_cflore">
		<function signature="contactflore.insert_releve_cflore()"/>
</trigger>

<trigger name="tri_synthese_delete_releve_cflore" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="true" upd-event="false" trunc-event="false"
	 table="contactflore.t_releves_cflore">
		<function signature="contactflore.synthese_delete_releve_cflore()"/>
</trigger>

<trigger name="tri_synthese_insert_releve_cflore" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="false" trunc-event="false"
	 table="contactflore.t_releves_cflore">
		<function signature="contactflore.synthese_insert_releve_cflore()"/>
</trigger>

<trigger name="tri_synthese_update_fiche_cflore" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactflore.t_fiches_cflore">
		<function signature="contactflore.synthese_update_fiche_cflore()"/>
</trigger>

<trigger name="tri_synthese_update_releve_cflore" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactflore.t_releves_cflore">
		<function signature="contactflore.synthese_update_releve_cflore()"/>
</trigger>

<trigger name="tri_update_fiche_cflore" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactflore.t_fiches_cflore">
		<function signature="contactflore.update_fiche_cflore()"/>
</trigger>

<trigger name="tri_update_releve_cflore" firing-type="BEFORE" per-line="true" constraint="false"
	 ins-event="false" del-event="false" upd-event="true" trunc-event="false"
	 table="contactflore.t_releves_cflore">
		<function signature="contactflore.update_releve_cflore()"/>
</trigger>

<trigger name="tri_update_synthese_cor_role_fiche_cflore" firing-type="AFTER" per-line="true" constraint="false"
	 ins-event="true" del-event="false" upd-event="true" trunc-event="false"
	 table="contactflore.cor_role_fiche_cflore">
		<function signature="contactflore.synthese_update_cor_role_fiche_cflore()"/>
</trigger>

<textbox name="v_nomade_criteres_cf" italic="true" font-size="9">
	<position x="261.667" y="350"/>
	<comment><![CDATA[Vue de la liste des critères pour le Contact Faune mobile]]></comment>
</textbox>

<textbox name="v_nomade_unites_geo_cf" italic="true" font-size="9">
	<position x="260" y="463.333"/>
	<comment><![CDATA[Vue des unités géographiques simplifiées]]></comment>
</textbox>

<textbox name="v_nomade_observateurs_faune" italic="true" font-size="9">
	<position x="260" y="590"/>
	<comment><![CDATA[Vue de la liste des utilisateurs pour le Contact Faune mobile]]></comment>
</textbox>

<textbox name="v_nomade_taxons_faune" italic="true" font-size="9">
	<position x="261.667" y="741.667"/>
	<comment><![CDATA[Vue de la liste des taxons pour le Contact Faune mobile]]></comment>
</textbox>

<textbox name="v_nomade_classes" italic="true" font-size="9">
	<position x="260" y="885.001"/>
	<comment><![CDATA[Vue de la liste des groupes taxonomiques (listes) pour le Contact Faune mobile]]></comment>
</textbox>

<textbox name="v_mobile_recherche" italic="true" font-size="9">
	<position x="370" y="88.3333"/>
	<comment><![CDATA[Vue des observations de la synthèse utilisée dans l'application mobile de recherche (flore initialement)]]></comment>
</textbox>

<textbox name="v_nomade_abondances_cflore" font-size="9">
	<position x="423.333" y="2606.67"/>
	<comment><![CDATA[Vue de la liste des critères d'abondance pour le Contact Flore mobile]]></comment>
</textbox>

<textbox name="v_nomade_classes_cp" italic="true" font-size="9">
	<position x="913.334" y="2605"/>
	<comment><![CDATA[Vue de la liste des groupes taxonomiques (listes) pour le Contact Flore mobile]]></comment>
</textbox>

<textbox name="v_nomade_unites_geo_cf_cp" italic="true" font-size="9">
	<position x="911.667" y="2723.33"/>
	<comment><![CDATA[Vue des unités géographiques simplifiées]]></comment>
</textbox>

<textbox name="v_nomade_observateurs_faune_cp" italic="true" font-size="9">
	<position x="425" y="2723.33"/>
	<comment><![CDATA[Vue de la liste des utilisateurs pour le Contact Faune mobile]]></comment>
</textbox>

<textbox name="v_nomade_taxons_flore" italic="true" font-size="9">
	<position x="913.333" y="2861.67"/>
	<comment><![CDATA[Vue de la liste des taxons pour le Contact Flore mobile]]></comment>
</textbox>

<textbox name="v_nomade_taxons_flore_cp" italic="true" font-size="9">
	<position x="420" y="2856.66"/>
	<comment><![CDATA[Vue de la liste des critères de phénologies pour le Contact Flore mobile]]></comment>
</textbox>

<textbox name="v_nomade_classes_cp1" italic="true" font-size="9">
	<position x="4083.33" y="591.668"/>
	<comment><![CDATA[Vue de la liste des groupes taxonomiques (listes)]]></comment>
</textbox>

<constraint name="bib_criteres_cf_id_critere_synthese_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="synthese.bib_criteres_synthese" table="contactfaune.bib_criteres_cf">
	<columns names="id_critere_synthese" ref-type="src-columns"/>
	<columns names="id_critere_synthese" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_critere_liste_bib_liste" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_listes" table="contactfaune.cor_critere_liste">
	<columns names="id_liste" ref-type="src-columns"/>
	<columns names="id_liste" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_critere_liste_bib_criter" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactfaune.bib_criteres_cf" table="contactfaune.cor_critere_liste">
	<columns names="id_critere_cf" ref-type="src-columns"/>
	<columns names="id_critere_cf" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_message_taxon_l_unites_geo" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactfaune.bib_messages_cf" table="contactfaune.cor_message_taxon">
	<columns names="id_message_cf" ref-type="src-columns"/>
	<columns names="id_message_cf" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_cf_t_fiches_cf" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="contactfaune.t_fiches_cf" table="contactfaune.cor_role_fiche_cf">
	<columns names="id_cf" ref-type="src-columns"/>
	<columns names="id_cf" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_cf_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="contactfaune.cor_role_fiche_cf">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cf_id_lot_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="contactfaune.t_fiches_cf">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cf_id_organisme_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="contactfaune.t_fiches_cf">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cf_id_protocole_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="contactfaune.t_fiches_cf">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cf_bib_criteres_cf" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactfaune.bib_criteres_cf" table="contactfaune.t_releves_cf">
	<columns names="id_critere_cf" ref-type="src-columns"/>
	<columns names="id_critere_cf" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cf_t_fiches_cf" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactfaune.t_fiches_cf" table="contactfaune.t_releves_cf">
	<columns names="id_cf" ref-type="src-columns"/>
	<columns names="id_cf" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_bryo_observateur_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="bryophytes.t_stations_bryo" table="bryophytes.cor_bryo_observateur">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_bryo_observateur_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="bryophytes.cor_bryo_observateur">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_bryo_taxons_cd_nom_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.taxref" table="bryophytes.cor_bryo_taxon">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_bryo_taxons_id_abondance_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="bryophytes.bib_abondances" table="bryophytes.cor_bryo_taxon">
	<columns names="id_abondance" ref-type="src-columns"/>
	<columns names="id_abondance" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_bryo_taxons_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="bryophytes.t_stations_bryo" table="bryophytes.cor_bryo_taxon">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_bryo_bib_expositions" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="bryophytes.bib_expositions" table="bryophytes.t_stations_bryo">
	<columns names="id_exposition" ref-type="src-columns"/>
	<columns names="id_exposition" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_bryo_t_protocoles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="bryophytes.t_stations_bryo">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_bryo_bib_lots" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="bryophytes.t_stations_bryo">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_bryo_bib_organismes" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="bryophytes.t_stations_bryo">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_bryo_bib_supports" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_supports" table="bryophytes.t_stations_bryo">
	<columns names="id_support" ref-type="src-columns"/>
	<columns names="id_support" ref-type="dst-columns"/>
</constraint>

<constraint name="bib_taxons_fp_cd_nom_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.taxref" table="florepatri.bib_taxons_fp">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_ap_perturb_bib_perturbati" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_perturbations" table="florepatri.cor_ap_perturb">
	<columns names="codeper" ref-type="src-columns"/>
	<columns names="codeper" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_ap_perturb_t_apresence" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florepatri.t_apresence" table="florepatri.cor_ap_perturb">
	<columns names="indexap" ref-type="src-columns"/>
	<columns names="indexap" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_ap_physionomie_bib_physio" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_physionomies" table="florepatri.cor_ap_physionomie">
	<columns names="id_physionomie" ref-type="src-columns"/>
	<columns names="id_physionomie" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_ap_physionomie_t_apresence" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florepatri.t_apresence" table="florepatri.cor_ap_physionomie">
	<columns names="indexap" ref-type="src-columns"/>
	<columns names="indexap" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_taxon_statut_cd_nom_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_taxons_fp" table="florepatri.cor_taxon_statut">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_taxon_statut_bib_statuts" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_statuts" table="florepatri.cor_taxon_statut">
	<columns names="id_statut" ref-type="src-columns"/>
	<columns names="id_statut" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_zp_obs_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="florepatri.cor_zp_obs">
	<columns names="codeobs" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_zp_obs_t_zprospection" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florepatri.t_zprospection" table="florepatri.cor_zp_obs">
	<columns names="indexzp" ref-type="src-columns"/>
	<columns names="indexzp" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_apresence_bib_phenologie" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_phenologies" table="florepatri.t_apresence">
	<columns names="codepheno" ref-type="src-columns"/>
	<columns names="codepheno" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_apresence_t_zprospection" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florepatri.t_zprospection" table="florepatri.t_apresence">
	<columns names="indexzp" ref-type="src-columns"/>
	<columns names="indexzp" ref-type="dst-columns"/>
</constraint>

<constraint name="t_apresence_comptage_methodo_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_comptages_methodo" table="florepatri.t_apresence">
	<columns names="id_comptage_methodo" ref-type="src-columns"/>
	<columns names="id_comptage_methodo" ref-type="dst-columns"/>
</constraint>

<constraint name="t_apresence_frequence_methodo_new_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_frequences_methodo_new" table="florepatri.t_apresence">
	<columns names="id_frequence_methodo_new" ref-type="src-columns"/>
	<columns names="id_frequence_methodo_new" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_zprospection_bib_taxon_fp" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_taxons_fp" table="florepatri.t_zprospection">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="t_zprospection_id_organisme_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="florepatri.t_zprospection">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_zprospection_t_protocoles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="florepatri.t_zprospection">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_zprospection_bib_lots" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="florepatri.t_zprospection">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="t_zprospection_id_rezo_ecrins_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florepatri.bib_rezo_ecrins" table="florepatri.t_zprospection">
	<columns names="id_rezo_ecrins" ref-type="src-columns"/>
	<columns names="id_rezo_ecrins" ref-type="dst-columns"/>
</constraint>

<constraint name="t_zprospection_id_secteur_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="layers.l_secteurs" table="florepatri.t_zprospection">
	<columns names="id_secteur" ref-type="src-columns"/>
	<columns names="id_secteur" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_fs_delphine_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florestation.t_stations_fs" table="florestation.cor_fs_delphine">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_fs_microrelief_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florestation.t_stations_fs" table="florestation.cor_fs_microrelief">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_fs_microrelief_bib_microreliefs" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_microreliefs" table="florestation.cor_fs_microrelief">
	<columns names="id_microrelief" ref-type="src-columns"/>
	<columns names="id_microrelief" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_fs_observateur_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florestation.t_stations_fs" table="florestation.cor_fs_observateur">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_fs_observateur_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="florestation.cor_fs_observateur">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_fs_taxons_cd_nom_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.taxref" table="florestation.cor_fs_taxon">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_fs_taxons_id_station_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="florestation.t_stations_fs" table="florestation.cor_fs_taxon">
	<columns names="id_station" ref-type="src-columns"/>
	<columns names="id_station" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_de_1_4m" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_abondances" table="florestation.cor_fs_taxon">
	<columns names="de_1_4m" ref-type="src-columns"/>
	<columns names="id_abondance" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_herb" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_abondances" table="florestation.cor_fs_taxon">
	<columns names="herb" ref-type="src-columns"/>
	<columns names="id_abondance" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_inf_1m" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_abondances" table="florestation.cor_fs_taxon">
	<columns names="inf_1m" ref-type="src-columns"/>
	<columns names="id_abondance" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_sup_4m" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_abondances" table="florestation.cor_fs_taxon">
	<columns names="sup_4m" ref-type="src-columns"/>
	<columns names="id_abondance" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_expositions" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_expositions" table="florestation.t_stations_fs">
	<columns names="id_exposition" ref-type="src-columns"/>
	<columns names="id_exposition" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_homogenes" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_homogenes" table="florestation.t_stations_fs">
	<columns names="id_homogene" ref-type="src-columns"/>
	<columns names="id_homogene" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_programmes_" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_programmes_fs" table="florestation.t_stations_fs">
	<columns names="id_programme_fs" ref-type="src-columns"/>
	<columns names="id_programme_fs" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_supports" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_supports" table="florestation.t_stations_fs">
	<columns names="id_support" ref-type="src-columns"/>
	<columns names="id_support" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_t_protocoles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="florestation.t_stations_fs">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_organismes" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="florestation.t_stations_fs">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_lots" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="florestation.t_stations_fs">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_stations_fs_bib_surfaces" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="florestation.bib_surfaces" table="florestation.t_stations_fs">
	<columns names="id_surface" ref-type="src-columns"/>
	<columns names="id_surface" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_role_menu_application_id_menu_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_menus" table="utilisateurs.cor_role_menu">
	<columns names="id_menu" ref-type="src-columns"/>
	<columns names="id_menu" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_role_menu_application_id_role_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_roles" table="utilisateurs.cor_role_menu">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_roles_id_role_groupe_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_roles" table="utilisateurs.cor_roles">
	<columns names="id_role_groupe" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_roles_id_role_utilisateur_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_roles" table="utilisateurs.cor_roles">
	<columns names="id_role_utilisateur" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="t_roles_id_organisme_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="utilisateurs.t_roles">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="t_roles_id_unite_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_unites" table="utilisateurs.t_roles">
	<columns names="id_unite" ref-type="src-columns"/>
	<columns names="id_unite" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_bib_taxons_taxref" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="taxonomie.taxref" table="taxonomie.bib_taxons">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_taxon_attrib_bib_taxons_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="taxonomie.cor_taxon_attribut">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_taxon_attrib_bib_attrib_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="taxonomie.bib_attributs" table="taxonomie.cor_taxon_attribut">
	<columns names="id_attribut" ref-type="src-columns"/>
	<columns names="id_attribut" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_taxon_liste_bib_taxons_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="taxonomie.bib_taxons" table="taxonomie.cor_taxon_liste">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_taxon_liste_bib_listes_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="taxonomie.bib_listes" table="taxonomie.cor_taxon_liste">
	<columns names="id_liste" ref-type="src-columns"/>
	<columns names="id_liste" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_taxref_bib_taxref_habitats" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxref_habitats" table="taxonomie.taxref">
	<columns names="id_habitat" ref-type="src-columns"/>
	<columns names="id_habitat" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_taxref_bib_taxref_rangs" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxref_rangs" table="taxonomie.taxref">
	<columns names="id_rang" ref-type="src-columns"/>
	<columns names="id_rang" ref-type="dst-columns"/>
</constraint>

<constraint name="taxref_id_statut_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxref_statuts" table="taxonomie.taxref">
	<columns names="id_statut" ref-type="src-columns"/>
	<columns names="id_statut" ref-type="dst-columns"/>
</constraint>

<constraint name="bib_criteres_inv_id_critere_synthese_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="synthese.bib_criteres_synthese" table="contactinv.bib_criteres_inv">
	<columns names="id_critere_synthese" ref-type="src-columns"/>
	<columns names="id_critere_synthese" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_message_taxon_inv_bib_taxons" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="contactinv.cor_message_taxon">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_message_taxon_inv_l_unites_geo" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactinv.bib_messages_inv" table="contactinv.cor_message_taxon">
	<columns names="id_message_inv" ref-type="src-columns"/>
	<columns names="id_message_inv" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_inv_t_fiches_inv" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="contactinv.t_fiches_inv" table="contactinv.cor_role_fiche_inv">
	<columns names="id_inv" ref-type="src-columns"/>
	<columns names="id_inv" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_inv_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="contactinv.cor_role_fiche_inv">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_unite_taxon_inv_bib_taxons" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="contactinv.cor_unite_taxon_inv">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_fiches_inv_bib_milieux_inv" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactinv.bib_milieux_inv" table="contactinv.t_fiches_inv">
	<columns names="id_milieu_inv" ref-type="src-columns"/>
	<columns names="id_milieu_inv" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_inv_id_lot_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="contactinv.t_fiches_inv">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_inv_id_organisme_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="contactinv.t_fiches_inv">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_inv_id_protocole_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="contactinv.t_fiches_inv">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_inv_bib_criteres_inv" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactinv.bib_criteres_inv" table="contactinv.t_releves_inv">
	<columns names="id_critere_inv" ref-type="src-columns"/>
	<columns names="id_critere_inv" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_inv_bib_taxons" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="contactinv.t_releves_inv">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_inv_t_fiches_inv" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactinv.t_fiches_inv" table="contactinv.t_releves_inv">
	<columns names="id_inv" ref-type="src-columns"/>
	<columns names="id_inv" ref-type="dst-columns"/>
</constraint>

<constraint name="l_communes_id_secteur_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="layers.l_secteurs" table="layers.l_communes">
	<columns names="id_secteur" ref-type="src-columns"/>
	<columns names="id_secteur" ref-type="dst-columns"/>
</constraint>

<constraint name="l_zonesstatut_id_type_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="layers.bib_typeszones" table="layers.l_zonesstatut">
	<columns names="id_type" ref-type="src-columns"/>
	<columns names="id_type" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_bib_programmes_bib_lots" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_programmes" table="meta.bib_lots">
	<columns names="id_programme" ref-type="src-columns"/>
	<columns names="id_programme" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_unite_synthese_syntheseff" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="synthese.syntheseff" table="synthese.cor_unite_synthese">
	<columns names="id_synthese" ref-type="src-columns"/>
	<columns names="id_synthese" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_zonesstatut_synthese_syntheseff" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="synthese.syntheseff" table="synthese.cor_zonesstatut_synthese">
	<columns names="id_synthese" ref-type="src-columns"/>
	<columns names="id_synthese" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_synthese_bib_organismes" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="synthese.syntheseff">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="synthese_id_critere_synthese_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="synthese.bib_criteres_synthese" table="synthese.syntheseff">
	<columns names="id_critere_synthese" ref-type="src-columns"/>
	<columns names="id_critere_synthese" ref-type="dst-columns"/>
</constraint>

<constraint name="synthese_id_lot_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="synthese.syntheseff">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="synthese_id_precision_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_precisions" table="synthese.syntheseff">
	<columns names="id_precision" ref-type="src-columns"/>
	<columns names="id_precision" ref-type="dst-columns"/>
</constraint>

<constraint name="synthese_id_protocole_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="synthese.syntheseff">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="synthese_id_source_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="synthese.bib_sources" table="synthese.syntheseff">
	<columns names="id_source" ref-type="src-columns"/>
	<columns names="id_source" ref-type="dst-columns"/>
</constraint>

<constraint name="taxref_protection_especes_cd_nom_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.taxref" table="taxonomie.taxref_protection_especes">
	<columns names="cd_nom" ref-type="src-columns"/>
	<columns names="cd_nom" ref-type="dst-columns"/>
</constraint>

<constraint name="taxref_protection_especes_cd_protection_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="NO ACTION" del-action="NO ACTION" ref-table="taxonomie.taxref_protection_articles" table="taxonomie.taxref_protection_especes">
	<columns names="cd_protection" ref-type="src-columns"/>
	<columns names="cd_protection" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_role_droit_application_id_application_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_applications" table="utilisateurs.cor_role_droit_application">
	<columns names="id_application" ref-type="src-columns"/>
	<columns names="id_application" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_role_droit_application_id_droit_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.bib_droits" table="utilisateurs.cor_role_droit_application">
	<columns names="id_droit" ref-type="src-columns"/>
	<columns names="id_droit" ref-type="dst-columns"/>
</constraint>

<constraint name="cor_role_droit_application_id_role_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_roles" table="utilisateurs.cor_role_droit_application">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="t_menus_id_application_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="utilisateurs.t_applications" table="utilisateurs.t_menus">
	<columns names="id_application" ref-type="src-columns"/>
	<columns names="id_application" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_message_taxon_cflore_bib_taxons" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="contactflore.cor_message_taxon_cflore">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_message_taxon_cflore_l_unites_geo" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactflore.bib_messages_cflore" table="contactflore.cor_message_taxon_cflore">
	<columns names="id_message_cflore" ref-type="src-columns"/>
	<columns names="id_message_cflore" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_cflore_t_fiches_cflore" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="CASCADE" ref-table="contactflore.t_fiches_cflore" table="contactflore.cor_role_fiche_cflore">
	<columns names="id_cflore" ref-type="src-columns"/>
	<columns names="id_cflore" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_cor_role_fiche_cflore_t_roles" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.t_roles" table="contactflore.cor_role_fiche_cflore">
	<columns names="id_role" ref-type="src-columns"/>
	<columns names="id_role" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cflore_id_lot_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.bib_lots" table="contactflore.t_fiches_cflore">
	<columns names="id_lot" ref-type="src-columns"/>
	<columns names="id_lot" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cflore_id_organisme_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="utilisateurs.bib_organismes" table="contactflore.t_fiches_cflore">
	<columns names="id_organisme" ref-type="src-columns"/>
	<columns names="id_organisme" ref-type="dst-columns"/>
</constraint>

<constraint name="t_fiches_cflore_id_protocole_fkey" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="meta.t_protocoles" table="contactflore.t_fiches_cflore">
	<columns names="id_protocole" ref-type="src-columns"/>
	<columns names="id_protocole" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cflore_bib_abondances_cflore" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactflore.bib_abondances_cflore" table="contactflore.t_releves_cflore">
	<columns names="id_abondance_cflore" ref-type="src-columns"/>
	<columns names="id_abondance_cflore" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cflore_bib_phenologies_cflore" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactflore.bib_phenologies_cflore" table="contactflore.t_releves_cflore">
	<columns names="id_phenologie_cflore" ref-type="src-columns"/>
	<columns names="id_phenologie_cflore" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cflore_bib_taxons" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="taxonomie.bib_taxons" table="contactflore.t_releves_cflore">
	<columns names="id_taxon" ref-type="src-columns"/>
	<columns names="id_taxon" ref-type="dst-columns"/>
</constraint>

<constraint name="fk_t_releves_cflore_t_fiches_cflore" type="fk-constr" comparison-type="MATCH SIMPLE"
	 upd-action="CASCADE" del-action="NO ACTION" ref-table="contactflore.t_fiches_cflore" table="contactflore.t_releves_cflore">
	<columns names="id_cflore" ref-type="src-columns"/>
	<columns names="id_cflore" ref-type="dst-columns"/>
</constraint>

<relationship name="rel_bib_criteres_cf_bib_criteres_synthese" type="relfk"
	 custom-color="#e41bea"
	 src-table="contactfaune.bib_criteres_cf"
	 dst-table="synthese.bib_criteres_synthese"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_critere_liste_bib_listes" type="relfk"
	 custom-color="#36beed"
	 src-table="contactfaune.cor_critere_liste"
	 dst-table="taxonomie.bib_listes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_critere_liste_bib_criteres_cf" type="relfk"
	 custom-color="#871fa4"
	 src-table="contactfaune.cor_critere_liste"
	 dst-table="contactfaune.bib_criteres_cf"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_message_taxon_bib_messages_cf" type="relfk"
	 custom-color="#484368"
	 src-table="contactfaune.cor_message_taxon"
	 dst-table="contactfaune.bib_messages_cf"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_role_fiche_cf_t_fiches_cf" type="relfk"
	 custom-color="#ce5d86"
	 src-table="contactfaune.cor_role_fiche_cf"
	 dst-table="contactfaune.t_fiches_cf"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-90.7455" y="-11.0382"/>
	</label>
</relationship>

<relationship name="rel_cor_role_fiche_cf_t_roles" type="relfk"
	 custom-color="#132c5f"
	 src-table="contactfaune.cor_role_fiche_cf"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_cf_bib_lots" type="relfk"
	 custom-color="#3aff7d"
	 src-table="contactfaune.t_fiches_cf"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_cf_bib_organismes" type="relfk"
	 custom-color="#5cce88"
	 src-table="contactfaune.t_fiches_cf"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-7.97161" y="-0.835038"/>
	</label>
</relationship>

<relationship name="rel_t_fiches_cf_t_protocoles" type="relfk"
	 custom-color="#264253"
	 src-table="contactfaune.t_fiches_cf"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_releves_cf_bib_criteres_cf" type="relfk"
	 custom-color="#e55a24"
	 src-table="contactfaune.t_releves_cf"
	 dst-table="contactfaune.bib_criteres_cf"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-99.7803" y="-23.0383"/>
	</label>
</relationship>

<relationship name="rel_t_releves_cf_t_fiches_cf" type="relfk"
	 custom-color="#044d5b"
	 src-table="contactfaune.t_releves_cf"
	 dst-table="contactfaune.t_fiches_cf"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_bryo_observateur_t_stations_bryo" type="relfk"
	 custom-color="#713b0a"
	 src-table="bryophytes.cor_bryo_observateur"
	 dst-table="bryophytes.t_stations_bryo"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-98.9974" y="1.62665"/>
	</label>
</relationship>

<relationship name="rel_cor_bryo_observateur_t_roles" type="relfk"
	 custom-color="#6217d0"
	 src-table="bryophytes.cor_bryo_observateur"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_bryo_taxon_taxref" type="relfk"
	 custom-color="#aa9ef1"
	 src-table="bryophytes.cor_bryo_taxon"
	 dst-table="taxonomie.taxref"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_bryo_taxon_bib_abondances" type="relfk"
	 custom-color="#468d0a"
	 src-table="bryophytes.cor_bryo_taxon"
	 dst-table="bryophytes.bib_abondances"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="87.3544" y="3.9312"/>
	</label>
</relationship>

<relationship name="rel_cor_bryo_taxon_t_stations_bryo" type="relfk"
	 custom-color="#822586"
	 src-table="bryophytes.cor_bryo_taxon"
	 dst-table="bryophytes.t_stations_bryo"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="104.419" y="-21.7559"/>
	</label>
</relationship>

<relationship name="rel_t_stations_bryo_bib_expositions" type="relfk"
	 custom-color="#1edf72"
	 src-table="bryophytes.t_stations_bryo"
	 dst-table="bryophytes.bib_expositions"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-79.5295" y="-42.6624"/>
	</label>
</relationship>

<relationship name="rel_t_stations_bryo_t_protocoles" type="relfk"
	 custom-color="#e86279"
	 src-table="bryophytes.t_stations_bryo"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_bryo_bib_lots" type="relfk"
	 custom-color="#acfe05"
	 src-table="bryophytes.t_stations_bryo"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-0.695339" y="-42.7339"/>
	</label>
</relationship>

<relationship name="rel_t_stations_bryo_bib_organismes" type="relfk"
	 custom-color="#593164"
	 src-table="bryophytes.t_stations_bryo"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_bryo_bib_supports" type="relfk"
	 custom-color="#4f7b62"
	 src-table="bryophytes.t_stations_bryo"
	 dst-table="meta.bib_supports"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="1.41136" y="-45.06"/>
	</label>
</relationship>

<relationship name="rel_bib_taxons_fp_taxref" type="relfk"
	 custom-color="#cc5671"
	 src-table="florepatri.bib_taxons_fp"
	 dst-table="taxonomie.taxref"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_ap_perturb_bib_perturbations" type="relfk"
	 custom-color="#247722"
	 src-table="florepatri.cor_ap_perturb"
	 dst-table="florepatri.bib_perturbations"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_ap_perturb_t_apresence" type="relfk"
	 custom-color="#e6e82a"
	 src-table="florepatri.cor_ap_perturb"
	 dst-table="florepatri.t_apresence"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_ap_physionomie_bib_physionomies" type="relfk"
	 custom-color="#089c3d"
	 src-table="florepatri.cor_ap_physionomie"
	 dst-table="florepatri.bib_physionomies"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_ap_physionomie_t_apresence" type="relfk"
	 custom-color="#21df05"
	 src-table="florepatri.cor_ap_physionomie"
	 dst-table="florepatri.t_apresence"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_taxon_statut_bib_taxons_fp" type="relfk"
	 custom-color="#463635"
	 src-table="florepatri.cor_taxon_statut"
	 dst-table="florepatri.bib_taxons_fp"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-101.527" y="-19.0714"/>
	</label>
</relationship>

<relationship name="rel_cor_taxon_statut_bib_statuts" type="relfk"
	 custom-color="#7e3399"
	 src-table="florepatri.cor_taxon_statut"
	 dst-table="florepatri.bib_statuts"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="97.3894" y="-34.9048"/>
	</label>
</relationship>

<relationship name="rel_cor_zp_obs_t_roles" type="relfk"
	 custom-color="#c8e1b6"
	 src-table="florepatri.cor_zp_obs"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-68.6867" y="-23.2581"/>
	</label>
</relationship>

<relationship name="rel_cor_zp_obs_t_zprospection" type="relfk"
	 custom-color="#b4ece1"
	 src-table="florepatri.cor_zp_obs"
	 dst-table="florepatri.t_zprospection"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_apresence_bib_phenologies" type="relfk"
	 custom-color="#a4b789"
	 src-table="florepatri.t_apresence"
	 dst-table="florepatri.bib_phenologies"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_apresence_t_zprospection" type="relfk"
	 custom-color="#51fd24"
	 src-table="florepatri.t_apresence"
	 dst-table="florepatri.t_zprospection"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_apresence_bib_comptages_methodo" type="relfk"
	 custom-color="#55deed"
	 src-table="florepatri.t_apresence"
	 dst-table="florepatri.bib_comptages_methodo"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_apresence_bib_frequences_methodo_new" type="relfk"
	 custom-color="#916b37"
	 src-table="florepatri.t_apresence"
	 dst-table="florepatri.bib_frequences_methodo_new"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_zprospection_bib_taxons_fp" type="relfk"
	 custom-color="#9e2eb8"
	 src-table="florepatri.t_zprospection"
	 dst-table="florepatri.bib_taxons_fp"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_zprospection_bib_organismes" type="relfk"
	 custom-color="#0defdb"
	 src-table="florepatri.t_zprospection"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-102.369" y="-23.9017"/>
	</label>
</relationship>

<relationship name="rel_t_zprospection_t_protocoles" type="relfk"
	 custom-color="#a26b15"
	 src-table="florepatri.t_zprospection"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_zprospection_bib_lots" type="relfk"
	 custom-color="#fbcb33"
	 src-table="florepatri.t_zprospection"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_zprospection_bib_rezo_ecrins" type="relfk"
	 custom-color="#420596"
	 src-table="florepatri.t_zprospection"
	 dst-table="florepatri.bib_rezo_ecrins"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_zprospection_l_secteurs" type="relfk"
	 custom-color="#c7bf9e"
	 src-table="florepatri.t_zprospection"
	 dst-table="layers.l_secteurs"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_fs_delphine_t_stations_fs" type="relfk"
	 custom-color="#9f9777"
	 src-table="florestation.cor_fs_delphine"
	 dst-table="florestation.t_stations_fs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="95.3365" y="-19.6352"/>
	</label>
</relationship>

<relationship name="rel_cor_fs_microrelief_t_stations_fs" type="relfk"
	 custom-color="#2f4c5e"
	 src-table="florestation.cor_fs_microrelief"
	 dst-table="florestation.t_stations_fs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-6.91315" y="-42.1352"/>
	</label>
</relationship>

<relationship name="rel_cor_fs_microrelief_bib_microreliefs" type="relfk"
	 custom-color="#ba36e0"
	 src-table="florestation.cor_fs_microrelief"
	 dst-table="florestation.bib_microreliefs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="105.386" y="-13.8351"/>
	</label>
</relationship>

<relationship name="rel_cor_fs_observateur_t_stations_fs" type="relfk"
	 custom-color="#ab8f1e"
	 src-table="florestation.cor_fs_observateur"
	 dst-table="florestation.t_stations_fs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-70.6634" y="-95.3018"/>
	</label>
</relationship>

<relationship name="rel_cor_fs_observateur_t_roles" type="relfk"
	 custom-color="#a13c6a"
	 src-table="florestation.cor_fs_observateur"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_fs_taxon_taxref" type="relfk"
	 custom-color="#13f545"
	 src-table="florestation.cor_fs_taxon"
	 dst-table="taxonomie.taxref"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="77.2095" y="-29.3696"/>
	</label>
</relationship>

<relationship name="rel_cor_fs_taxon_t_stations_fs" type="relfk"
	 custom-color="#9b167a"
	 src-table="florestation.cor_fs_taxon"
	 dst-table="florestation.t_stations_fs"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_fs_taxon_bib_abondances" type="relfk"
	 custom-color="#7059d9"
	 src-table="florestation.cor_fs_taxon"
	 dst-table="florestation.bib_abondances"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="92.7066" y="-10.0851"/>
	</label>
</relationship>

<relationship name="rel_t_stations_fs_bib_expositions" type="relfk"
	 custom-color="#45fc2d"
	 src-table="florestation.t_stations_fs"
	 dst-table="florestation.bib_expositions"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="59.1699" y="1.23149"/>
	</label>
</relationship>

<relationship name="rel_t_stations_fs_bib_homogenes" type="relfk"
	 custom-color="#4a4f0e"
	 src-table="florestation.t_stations_fs"
	 dst-table="florestation.bib_homogenes"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="61.5868" y="3.23145"/>
	</label>
</relationship>

<relationship name="rel_t_stations_fs_bib_programmes_fs" type="relfk"
	 custom-color="#805828"
	 src-table="florestation.t_stations_fs"
	 dst-table="florestation.bib_programmes_fs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="19.2534" y="-43.4352"/>
	</label>
</relationship>

<relationship name="rel_t_stations_fs_bib_supports" type="relfk"
	 custom-color="#959338"
	 src-table="florestation.t_stations_fs"
	 dst-table="meta.bib_supports"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_fs_t_protocoles" type="relfk"
	 custom-color="#47ae3a"
	 src-table="florestation.t_stations_fs"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_fs_bib_organismes" type="relfk"
	 custom-color="#9a7a26"
	 src-table="florestation.t_stations_fs"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_fs_bib_lots" type="relfk"
	 custom-color="#319552"
	 src-table="florestation.t_stations_fs"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_stations_fs_bib_surfaces" type="relfk"
	 custom-color="#ad7a7c"
	 src-table="florestation.t_stations_fs"
	 dst-table="florestation.bib_surfaces"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="14.5867" y="3.03141"/>
	</label>
</relationship>

<relationship name="rel_cor_role_menu_t_menus" type="relfk"
	 custom-color="#010d65"
	 src-table="utilisateurs.cor_role_menu"
	 dst-table="utilisateurs.t_menus"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_role_menu_t_roles" type="relfk"
	 custom-color="#857cf2"
	 src-table="utilisateurs.cor_role_menu"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_roles_t_roles" type="relfk"
	 custom-color="#d56fee"
	 src-table="utilisateurs.cor_roles"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_roles_bib_organismes" type="relfk"
	 custom-color="#fcd21d"
	 src-table="utilisateurs.t_roles"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_roles_bib_unites" type="relfk"
	 custom-color="#2a072b"
	 src-table="utilisateurs.t_roles"
	 dst-table="utilisateurs.bib_unites"
	 src-required="false" dst-required="false"/>

<relationship name="rel_bib_taxons_taxref" type="relfk"
	 custom-color="#ad2fa7"
	 src-table="taxonomie.bib_taxons"
	 dst-table="taxonomie.taxref"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-70.3072" y="-21.2708"/>
	</label>
</relationship>

<relationship name="rel_cor_taxon_attribut_bib_taxons" type="relfk"
	 custom-color="#9919c7"
	 src-table="taxonomie.cor_taxon_attribut"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-91.1072" y="-35.1706"/>
	</label>
</relationship>

<relationship name="rel_cor_taxon_attribut_bib_attributs" type="relfk"
	 custom-color="#294b27"
	 src-table="taxonomie.cor_taxon_attribut"
	 dst-table="taxonomie.bib_attributs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-97.1104" y="-14.1706"/>
	</label>
</relationship>

<relationship name="rel_cor_taxon_liste_bib_taxons" type="relfk"
	 custom-color="#ac069c"
	 src-table="taxonomie.cor_taxon_liste"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-67.6566" y="-4.60381"/>
	</label>
</relationship>

<relationship name="rel_cor_taxon_liste_bib_listes" type="relfk"
	 custom-color="#9454a9"
	 src-table="taxonomie.cor_taxon_liste"
	 dst-table="taxonomie.bib_listes"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="81.1412" y="-40.6036"/>
	</label>
</relationship>

<relationship name="rel_taxref_bib_taxref_habitats" type="relfk"
	 custom-color="#4fa3e7"
	 src-table="taxonomie.taxref"
	 dst-table="taxonomie.bib_taxref_habitats"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="89.7228" y="-18.204"/>
	</label>
</relationship>

<relationship name="rel_taxref_bib_taxref_rangs" type="relfk"
	 custom-color="#70fcb7"
	 src-table="taxonomie.taxref"
	 dst-table="taxonomie.bib_taxref_rangs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-81.7271" y="-23.0371"/>
	</label>
</relationship>

<relationship name="rel_taxref_bib_taxref_statuts" type="relfk"
	 custom-color="#d0b604"
	 src-table="taxonomie.taxref"
	 dst-table="taxonomie.bib_taxref_statuts"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-88.1072" y="-23.3706"/>
	</label>
</relationship>

<relationship name="rel_bib_criteres_inv_bib_criteres_synthese" type="relfk"
	 custom-color="#e19890"
	 src-table="contactinv.bib_criteres_inv"
	 dst-table="synthese.bib_criteres_synthese"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-11.3788" y="-43.1385"/>
	</label>
</relationship>

<relationship name="rel_cor_message_taxon_bib_taxons" type="relfk"
	 custom-color="#cd9073"
	 src-table="contactinv.cor_message_taxon"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="111.558" y="-24.473"/>
	</label>
</relationship>

<relationship name="rel_cor_message_taxon_bib_messages_inv" type="relfk"
	 custom-color="#adf5fb"
	 src-table="contactinv.cor_message_taxon"
	 dst-table="contactinv.bib_messages_inv"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_role_fiche_inv_t_fiches_inv" type="relfk"
	 custom-color="#6eba83"
	 src-table="contactinv.cor_role_fiche_inv"
	 dst-table="contactinv.t_fiches_inv"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-10.4935" y="3.79155"/>
	</label>
</relationship>

<relationship name="rel_cor_role_fiche_inv_t_roles" type="relfk"
	 custom-color="#c31290"
	 src-table="contactinv.cor_role_fiche_inv"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_unite_taxon_inv_bib_taxons" type="relfk"
	 custom-color="#b6857f"
	 src-table="contactinv.cor_unite_taxon_inv"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_inv_bib_milieux_inv" type="relfk"
	 custom-color="#aa0fcb"
	 src-table="contactinv.t_fiches_inv"
	 dst-table="contactinv.bib_milieux_inv"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="97.1733" y="-15.0419"/>
	</label>
</relationship>

<relationship name="rel_t_fiches_inv_bib_lots" type="relfk"
	 custom-color="#22d1d9"
	 src-table="contactinv.t_fiches_inv"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="63.8709" y="-1.7736"/>
	</label>
</relationship>

<relationship name="rel_t_fiches_inv_bib_organismes" type="relfk"
	 custom-color="#0920c8"
	 src-table="contactinv.t_fiches_inv"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_inv_t_protocoles" type="relfk"
	 custom-color="#78d25d"
	 src-table="contactinv.t_fiches_inv"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_releves_inv_bib_criteres_inv" type="relfk"
	 custom-color="#a81f3c"
	 src-table="contactinv.t_releves_inv"
	 dst-table="contactinv.bib_criteres_inv"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_releves_inv_bib_taxons" type="relfk"
	 custom-color="#395ae8"
	 src-table="contactinv.t_releves_inv"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-144.244" y="-173.906"/>
	</label>
</relationship>

<relationship name="rel_t_releves_inv_t_fiches_inv" type="relfk"
	 custom-color="#62206a"
	 src-table="contactinv.t_releves_inv"
	 dst-table="contactinv.t_fiches_inv"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="95.6389" y="-13.9753"/>
	</label>
</relationship>

<relationship name="rel_l_communes_l_secteurs" type="relfk"
	 custom-color="#d9b757"
	 src-table="layers.l_communes"
	 dst-table="layers.l_secteurs"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="80.3177" y="-28.3137"/>
	</label>
</relationship>

<relationship name="rel_l_zonesstatut_bib_typeszones" type="relfk"
	 custom-color="#1dabd8"
	 src-table="layers.l_zonesstatut"
	 dst-table="layers.bib_typeszones"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="104.861" y="-16.8494"/>
	</label>
</relationship>

<relationship name="rel_bib_lots_bib_programmes" type="relfk"
	 custom-color="#dc5589"
	 src-table="meta.bib_lots"
	 dst-table="meta.bib_programmes"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="25.27" y="-38.8213"/>
	</label>
</relationship>

<relationship name="rel_syntheseff_bib_organismes" type="relfk"
	 custom-color="#3804d4"
	 src-table="synthese.syntheseff"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_syntheseff_bib_criteres_synthese" type="relfk"
	 custom-color="#a095f9"
	 src-table="synthese.syntheseff"
	 dst-table="synthese.bib_criteres_synthese"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-105.146" y="-18.5035"/>
	</label>
</relationship>

<relationship name="rel_syntheseff_bib_lots" type="relfk"
	 custom-color="#eb2d57"
	 src-table="synthese.syntheseff"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false"/>

<relationship name="rel_syntheseff_t_precisions" type="relfk"
	 custom-color="#8706a7"
	 src-table="synthese.syntheseff"
	 dst-table="meta.t_precisions"
	 src-required="false" dst-required="false"/>

<relationship name="rel_syntheseff_t_protocoles" type="relfk"
	 custom-color="#ba71a2"
	 src-table="synthese.syntheseff"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_syntheseff_bib_sources" type="relfk"
	 custom-color="#241b7f"
	 src-table="synthese.syntheseff"
	 dst-table="synthese.bib_sources"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="83.9216" y="-22.5035"/>
	</label>
</relationship>

<relationship name="rel_cor_unite_synthese_syntheseff" type="relfk"
	 custom-color="#494340"
	 src-table="synthese.cor_unite_synthese"
	 dst-table="synthese.syntheseff"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_zonesstatut_synthese_syntheseff" type="relfk"
	 custom-color="#da6f1e"
	 src-table="synthese.cor_zonesstatut_synthese"
	 dst-table="synthese.syntheseff"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="2.03819" y="-47.5035"/>
	</label>
</relationship>

<relationship name="rel_taxref_protection_especes_taxref" type="relfk"
	 custom-color="#07efed"
	 src-table="taxonomie.taxref_protection_especes"
	 dst-table="taxonomie.taxref"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="88.7595" y="1.02944"/>
	</label>
</relationship>

<relationship name="rel_taxref_protection_especes_taxref_protection_articles" type="relfk"
	 custom-color="#1d6a20"
	 src-table="taxonomie.taxref_protection_especes"
	 dst-table="taxonomie.taxref_protection_articles"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-163.275" y="-25.0704"/>
	</label>
</relationship>

<relationship name="rel_cor_role_droit_application_t_applications" type="relfk"
	 custom-color="#d89872"
	 src-table="utilisateurs.cor_role_droit_application"
	 dst-table="utilisateurs.t_applications"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_role_droit_application_bib_droits" type="relfk"
	 custom-color="#50d7f8"
	 src-table="utilisateurs.cor_role_droit_application"
	 dst-table="utilisateurs.bib_droits"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_role_droit_application_t_roles" type="relfk"
	 custom-color="#b465ed"
	 src-table="utilisateurs.cor_role_droit_application"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_menus_t_applications" type="relfk"
	 custom-color="#0bf822"
	 src-table="utilisateurs.t_menus"
	 dst-table="utilisateurs.t_applications"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_message_taxon_cflore_bib_taxons" type="relfk"
	 custom-color="#8d4cda"
	 src-table="contactflore.cor_message_taxon_cflore"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false"/>

<relationship name="rel_cor_message_taxon_cflore_bib_messages_cflore" type="relfk"
	 custom-color="#7e3dc2"
	 src-table="contactflore.cor_message_taxon_cflore"
	 dst-table="contactflore.bib_messages_cflore"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="145.537" y="-16.9718"/>
	</label>
</relationship>

<relationship name="rel_cor_role_fiche_cflore_t_fiches_cflore" type="relfk"
	 custom-color="#bbac98"
	 src-table="contactflore.cor_role_fiche_cflore"
	 dst-table="contactflore.t_fiches_cflore"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-124.763" y="-19.2384"/>
	</label>
</relationship>

<relationship name="rel_cor_role_fiche_cflore_t_roles" type="relfk"
	 custom-color="#2572f4"
	 src-table="contactflore.cor_role_fiche_cflore"
	 dst-table="utilisateurs.t_roles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_cflore_bib_lots" type="relfk"
	 custom-color="#faa934"
	 src-table="contactflore.t_fiches_cflore"
	 dst-table="meta.bib_lots"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-61.0296" y="-3.53845"/>
	</label>
</relationship>

<relationship name="rel_t_fiches_cflore_bib_organismes" type="relfk"
	 custom-color="#6960af"
	 src-table="contactflore.t_fiches_cflore"
	 dst-table="utilisateurs.bib_organismes"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_fiches_cflore_t_protocoles" type="relfk"
	 custom-color="#490121"
	 src-table="contactflore.t_fiches_cflore"
	 dst-table="meta.t_protocoles"
	 src-required="false" dst-required="false"/>

<relationship name="rel_t_releves_cflore_bib_abondances_cflore" type="relfk"
	 custom-color="#7c250a"
	 src-table="contactflore.t_releves_cflore"
	 dst-table="contactflore.bib_abondances_cflore"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="3.05432" y="-52.9051"/>
	</label>
</relationship>

<relationship name="rel_t_releves_cflore_bib_phenologies_cflore" type="relfk"
	 custom-color="#14ee13"
	 src-table="contactflore.t_releves_cflore"
	 dst-table="contactflore.bib_phenologies_cflore"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="-124.112" y="-20.2385"/>
	</label>
</relationship>

<relationship name="rel_t_releves_cflore_bib_taxons" type="relfk"
	 custom-color="#64db14"
	 src-table="contactflore.t_releves_cflore"
	 dst-table="taxonomie.bib_taxons"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="4.19097" y="-7.20742"/>
	</label>
</relationship>

<relationship name="rel_t_releves_cflore_t_fiches_cflore" type="relfk"
	 custom-color="#ffaa00"
	 src-table="contactflore.t_releves_cflore"
	 dst-table="contactflore.t_fiches_cflore"
	 src-required="false" dst-required="false">
	<label ref-type="name-label">
		<position x="107.088" y="-18.8385"/>
	</label>
</relationship>

<permission>
	<object name="contactfaune" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="contactinv" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="bryophytes" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="florepatri" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="florestation" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="layers" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="layers" type="schema"/>
	<roles names="postgres"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="meta" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="synchronomade" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="synthese" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="taxonomie" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="utilisateurs" type="schema"/>
	<roles names="geonatuser"/>
	<privileges create="true" usage="true"/>
</permission>
<permission>
	<object name="contactfaune.insert_fiche_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.insert_fiche_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.insert_releve_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.insert_releve_cf()" type="function"/>
	<roles names="postgres"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.insert_releve_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_delete_releve_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_delete_releve_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_insert_releve_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_insert_releve_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_cor_role_fiche_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_cor_role_fiche_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_fiche_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_fiche_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_releve_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.synthese_update_releve_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.update_fiche_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.update_fiche_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.update_releve_cf()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactfaune.update_releve_cf()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.insert_fiche_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.insert_fiche_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.insert_releve_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.insert_releve_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_delete_releve_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_delete_releve_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_insert_releve_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_insert_releve_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_cor_role_fiche_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_cor_role_fiche_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_fiche_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_fiche_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_releve_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.synthese_update_releve_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.update_fiche_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.update_fiche_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.update_releve_inv()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="contactinv.update_releve_inv()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="bryophytes.delete_synthese_cor_bryo_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="bryophytes.insert_synthese_cor_bryo_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="bryophytes.update_synthese_cor_bryo_observateur()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="bryophytes.update_synthese_cor_bryo_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="bryophytes.update_synthese_stations_bryo()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.delete_synthese_ap()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.insert_ap()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.insert_synthese_ap()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.letypedegeom(geometry)" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.letypedegeom(geometry)" type="function"/>
	<roles names="postgres"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.update_ap()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.update_synthese_ap()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.update_synthese_cor_zp_obs()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.update_synthese_zp()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florepatri.update_zp()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.delete_synthese_cor_fs_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.etiquette_utm(geometry)" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.etiquette_utm(geometry)" type="function"/>
	<roles names="postgres"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.insert_synthese_cor_fs_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.update_synthese_cor_fs_observateur()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.update_synthese_cor_fs_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="florestation.update_synthese_stations_fs()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.insert_syntheseff()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.insert_syntheseff()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_unite_synthese()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_unite_synthese()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_unite_taxon()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_unite_taxon()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_zonesstatut_synthese()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.maj_cor_zonesstatut_synthese()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.update_syntheseff()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="synthese.update_syntheseff()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="utilisateurs.modify_date_insert()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="utilisateurs.modify_date_insert()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="utilisateurs.modify_date_update()" type="function"/>
	<roles names="geonatuser"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="utilisateurs.modify_date_update()" type="function"/>
	<privileges execute="true"/>
</permission>
<permission>
	<object name="public.cor_boolean" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.bib_criteres_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.bib_messages_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.cor_critere_liste" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.cor_message_taxon" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.cor_role_fiche_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.cor_unite_taxon" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.log_colors" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.log_colors_day" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.t_fiches_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.t_releves_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_comptages_methodo" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_frequences_methodo_new" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_perturbations" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_perturbations" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_phenologies" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_phenologies" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_physionomies" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_physionomies" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_rezo_ecrins" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_rezo_ecrins" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_statuts" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_statuts" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_taxons_fp" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.bib_taxons_fp" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_ap_perturb" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_ap_perturb" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_ap_physionomie" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_ap_physionomie" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_taxon_statut" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.cor_taxon_statut" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_criteres_cf" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.cor_role_menu" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.cor_roles" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.t_roles" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_observateurs_faune" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_filtres" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_attributs" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_listes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_taxons" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.cor_taxon_attribut" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.cor_taxon_liste" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.taxref" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_classes" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_taxons_faune" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_taxons_faune" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_unites_geo" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_unites_geo" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_unites_geo_cf" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactfaune.v_nomade_unites_geo_cf" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.bib_criteres_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.bib_messages_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.bib_milieux_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.cor_message_taxon" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.cor_role_fiche_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.cor_unite_taxon_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.log_colors" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.log_colors_day" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.t_fiches_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.t_releves_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_classes" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_criteres_inv" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_milieux_inv" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_observateurs_inv" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_taxons_inv" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_taxons_inv" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_unites_geo_inv" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactinv.v_nomade_unites_geo_inv" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.bib_typeszones" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.bib_typeszones" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_aireadhesion" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_aireadhesion" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_communes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_communes" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_isolines20" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_secteurs" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_secteurs" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_zonesstatut" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="layers.l_zonesstatut" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="meta.bib_lots" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="meta.bib_programmes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="meta.bib_supports" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="meta.t_precisions" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="meta.t_protocoles" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.bib_criteres_synthese" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.syntheseff" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.bib_organismes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synchronomade.erreurs_cf" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synchronomade.erreurs_inv" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synchronomade.erreurs_mortalite" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.bib_sources" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.cor_unite_synthese" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.cor_zonesstatut_synthese" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_taxref_habitats" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_taxref_rangs" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.bib_taxref_statuts" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.import_taxref" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.import_taxref" type="table"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.taxref_changes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.taxref_protection_articles" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="taxonomie.taxref_protection_especes" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.v_tree_taxons_synthese" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.v_taxons_synthese" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.bib_droits" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.bib_unites" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.cor_role_droit_application" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.t_applications" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.t_menus" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.v_nomade_observateurs_all" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.v_nomade_observateurs_all" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="utilisateurs.v_observateurs" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_observateurs_fp" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_observateurs_fp" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_line" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_line" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_point" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_point" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_polygon" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_touteslesap_2154_polygon" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_toutesleszp_2154" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_toutesleszp_2154" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_line" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_line" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_point" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_point" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_poly" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_ap_poly" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_pentes" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_pentes" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_perturbations" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_perturbations" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_phenologies" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_phenologies" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_physionomies" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_physionomies" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_taxons_fp" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_taxons_fp" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_visu_zp" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_mobile_visu_zp" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_taxon" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_taxon" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_zp" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_zp" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_ap" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_ap" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_florestation_all" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_florestation_all" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_florestation_patrimoniale" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_florestation_patrimoniale" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_taxons_fs" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florestation.v_taxons_fs" type="view"/>
	<roles names="postgres"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="florepatri.v_nomade_classes" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="public.v_mobile_recherche" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="synthese.v_export_sinp" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactflore.bib_messages_cflore" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactflore.cor_message_taxon_cflore" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactflore.cor_role_fiche_cflore" type="table"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactflore.v_nomade_abondances_cflore" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
<permission>
	<object name="contactflore.v_nomade_phenologies_cflore" type="view"/>
	<roles names="geonatuser"/>
	<privileges select="true" delete="true" insert="true" update="true" truncate="true" references="true" trigger="true"/>
</permission>
</dbmodel>
