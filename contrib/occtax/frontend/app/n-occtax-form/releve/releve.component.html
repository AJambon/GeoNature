<div 
  *ngIf="occtaxFormService.disabled" 
  id="overlay" 
  [class.disabled-form]="occtaxFormService.disabled" 
  (click)="formDisabled()">
</div>

<div>
  <pnx-areas-intersected-modal *ngIf="geojson"
    [geojson]="geojson"> 
  </pnx-areas-intersected-modal>
</div>

<div class="row">
  <div class="col-xl-8 col-lg-10">

    <!-- OBSERVATEURS -->
    <pnx-observers 
      *ngIf="!occtaxConfig.observers_txt; else elseBlock"
      [parentFormControl]="propertiesForm.get('observers')" 
      [idMenu]="occtaxConfig.id_observers_list"
      [disabled]="occtaxFormService.disabled" 
      label="{{ 'Releve.Observers' | translate }}" 
      [bindAllItem]="true">
    </pnx-observers>
    <ng-template #elseBlock>
      <pnx-observers-text 
        [parentFormControl]="propertiesForm.get('observers_txt')" 
        [disabled]="occtaxFormService.disabled">
      </pnx-observers-text>
    </ng-template>

    <!-- DATASET -->
    <pnx-datasets 
      *ngIf="dataset?.active || true; else elseblocDataset"
      label="{{ 'MetaData.Datasets' | translate }}" 
      [parentFormControl]="propertiesForm.get('id_dataset')"
      [disabled]="occtaxFormService.disabled"
      moduleCode="OCCTAX">
    </pnx-datasets>
    <ng-template #elseblocDataset>
      <div class="dataset-inactive">
        <small> {{ 'MetaData.Datasets' | translate }}:  </small>
        <small>
          <b> {{ dataset?.dataset_name}}</b>
        </small> 
      </div>
    </ng-template>

  </div>

  <div class="col-md-3 d-none d-xl-block">
    <pnx-areas-intersected-modal *ngIf="geojson"
      [geojson]="geojson"> 
    </pnx-areas-intersected-modal>
  </div>

</div>


<div class="row">

  <div class="col-xl-4 col-md-6 col-sm-8 col-11">
    <!-- DATE MIN -->
    <pnx-date 
      *ngIf="occtaxConfig.form_fields.date_min" 
      label="{{ 'Releve.MinDate' | translate }}" 
      [defaultToday]="occtaxConfig.DATE_FORM_WITH_TODAY" 
      [parentFormControl]="propertiesForm.get('date_min')"
      [disabled]="occtaxFormService.disabled">
    </pnx-date>
  </div>

  <div class="col-xl-3 col-md-5 col-sm-8 col-11" [hidden]="!showTime">
    <!-- DATE MAX -->
    <pnx-date 
      *ngIf="occtaxConfig.form_fields.date_max" 
      label="{{ 'Releve.MaxDate' | translate }} " 
      [parentFormControl]="propertiesForm.get('date_max')"
      [disabled]="occtaxFormService.disabled">
    </pnx-date>
  </div>

  <div class="d-flex align-content-end flex-wrap">
    <button 
      class="btn btn-sm btn-outline-shadow" 
      [disabled]="occtaxFormService.disabled" 
      (click)="showTime = !showTime">
      <i 
        class="fa fa-plus" 
        [ngClass]="showTime ? 'fa-minus' : 'fa-plus'" 
        aria-expanded="false"></i>
    </button>
  </div>
</div>

<div class="row" [hidden]="!showTime">
  <div class="col-md-4 col-sm-5 col-6">

    <!-- HOUR MIN -->
    <div 
      *ngIf="occtaxConfig.form_fields.hour_min" 
      class="form-group">
      <small> {{'Releve.HourMin' | translate }} </small>
      <input 
        [ngClass]="{'is-invalid' : propertiesForm.get('hour_min').invalid}" 
        [formControl]="propertiesForm.get('hour_min')"
        class="form-control form-control-sm" 
        type="text" 
        placeholder="{{'Releve.HourFormat' | translate }}"
        [disableControl]="occtaxFormService.disabled">
    </div>
  </div>

  <div class="col-md-4 col-sm-5 col-6" [hidden]="!showTime">
    <!-- HOUR MAX -->
    <div 
      *ngIf="occtaxConfig.form_fields.hour_max" 
      class="form-group">
      <small> {{'Releve.HourMax' | translate }} </small>
      <input 
        [ngClass]="{'is-invalid' : propertiesForm.get('hour_max').invalid}" 
        [formControl]="propertiesForm.get('hour_max')"
        class="form-control form-control-sm" 
        type="text" 
        placeholder="{{'Releve.HourFormat' | translate }}"
        [disableControl]="occtaxFormService.disabled">
    </div>
  </div>
</div>


<div class="row">
  <div class="col-xl-2 col-md-3 col-sm-4 col-6">

    <!-- ALTITUDE MIN -->
    <div *ngIf="occtaxConfig.form_fields.altitude_min">
      <small> {{ 'Releve.MinAltitude' | translate }} </small>
      <input 
        class="form-control form-control-sm" 
        type="number" 
        [formControl]="propertiesForm.get('altitude_min')"
        [disableControl]="occtaxFormService.disabled">
    </div>
  </div>

  <div class="col-xl-2 col-md-3 col-sm-4 col-6">
    <!-- ALTITUDE MAX -->
    <div *ngIf="occtaxConfig.form_fields.altitude_max">
      <small> {{ 'Releve.MaxAltitude' | translate }} </small>
      <input 
        class="form-control form-control-sm" 
        type="number" 
        [formControl]="propertiesForm.get('altitude_max')"
        [disableControl]="occtaxFormService.disabled">
    </div>
  </div>

  <div class="col-xl-4 col-md-6">
    <!-- TYPE REGROUPEMENT -->
    <pnx-nomenclature 
      *ngIf="occtaxConfig.form_fields.group_type" 
      label="{{ 'Releve.GroupType' | translate }}" 
      [parentFormControl]="propertiesForm.get('id_nomenclature_grp_typ')"
      codeNomenclatureType="TYP_GRP" 
      [disabled]="occtaxFormService.disabled">
    </pnx-nomenclature>
  </div>
</div>




<!-- TECHNIQUE OBSERVATION -->
<pnx-nomenclature 
  *ngIf="occtaxConfig.form_fields.obs_technique" 
  label="{{ 'Releve.ObsTechnique' | translate }}" 
  [parentFormControl]="propertiesForm.get('id_nomenclature_obs_technique')"
  codeNomenclatureType="TECHNIQUE_OBS" 
  [disabled]="occtaxFormService.disabled">
</pnx-nomenclature>





<!-- COMMENTAIRE -->
<div *ngIf="occtaxConfig.form_fields.comment_releve">
  <small> {{ 'Releve.Comment' | translate }} </small>
  <textarea 
    class="form-control" 
    [formControl]="propertiesForm.get('comment')">
  </textarea>
</div>

<div class="text-center" style="margin-top: 10px;"> 
  <ng-container *ngIf="!(occtaxFormService.editionMode|async); else modifButton">
    <button 
      class="btn btn-primary"
      matTooltip="Enregistrer le relevé et saisir les taxons"
      [disabled]="releveForm.invalid"
      (click)="submitReleveForm()">
      Enregistrer
    </button> 
  </ng-container>
  <ng-template #modifButton>
    <button 
      class="btn btn-primary"
      matTooltip="Modifier le relevé"
      [disabled]="propertiesForm.invalid"
      (click)="submitReleveForm()">
      Modifier
    </button> 
  </ng-template>
</div>
