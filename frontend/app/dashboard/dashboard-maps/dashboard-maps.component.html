<div class="row row-sm">

    <div class="col-md-8 padding-sm">
        <div class="card-absolute">
            <h5> {{ introLegend }} </h5>      
            <h5><b><p> {{ currentCommune }} </p></b></h5>
            <p> {{ currentNbObs }} </p>
            <p> {{ currentNbTax }} </p>        
        </div>
        <pnx-map height="65vh">
            <!-- <pnx-marker (markerChanged)="test($event)"></pnx-marker> -->
            <pnx-geojson [geojson]="background" [onEachFeature]="defineBackground.bind(this)"></pnx-geojson>
            <pnx-geojson [geojson]="myCommunes" [onEachFeature]="showData.bind(this)"></pnx-geojson>
        </pnx-map>
    </div>

    <div class="col-md-4 padding-sm">
        <div class="card" style="height:44rem">
            <h5 class="card-header white-text" style="text-align:center; color:white">Filtres</h5>
            <div class="card-body">

                <div id="buttons">
                    <div class="row row-sm">
                        <div class="col-md-6 padding-sm">
                            <button class="btn btn-block btn-bordeaux" (click)= "changeMapToObs()"> <B>Nombre d'observations</B> </button>
                        </div>
                        <div class="col-md-6 padding-sm">
                            <button class="btn btn-block btn-water" (click)= "changeMapToTax()"> <B>Nombre de taxons</B> </button>
                        </div>
                    </div><br/>
                    <div class="row row-sm">
                        <div class="col-md-6 padding-sm">
                            <button class="btn btn-block btn-secondary" (click)= "changeMapToCommunes()"> <B>Communes</B> </button>
                        </div>
                        <div class="col-md-6 padding-sm">
                            <button class="btn btn-block btn-secondary" (click)= "changeMapToMailles()"> <B>Mailles</B> </button>
                        </div>
                    </div>
                </div><br/><br/>

                <div id="filters">           
                    <form (ngSubmit)="refreshData()" [formGroup]="mapForm">
                        <div class="form-group"> 
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text"> Nombre de classes </div>
                                </div>
                                <input type="text" class="form-control" formControlName="nbClasses">
                            </div>
                        </div><br/>
                        <div class="form-group">
                            <label class="col-form-label"><b> Période </b></label>
                            <div class="row justify-content-md-center">
                                <div class="col-md-11">
                                    <nouislider class="nouislider" [connect]="true" [tooltips]="true" [min]="yearRange[0]" [max]="yearRange[1]" [step]="1" [formControl]="mapForm.controls.selectedYearRange"></nouislider>
                                </div>
                            </div>
                        </div><br/><br/>                       
                        <div class="form-group row">
                            <div class="col-md-6">
                                <label class="col-form-label"><b> Type de filtre taxonomique </b></label>                           
                                <select class="form-control form-control-sm" [disableControl]="disabled" formControlName="selectedFilter" (change)="onTaxFilterChange($event)">
                                    <option> </option>
                                    <option> Groupe INPN 1 </option>
                                    <option> Groupe INPN 2 </option>
                                    <option> Règne </option>
                                    <option> Phylum </option>
                                    <option> Classe </option>
                                    <option> Ordre </option>
                                    <option> Famille </option>
                                </select> 
                            </div>
                            <div class="col-md-6" id="group1_inpn_filter" *ngIf="filter === 'Groupe INPN 1'">
                                <label class="col-form-label"> Groupe INPN 1 </label>                           
                                <select class="form-control form-control-sm" formControlName="selectedGroup1INPN">
                                    <option> </option>
                                    <option *ngFor="let group1_inpn of taxonomies['Groupe INPN 1']" [ngValue]="group1_inpn"> {{ group1_inpn }} </option>
                                </select> 
                            </div>
                            <div class="col-md-6" id="group2_inpn_filter" *ngIf="filter === 'Groupe INPN 2'">
                                <label class="col-form-label"> Groupe INPN 2 </label>                           
                                <select class="form-control form-control-sm" formControlName="selectedGroup2INPN">
                                    <option> </option>
                                    <option *ngFor="let group2_inpn of taxonomies['Groupe INPN 2']" [ngValue]="group2_inpn"> {{ group2_inpn }} </option>
                                </select> 
                            </div>
                            <div class="col-md-6" id="regne_filter" *ngIf="filter === 'Règne'">
                                <label class="col-form-label"> Règne </label>                           
                                <select class="form-control form-control-sm" formControlName="selectedRegne">
                                    <option> </option>
                                    <option *ngFor="let regne of taxonomies['Règne']" [ngValue]="regne"> {{ regne }} </option>
                                </select> 
                            </div>
                            <div class="col-md-6" id="phylum_filter" *ngIf="filter === 'Phylum'">
                                <label class="col-form-label"> Phylum </label>                           
                                <select class="form-control form-control-sm" formControlName="selectedPhylum">
                                    <option> </option>
                                    <option *ngFor="let phylumElt of taxonomies['Phylum']" [ngValue]="phylumElt"> {{ phylumElt }} </option>
                                </select> 
                            </div>
                            <div class="col-md-6" id="classe_filter" *ngIf="filter === 'Classe'">
                                <label class="col-form-label"> Classe </label>                           
                                <select class="form-control form-control-sm" formControlName="selectedClasse">
                                    <option> </option>
                                    <option *ngFor="let classe of taxonomies['Classe']" [ngValue]="classe"> {{ classe }} </option>
                                </select> 
                            </div>
                        </div><br/>
                        <!-- {{mapForm.controls.taxon.value |json}} -->
                        <pnx-taxonomy label="{{'Taxon.Taxon' | translate }} " [parentFormControl]="mapForm.controls.taxon"
                            [idList]="500" [charNumber]="3" [listLength]="30" [apiEndPoint]="taxonApiEndPoint" (onChange)=formService.getCurrentTaxon($event)>
                        </pnx-taxonomy><br/>
                        <div class="row justify-content-md-center">
                            <div class="col-md-3">
                                <button class="btn btn-outline-green btn-block" type="submit">Valider</button>
                            </div>
                        </div>
                    </form>
                </div> 

            </div>
        </div>
    </div>

</div>