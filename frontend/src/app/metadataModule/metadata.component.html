<div class="container-fluid">
  <div class="card card-page">
    <div class="card-header">
      <h3 class="underlined main-color"> Catalogue des jeux de données </h3>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="form-group col-sm-7">
          <input class="form-control form-control-sm"
            type="text" name="" id="" placeholder="Rechercher" (keyup)="updateSearchbar($event)" >
        </div>
        <div class="col-sm-3">
          <button class="mat-stroked-button" (click)="openSearchModal(searchModal)"> Recherche avancée </button>
        </div>
      </div>
      <div>Liste des cadres d'acquisition et des jeux de données associés</div>
      <br>

      <mat-accordion [multi]="true">
              <div class="tab-title">
                <div style="width: 5%">ID </div>
                <div style="min-width: 40%"> Nom</div>
                <div style="width: 10%"> Date de création</div>
                <div style="width: 10%"> Créateur</div>
                <div style="width: 20%"> Acteurs</div>
                <div style="width: 10%"> Actions</div>
              </div>
                <!-- <div class="tab-title">
                  <span>ID</span>
                  <span>Nom</span>
                  <span style="width: 50%">Date de création</span>
                </div> -->
                <ng-container *ngFor="let af of tempAF; let idx = index">
                  <mat-expansion-panel *ngIf="isDisplayed(idx)" [expanded]="expandAccordions">
                    <mat-expansion-panel-header
                      collapsedHeight="80px" 
                      expandedHeight="100px"
                    >
                      <mat-panel-title class="af-title">
                        <div style="width: 5%">{{ af.id_acquisition_framework  }}</div>
                        <div style="width: 40%"> <a [routerLink]="['/metadata/af_detail', af.id_acquisition_framework]"> {{ af.acquisition_framework_name | uppercase }} </a> 
                          <br> <small class="muted"> {{ af.unique_acquisition_framework_id  }}  </small>
                        </div>
                        <div style="width: 10%">{{af.acquisition_framework_start_date |date:'d/MM/yyyy'}}</div>
                        <div style="width: 10%">{{af.creator_mail}}</div>
                        <div style="width: 20%">{{af.project_owner_name}}</div>
                        <div style="width: 10%; text-align: right"><a style="color: black;" [routerLink]="['/metadata/af', af.id_acquisition_framework]"><mat-icon> create</mat-icon></a></div>

                      </mat-panel-title>
            
                    </mat-expansion-panel-header>
                    <table class="table table-bordered">
                      <thead class="bold">
                        <tr>
                            <td style="width:1%">
                              Id
                            </td>
                            <td>Nom du JDD</td>
                            <td>Date de création</td>
                            <td>Nombre de données</td>
                            <td>Créateurs</td>
                            <td>Rapport</td>
                            <td>Actions</td>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let ds of af.datasetsTemp; let last = last">
                            <td> {{ds.id_dataset}}</td>
                            <td> {{ ds.dataset_name }} </td>
                            <td> {{ds.meta_create_date |date:'d/MM/yyyy' }}</td>
                            <td> {{ds.observation_count}} </td>
                            <td> {{ ds.createur?.organism?.nom_organisme }} </td>
                            <td> <mat-icon (click)="sensiReport(ds.id_dataset)" matTooltip="Rapport de sensibilité"> do_not_touch</mat-icon>  <mat-icon matTooltip="Rapport d'UUID" (click)="uuidReport(ds.id_dataset)"> format_list_numbered </mat-icon> </td>
                            <td> <a style="color: black;" [routerLink]="['/metadata/dataset', ds.id_dataset]"><mat-icon> create</mat-icon></a> <mat-icon> done</mat-icon>  <mat-icon> download</mat-icon>  <mat-icon> room</mat-icon> <mat-icon> delete</mat-icon>  </td>
                        </tr>
                      </tbody>
                    </table>
                  </mat-expansion-panel>
                </ng-container>

      </mat-accordion>
      <mat-paginator #paginator
                    [length]="tempAF.length"
                    [pageSize]="pageSize"
                    [pageSizeOptions]="pageSizeOptions"
                    (page)="changePaginator($event)">
      </mat-paginator>

      <div>
        <a *ngIf="_cruvedStore.cruved?.METADATA?.cruved.C !== '0'" routerLink="/metadata/af" class="btn btn-primary btn-sm margin-top-sm"> Ajouter un cadre d'acquisition </a>
        &nbsp;<a *ngIf="_cruvedStore.cruved?.METADATA?.cruved.C !== '0'" routerLink="/metadata/dataset" class="btn btn-primary btn-sm margin-top-sm"> Ajouter un jeu de données </a>
      </div>
    </div>
  </div>
</div>


<ng-template #searchModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel"> Rechercher </h5>
  </div>
  <div class="modal-body" style="align-items: flex-end;">
    <div class="row">
      <div class="col">
        UID
      </div>
      <div class="col">
        <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="n° Dossier" (keyup)="updateAdvancedCriteria($event, 'num')">
      </div>
    </div>
    <div class="row">
      <div class="col">
        Titre / Identifiant
      </div>
      <div class="col">
        <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="Titre / Identifiant" (keyup)="updateAdvancedCriteria($event, 'title1')">
      </div>
    </div>
    <div class="row">
      <div class="col">
        Crée le
      </div>
      <div class="col">
        <!-- <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="Crée le" (keyup)="updateAdvancedCriteria($event, 'start_date')"> -->
          <div class="form-group">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" (ngModelChange) = "updateAdvancedCriteria($event, 'start_date')" 
                     name="dp" [(ngModel)]="model" ngbDatepicker #d="ngbDatepicker">
              <div class="input-group-append">
                <button class="fa fa-calendar fa-2x" style="color: #7197FF;" (click)="d.toggle()" type="button"></button>
              </div>
            </div>
          </div>
      </div>
    </div>

    <div class="row">
        <div class="col">
            Organisme
        </div>
        <div class="col">
          <select class="form-control form-control-sm" (change)="updateAdvancedCriteria($event, 'organism')">
            <option value="" selected>Organisme</option>
            <option *ngFor="let org of organisms" value="{{org.id_organisme}}" >
              {{org.nom_organisme}} </option>
        </select>
        </div>
    </div>

    <div class="row">
      <div class="col">
          Utilisateur
      </div>
      <div class="col">
        <select class="form-control form-control-sm" (change)="updateAdvancedCriteria($event, 'role')">
          <option value="" selected>Utilisateur</option>
          <option *ngFor="let role of roles" value="{{role.id_role}}">
            {{role.nom_complet}}</option>
        </select>
      </div>
  </div>


    <div class="row">
      <div class="col">
        Selecteur
      </div>
      <div class="col">
        <select name="selecteur" id="selector" (change)="updateSelector($event)">
          <option value="all">JDD ou CA</option>
          <option value="ds">JDD</option>
          <option value="af">CA</option>
      </select>
      </div>
    </div>


    <div class="row">
      <div class="col">
      </div>
      <div class="col">
        <button class="mat-stroked-button" (click)="updateAdvancedSearch()"> Rechercher </button>
        <button class="mat-stroked-button" (click)="closeSearchModal(searchModal)"> Fermer </button>
      </div>
    </div>

  </div>
</ng-template>