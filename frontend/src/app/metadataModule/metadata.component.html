<div class="container-fluid">
  <div class="card card-page">
    <div class="card-header">
      <h3 class="underlined main-color"> Catalogue des jeux de données </h3>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="form-group col-sm-7">
          <input class="form-control form-control-sm"
            type="text" name="" id="" placeholder="Rechercher" (click)="openSearchModal(searchModal)" >
        </div>
      </div>
      <div>Liste des cadres d'acquisition et des jeux de données associés</div>
      <br>

      <mat-accordion [multi]="true">
              <div class="tab-title">
                <div style="width: 5%">ID </div>
                <div style="min-width: 40%"> Nom</div>
                <div style="width: 10%"> Date de création</div>
                <div style="width: 10%"> Créateur</div>
                <div style="width: 20%"> Acteurs</div>
                <div style="width: 10%"> Actions</div>
              </div>
                <ng-container *ngFor="let af of tempAF; let idx = index">
                  <mat-expansion-panel *ngIf="isDisplayed(idx)" [expanded]="expandAccordions">
                    <mat-expansion-panel-header
                      collapsedHeight="80px" 
                      expandedHeight="100px"
                    >
                      <mat-panel-title class="af-title" style="margin-top:2.5%;margin-bottom: 1.2%;">
                        <div style="width: 5%">{{ af.id_acquisition_framework  }}</div>
                        <div style="width: 40%"> <a [routerLink]="['/metadata/af_detail', af.id_acquisition_framework]"> {{ af.acquisition_framework_name | uppercase }} </a> 
                          <br> <small class="muted"> {{ af.unique_acquisition_framework_id  }}  </small>
                        </div>
                        <div style="width: 10%">{{af.acquisition_framework_start_date |date:'d/MM/yyyy'}}</div>
                        <div style="width: 10%">{{roles[0].nom_complet}}</div>
                        <!-- <div style="width: 20%">Orga x : Maitre ouvrage - Personne Y: financeur</div> -->
                        <div style="width: 20%;" *ngIf="af?.actors" >
                          <div class="a" *ngFor="let actor of af.actors">
                            <div>{{ actor?.organism?.nom_organisme }}: {{ actor?.nomenclature_actor_role?.mnemonique}}<span *ngIf="actor?.organism?.nom_organisme && actor?.role?.nom_complet"> - </span> {{ actor?.role?.nom_complet }} </div>
                          </div>
                          <br/>
                        </div>
                        <div style="width: 10%;text-align: center;"><a style="color: black;" [routerLink]="['/metadata/af', af.id_acquisition_framework]"><mat-icon> create</mat-icon></a></div>

                      </mat-panel-title>
            
                    </mat-expansion-panel-header>
                    <table class="table table-bordered">
                      <thead class="bold">
                        <tr>
                            <td style="width:1%">
                              Id
                            </td>
                            <td>Nom du JDD</td>
                            <td>Date de création</td>
                            <td>Nombre de données</td>
                            <td>Créateurs</td>
                            <td>Rapport</td>
                            <td>Actions</td>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let ds of af.datasetsTemp; let last = last">
                          <td> 
                            <a [routerLink]="['/metadata/dataset_detail', ds.id_dataset]"> {{ds.id_dataset}} </a>
                          </td>
                          <td> 
                            <a [routerLink]="['/metadata/dataset_detail', ds.id_dataset]">
                              {{ds.dataset_name}} 
                              <br/>
                              <span style="color: gray"> {{ds.unique_dataset_id}} </span>
                            </a>
                          </td>
                            <td> {{ds.meta_create_date |date:'d/MM/yyyy' }}</td>
                            <td> {{ds.observation_count}} </td>
                            <td> {{roles[0].nom_complet}}</td>
                            
                            <td> <mat-icon (click)="sensiReport(ds.id_dataset)" matTooltip="Rapport de sensibilité"> do_not_touch</mat-icon>  <mat-icon matTooltip="Rapport d'UUID" (click)="uuidReport(ds.id_dataset)"> format_list_numbered </mat-icon> </td>
                            <td *ngIf="ds.active"><a style="color: black;" [routerLink]="['/metadata/dataset', ds.id_dataset]" matTooltip="Éditer un jeux de donnée"><mat-icon> create</mat-icon></a>
                               <a (click)="activateDs(ds.id_dataset, false)" matTooltip="Jeux de donnée activé"><mat-icon> done</mat-icon></a> 
                               <a (click)="importDs(ds.id_dataset)" matTooltip="Importé un jeux de donnée"><mat-icon>get_app</mat-icon></a>
                               <a (click)="syntheseDs(ds.id_dataset)" matTooltip="Afficher le jeux de donnée sur la carte"><mat-icon> room</mat-icon></a>
                               <a *ngIf="ds.deletable" (click)="deleteDs(ds.id_dataset)" matTooltip="Supprimer un jeux de donnée"><mat-icon> delete</mat-icon></a>
                               <a *ngIf="!ds.deletable" matTooltip="La suppression du jeu de données n'est pas possible car des données y sont rattachées dans la Synthèse"><mat-icon>delete_outline</mat-icon></a> 
                            </td>
                            <td *ngIf="!ds.active"><a style="color: black;" [routerLink]="['/metadata/dataset', ds.id_dataset]" matTooltip="Éditer un jeux de donnée"><mat-icon> create</mat-icon></a>
                               <a (click)="activateDs(ds.id_dataset, true)" matTooltip="Jeux de donnée désactivé"><mat-icon> clear</mat-icon></a>
                               <a matTooltip="Impossible d'importé un jeux de donnée"><mat-icon>error</mat-icon></a>
                               <a (click)="syntheseDs(ds.id_dataset)" matTooltip="Afficher le jeux de donnée sur la carte"><mat-icon> room</mat-icon></a>
                               <a *ngIf="ds.deletable" (click)="deleteDs(ds.id_dataset)" matTooltip="Supprimer un jeux de donnée"><mat-icon> delete</mat-icon></a>
                               <a *ngIf="!ds.deletable" matTooltip="La suppression du jeu de données n'est pas possible car des données y sont rattachées dans la Synthèse"><mat-icon>delete_outline</mat-icon></a> 
                            </td>
                        </tr>
                      </tbody>
                    </table>
                  </mat-expansion-panel>
                </ng-container>

      </mat-accordion>
      <mat-paginator #paginator
                    [length]="tempAF.length"
                    [pageSize]="pageSize"
                    [pageSizeOptions]="pageSizeOptions"
                    (page)="changePaginator($event)">
      </mat-paginator>

      <div>
        <a *ngIf="_cruvedStore.cruved?.METADATA?.cruved.C !== '0'" routerLink="/metadata/af" class="btn btn-primary btn-sm margin-top-sm"> Ajouter un cadre d'acquisition </a>
        &nbsp;<a *ngIf="_cruvedStore.cruved?.METADATA?.cruved.C !== '0'" routerLink="/metadata/dataset" class="btn btn-primary btn-sm margin-top-sm"> Ajouter un jeu de données </a>
      </div>
    </div>
  </div>
</div>


<ng-template #searchModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel"> Rechercher </h5>
  </div>
  <div class="modal-body" style="align-items: flex-end;">
    <div class="row">
      <div class="col">
        UIID
      </div>
      <div class="col">
        <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="n° Dossier" (keyup)="updateAdvancedSearch($event, 'num')">
      </div>
    </div>
    <div class="row">
      <div class="col">
        Titre / Identifiant
      </div>
      <div class="col">
        <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="Titre / Identifiant" (keyup)="updateAdvancedSearch($event, 'title1')">
      </div>
    </div>
    <div class="row">
      <div class="col">
        Crée le
      </div>
      <div class="col">
        <!-- <input class="form-control form-control-sm"
          type="text" name="" id="" placeholder="Crée le" (keyup)="updateAdvancedSearch($event, 'start_date')"> -->
          <div class="form-group">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd"
                     name="dp" [(ngModel)]="model" ngbDatepicker #d="ngbDatepicker">
              <div class="input-group-append">
                <button class="fa fa-calendar fa-2x" style="color: #7197FF;" (click)="d.toggle()" type="button"></button>
              </div>
            </div>
          </div>
      </div>
    </div>

    <div class="row">
        <div class="col">
            Organisme
        </div>
        <div class="col">
          <select class="form-control form-control-sm">
            <option value="" disabled selected>Organisme</option>
          <option *ngFor="let org of organisms" [ngValue]="org.id_organisme" >
            {{org.nom_organisme}} </option>
        </select>
        </div>
    </div>

    <div class="row">
      <div class="col">
          Utilisateur
      </div>
      <div class="col">
        <select class="form-control form-control-sm">
          <option value="" disabled selected>Utilisateur</option>
          <option *ngFor="let role of roles" [ngValue]="role.id_role">
            {{role.nom_complet}} </option>
        </select>
      </div>
  </div>


    <div class="row">
      <div class="col">
        Selecteur
      </div>
      <div class="col">
        <select name="selecteur" id="selector">
          <option value="jdd">JDD</option>
          <option value="dog">CA</option>
      </select>
      </div>
    </div>


    <div class="row">
      <div class="col">
      </div>
      <div class="col">
        <button class="mat-stroked-button"> Rechercher </button>
        <button class="mat-stroked-button" (click)="closeSearchModal(searchModal)"> Fermer </button>
      </div>
    </div>

  </div>
</ng-template>