<div *ngIf="bInitialized">
  <div class="mat-accordeon">
    <mat-accordion>
      <div
        *ngFor="let media of medias; let i = index"
        class="blc-expansion-panel"
        selector=".btn-clear"
        displayMouseOver
      >
        <button mat-icon-button class="btn-clear d-none" (click)="deleteMedia(i)">
          <mat-icon matTooltip="Supprimer ce media">clear</mat-icon>
        </button>
        <mat-expansion-panel [expanded]="medias.length === i + 1 && !media.id_media">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div style="display: block; width: 100%;">
                <div>
                  <mat-icon
                    *ngIf="!media.valid() && !media.bLoading"
                    [matTooltip]="'Veuillez complÃ©ter le formulaire.'"
                    class="not-valid"
                    >error</mat-icon
                  >
                  <mat-icon
                    *ngIf="media.valid() && !media.bLoading"
                    matTooltip="Le media est valide"
                    class="valid"
                    >check</mat-icon
                  >

                  <mat-icon *ngIf="media.bLoading" matTooltip="chargement en cours" class="fa-spin"
                    >settings</mat-icon
                  >
                  <img
                  class="media-miniature"
                  *ngIf="nomenclature(media.id_nomenclature_media_type)?.label_fr == 'Photo' && media.href()"
                  [src]="media.href()"
                  alt="{{ media.title_fr }}"
                />

                <span class="media-title">
                  Titre: {{ media.title_fr }} ({{ nomenclature(media.id_nomenclature_media_type)?.label_fr
                  }}<ng-container *ngIf="media.author"
                    >, <i>@{{ media.author }}</i></ng-container
                  >)
                </span>

                </div>
                <div>
                  <mat-progress-bar
                    *ngIf="media.bLoading"
                    mode="determinate"
                    [value]="media.uploadPercentDone"
                  ></mat-progress-bar>
                </div>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <pnx-media
            [(media)]="media"
            (mediaChange)="onMediaChange()"
            [schemaDotTable]="schemaDotTable"
            [sizeMax]="sizeMax"
          >
          </pnx-media>
        </mat-expansion-panel>
        <button
          *ngIf="medias.length === i + 1"
          mat-mini-fab
          color="primary"
          class="btn-add-media"
          id="add-media-btn"
          (click)="addMedia()"
          [disabled]="!validOrLoadingMedias()"
        >
          <mat-icon matTooltip="{{ 'Media.add' | translate }}">add</mat-icon>
        </button>
      </div>
    </mat-accordion>
    <button
      *ngIf="!(medias && medias.length)"
      mat-mini-fab
      color="primary"
      id="add-media-btn"
      (click)="addMedia()"
    >
      <mat-icon matTooltip="{{ 'Media.add' | translate }}">add</mat-icon>
    </button>
  </div>
</div>
